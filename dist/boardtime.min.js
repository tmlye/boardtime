/*! boardtime - v0.0.1 - 2014-02-26 */function randomColor(){return{red:0,green:Math.random(),blue:Math.random(),alpha:.25*Math.random()+.05}}function onMouseDrag(a){var b=a.middlePoint.x,c=a.middlePoint.y,d=a.delta.length/2,e=randomColor();drawCircle(b,c,d,e),emitCircle(b,c,d,e)}function drawCircle(a,b,c,d){var e=new Path.Circle(new Point(a,b),c);e.fillColor=new RgbColor(d.red,d.green,d.blue,d.alpha),view.draw()}function emitCircle(a,b,c,d){var e=io.socket.sessionid,f={x:a,y:b,radius:c,color:d};io.emit("drawCircle",f,e),console.log(f)}tool.maxDistance=50,io.on("drawCircle",function(a){console.log(a),drawCircle(a.x,a.y,a.radius,a.color)});var paper=new function(a){var b=new function(){function c(b,c,d,e,h,i){function j(e,f,i,j){var f=f||(f=k(c,e))&&(f.get?f:f.value);"string"==typeof f&&"#"===f[0]&&(f=b[f.substring(1)]||f);var n,o="function"==typeof f,p=f,q=h||o?f&&f.get?e in b:b[e]:null;!(i||f!==a&&c.hasOwnProperty(e))||h&&q||(o&&q&&(f.base=q),o&&l&&0===f.length&&(n=e.match(/^(get|is)(([A-Z])(.*))$/))&&l.push([n[3].toLowerCase()+n[4],n[2]]),p&&!o&&p.get&&"function"==typeof p.get&&0===p.get.length||(p={value:p,writable:!0}),(k(b,e)||{configurable:!0}).configurable&&(p.configurable=!0,p.enumerable=d),m(b,e,p)),!j||!o||h&&j[e]||(j[e]=function(a){return a&&b[e].apply(a,g.call(arguments,1))})}var l;if(c){l=[];for(var n in c)c.hasOwnProperty(n)&&!f.test(n)&&j(n,null,!0,i);j("toString"),j("valueOf");for(var o=0,p=l.length;p>o;o++){var q=l[o],r=q[1];j(q[0],{get:b["get"+r]||b["is"+r],set:b["set"+r]},!0)}}return b}function d(a,b,c){return a&&("length"in a&&!a.getLength&&"number"==typeof a.length?h:i).call(a,b,c=c||a),c}function e(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}var f=/^(statics|generics|preserve|enumerable|prototype|toString|valueOf)$/,g=[].slice,h=[].forEach||function(a,b){for(var c=0,d=this.length;d>c;c++)a.call(b,this[c],c,this)},i=function(a,b){for(var c in this)this.hasOwnProperty(c)&&a.call(b,this[c],c,this)},j=Object.create||function(a){return{__proto__:a}},k=Object.getOwnPropertyDescriptor||function(a,b){var c=a.__lookupGetter__&&a.__lookupGetter__(b);return c?{get:c,set:a.__lookupSetter__(b),enumerable:!0,configurable:!0}:a.hasOwnProperty(b)?{value:a[b],enumerable:!0,configurable:!0,writable:!0}:null},l=Object.defineProperty||function(a,b,c){return(c.get||c.set)&&a.__defineGetter__?(c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)):a[b]=c.value,a},m=function(a,b,c){return delete a[b],l(a,b,c)};return c(function(){for(var a=0,b=arguments.length;b>a;a++)e(this,arguments[a])},{inject:function(a){if(a){var b=this.prototype,d=Object.getPrototypeOf(b).constructor,e=a.statics===!0?a:a.statics;e!=a&&c(b,a,a.enumerable,d&&d.prototype,a.preserve,a.generics&&this),c(this,e,!0,d,a.preserve)}for(var f=1,g=arguments.length;g>f;f++)this.inject(arguments[f]);return this},extend:function(){for(var a,b=this,d=0,e=arguments.length;e>d&&!(a=arguments[d].initialize);d++);return a=a||function(){b.apply(this,arguments)},a.prototype=j(this.prototype),m(a.prototype,"constructor",{value:a,writable:!0,configurable:!0}),c(a,this,!0),arguments.length?this.inject.apply(a,arguments):a}},!0).inject({inject:function(){for(var a=0,b=arguments.length;b>a;a++)c(this,arguments[a],arguments[a].enumerable);return this},extend:function(){var a=j(this);return a.inject.apply(a,arguments)},each:function(a,b){return d(this,a,b)},clone:function(){return new this.constructor(this)},statics:{each:d,create:j,define:m,describe:k,copy:e,clone:function(a){return e(new a.constructor,a)},isPlainObject:function(a){var c=null!=a&&a.constructor;return c&&(c===Object||c===b||"Object"===c.name)},pick:function(){for(var b=0,c=arguments.length;c>b;b++)if(arguments[b]!==a)return arguments[b];return null}}})};"undefined"!=typeof module&&(module.exports=b),b.inject({generics:!0,toString:function(){return null!=this._id?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+b.each(this,function(a,b){if(!/^_/.test(b)){var c=typeof a;this.push(b+": "+("number"===c?f.instance.number(a):"string"===c?"'"+a+"'":a))}},[]).join(", ")+" }"},exportJSON:function(a){return b.exportJSON(this,a)},toJSON:function(){return b.serialize(this)},_set:function(c,d){if(c&&b.isPlainObject(c)){var e=c._filtering||c;for(var f in e)if(f in this&&e.hasOwnProperty(f)&&(!d||!d[f])){var g=c[f];g!==a&&(this[f]=g)}return!0}},statics:{exports:{},extend:function db(){var a=db.base.apply(this,arguments),c=a.prototype._class;return c&&!b.exports[c]&&(b.exports[c]=a),a},equals:function(a,c){function d(a,b){for(var c in a)if(a.hasOwnProperty(c)&&!b.hasOwnProperty(c))return!1;return!0}if(a===c)return!0;if(a&&a.equals)return a.equals(c);if(c&&c.equals)return c.equals(a);if(Array.isArray(a)&&Array.isArray(c)){if(a.length!==c.length)return!1;for(var e=0,f=a.length;f>e;e++)if(!b.equals(a[e],c[e]))return!1;return!0}if(a&&"object"==typeof a&&c&&"object"==typeof c){if(!d(a,c)||!d(c,a))return!1;for(var e in a)if(a.hasOwnProperty(e)&&!b.equals(a[e],c[e]))return!1;return!0}return!1},read:function(a,c,d,e){if(this===b){var f=this.peek(a,c);return a._index++,a.__read=1,f}var g=this.prototype,h=g._readIndex,i=c||h&&a._index||0;d||(d=a.length-i);var j=a[i];return j instanceof this||e&&e.readNull&&null==j&&1>=d?(h&&(a._index=i+1),j&&e&&e.clone?j.clone():j):(j=b.create(this.prototype),h&&(j.__read=!0),e&&(j.__options=e),j=j.initialize.apply(j,i>0||d<a.length?Array.prototype.slice.call(a,i,i+d):a)||j,h&&(a._index=i+j.__read,a.__read=j.__read,delete j.__read,e&&delete j.__options),j)},peek:function(a,b){return a[a._index=b||a._index||0]},readAll:function(a,b,c){for(var d,e=[],f=b||0,g=a.length;g>f;f++)e.push(Array.isArray(d=a[f])?this.read(d,0,0,c):this.read(a,f,1,c));return e},readNamed:function(c,d,e,f,g){var h=this.getNamed(c,d),i=h!==a;if(i){var j=c._filtered;j||(j=c._filtered=b.create(c[0]),j._filtering=c[0]),j[d]=a}return this.read(i?[h]:c,e,f,g)},getNamed:function(c,d){var e=c[0];return c._hasObject===a&&(c._hasObject=1===c.length&&b.isPlainObject(e)),c._hasObject?d?e[d]:c._filtered||e:a},hasNamed:function(a,b){return!!this.getNamed(a,b)},isPlainValue:function(a){return this.isPlainObject(a)||Array.isArray(a)},serialize:function(a,c,d,e){c=c||{};var g,h=!e;if(h&&(c.formatter=new f(c.precision),e={length:0,definitions:{},references:{},add:function(a,b){var c="#"+a._id,d=this.references[c];if(!d){this.length++;var e=b.call(a),f=a._class;f&&e[0]!==f&&e.unshift(f),this.definitions[c]=e,d=this.references[c]=[c]}return d}}),a&&a._serialize){g=a._serialize(c,e);var i=a._class;!i||d||g._compact||g[0]===i||g.unshift(i)}else if(Array.isArray(a)){g=[];for(var j=0,k=a.length;k>j;j++)g[j]=b.serialize(a[j],c,d,e);d&&(g._compact=!0)}else if(b.isPlainObject(a)){g={};for(var j in a)a.hasOwnProperty(j)&&(g[j]=b.serialize(a[j],c,d,e))}else g="number"==typeof a?c.formatter.number(a,c.precision):a;return h&&e.length>0?[["dictionary",e.definitions],g]:g},deserialize:function(a,c,d){var e=a;if(d=d||{},Array.isArray(a)){var f=a[0],g="dictionary"===f;if(!g){if(d.dictionary&&1==a.length&&/^#/.test(f))return d.dictionary[f];f=b.exports[f]}e=[];for(var h=f?1:0,i=a.length;i>h;h++)e.push(b.deserialize(a[h],c,d));if(g)d.dictionary=e[0];else if(f){var j=e;c?e=c(f,j):(e=b.create(f.prototype),f.apply(e,j))}}else if(b.isPlainObject(a)){e={};for(var k in a)e[k]=b.deserialize(a[k],c,d)}return e},exportJSON:function(a,c){return JSON.stringify(b.serialize(a,c))},importJSON:function(a,c){return b.deserialize("string"==typeof a?JSON.parse(a):a,function(a,d){var e=c&&c.constructor===a?c:b.create(a.prototype),f=e===c;if(1===d.length&&e instanceof t&&(!(e instanceof v)||f)){var g=d[0];b.isPlainObject(g)&&(g.insert=!1)}return a.apply(e,d),f&&(c=null),e})},splice:function(b,c,d,e){var f=c&&c.length,g=d===a;d=g?b.length:d,d>b.length&&(d=b.length);for(var h=0;f>h;h++)c[h]._index=d+h;if(g)return b.push.apply(b,c),[];var i=[d,e];c&&i.push.apply(i,c);for(var j=b.splice.apply(b,i),h=0,k=j.length;k>h;h++)delete j[h]._index;for(var h=d+f,k=b.length;k>h;h++)b[h]._index=h;return j},capitalize:function(a){return a.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},camelize:function(a){return a.replace(/-(.)/g,function(a,b){return b.toUpperCase()})},hyphenate:function(a){return a.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var c={attach:function(c,d){if("string"!=typeof c)return b.each(c,function(a,b){this.attach(b,a)},this),a;var e=this._eventTypes[c];if(e){var f=this._handlers=this._handlers||{};f=f[c]=f[c]||[],-1==f.indexOf(d)&&(f.push(d),e.install&&1==f.length&&e.install.call(this,c))}},detach:function(c,d){if("string"!=typeof c)return b.each(c,function(a,b){this.detach(b,a)},this),a;var e,f=this._eventTypes[c],g=this._handlers&&this._handlers[c];f&&g&&(!d||-1!=(e=g.indexOf(d))&&1==g.length?(f.uninstall&&f.uninstall.call(this,c),delete this._handlers[c]):-1!=e&&g.splice(e,1))},once:function(a,b){this.attach(a,function(){b.apply(this,arguments),this.detach(a,b)})},fire:function(a,b){function c(){for(var a in d)d[a].apply(h,e)===!1&&b&&b.stop&&b.stop()}var d=this._handlers&&this._handlers[a];if(!d)return!1;var e=[].slice.call(arguments,1),f=paper.PaperScript,g=f&&f.handleException,h=this;if(g)try{c()}catch(i){g(i)}else c();return!0},responds:function(a){return!(!this._handlers||!this._handlers[a])},on:"#attach",off:"#detach",trigger:"#fire",statics:{inject:function eb(){for(var a=0,c=arguments.length;c>a;a++){var d=arguments[a],e=d._events;if(e){var f={};b.each(e,function(a,c){var e="string"==typeof a,g=e?a:c,h=b.capitalize(g),i=g.substring(2).toLowerCase();f[i]=e?{}:a,g="_"+g,d["get"+h]=function(){return this[g]},d["set"+h]=function(a){a?this.attach(i,a):this[g]&&this.detach(i,this[g]),this[g]=a}}),d._eventTypes=f}eb.base.call(this,d)}return this}}},d=b.extend({_class:"PaperScope",initialize:function fb(a){if(paper=this,this.project=null,this.projects=[],this.tools=[],this.palettes=[],this._id=a&&(a.getAttribute("id")||a.src)||"paperscope-"+fb._id++,a&&a.setAttribute("id",this._id),fb._scopes[this._id]=this,!this.support){var b=_.getContext(1,1);fb.prototype.support={nativeDash:"setLineDash"in b||"mozDash"in b,nativeBlendModes:ab.nativeModes},_.release(b)}},version:"0.9.15",getView:function(){return this.project&&this.project.view},getTool:function(){return this._tool||(this._tool=new Z),this._tool},getPaper:function(){return this},evaluate:function(a){var b=paper.PaperScript.evaluate(a,this);return R.updateFocus(),b},install:function(a){var c=this;b.each(["project","view","tool"],function(d){b.define(a,d,{configurable:!0,get:function(){return c[d]}})});for(var d in this)/^(version|_id)/.test(d)||(a[d]=this[d])},setup:function(a){return paper=this,this.project=new r(a),this},activate:function(){paper=this},clear:function(){for(var a=this.projects.length-1;a>=0;a--)this.projects[a].remove();for(var a=this.tools.length-1;a>=0;a--)this.tools[a].remove();for(var a=this.palettes.length-1;a>=0;a--)this.palettes[a].remove()},remove:function(){this.clear(),delete d._scopes[this._id]},statics:new function(){function a(a){return a+="Attribute",function(b,c){return b[a](c)||b[a]("data-paper-"+c)}}return{_scopes:{},_id:0,get:function(a){return"object"==typeof a&&(a=a.getAttribute("id")),this._scopes[a]||null},getAttribute:a("get"),hasAttribute:a("has")}}}),e=b.extend(c,{initialize:function(a){this._scope=paper,this._index=this._scope[this._list].push(this)-1,(a||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var a=this._scope[this._reference];return a&&a!==this&&a.fire("deactivate"),this._scope[this._reference]=this,this.fire("activate",a),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return null==this._index?!1:(b.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)}}),f=b.extend({initialize:function(a){this.precision=a||5,this.multiplier=Math.pow(10,this.precision)},number:function(a){return Math.round(a*this.multiplier)/this.multiplier},point:function(a,b){return this.number(a.x)+(b||",")+this.number(a.y)},size:function(a,b){return this.number(a.width)+(b||",")+this.number(a.height)},rectangle:function(a,b){return this.point(a,b)+(b||",")+this.size(a,b)}});f.instance=new f;var g=new function(){var b=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],c=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],d=Math.abs,e=Math.sqrt,f=Math.pow,h=Math.cos,i=Math.PI;return{TOLERANCE:1e-5,EPSILON:1e-11,KAPPA:4*(e(2)-1)/3,isZero:function(a){return d(a)<=g.EPSILON},integrate:function(a,d,e,f){for(var g=b[f-2],h=c[f-2],i=.5*(e-d),j=i+d,k=0,l=f+1>>1,m=1&f?h[k++]*a(j):0;l>k;){var n=i*g[k];m+=h[k++]*(a(j+n)+a(j-n))}return i*m},findRoot:function(a,b,c,e,f,g,h){for(var i=0;g>i;i++){var j=a(c),k=j/b(c);if(d(k)<h)return c;var l=c-k;j>0?(f=c,c=e>=l?.5*(e+f):l):(e=c,c=l>=f?.5*(e+f):l)}},solveQuadratic:function(b,c,f,h,i,j){function k(a){return(m||a>n&&o>a)&&(h[p++]=i>a?i:a>j?j:a),p}var l=g.EPSILON,m=i===a,n=i-l,o=j+l,p=0;if(d(b)<l)return d(c)>=l?k(-f/c):d(f)<l?-1:0;var q=c/(2*b),r=f/b,s=q*q;if(r-l>s)return 0;var t=s>r?e(s-r):0;return k(t-q),t>0&&k(-t-q),p},solveCubic:function(b,c,j,k,l,m,n){function o(a){return(q||a>r&&s>a)&&(l[t++]=m>a?m:a>n?n:a),t}var p=g.EPSILON;if(d(b)<p)return g.solveQuadratic(c,j,k,l,m,n);var q=m===a,r=m-p,s=n+p,t=0;c/=b,j/=b,k/=b;var u=c*c,v=(u-3*j)/9,w=(2*u*c-9*c*j+27*k)/54,x=v*v*v,y=w*w-x;if(c/=3,d(y)<p){if(d(w)<p)return o(-c);var z=e(v),A=w>0?1:-1;return o(2*-A*z-c),o(A*z-c)}if(0>y){var z=e(v),B=Math.acos(w/(z*z*z))/3,C=-2*z,D=2*i/3;return o(C*h(B)-c),o(C*h(B+D)-c),o(C*h(B-D)-c)}var E=(w>0?-1:1)*f(d(w)+e(y),1/3);return o(E+v/E-c)}}},h=b.extend({_class:"Point",_readIndex:!0,initialize:function(a,b){var c=typeof a;if("number"===c){var d="number"==typeof b;this.x=a,this.y=d?b:a,this.__read&&(this.__read=d?2:1)}else"undefined"===c||null===a?(this.x=this.y=0,this.__read&&(this.__read=null===a?1:0)):(Array.isArray(a)?(this.x=a[0],this.y=a.length>1?a[1]:a[0]):null!=a.x?(this.x=a.x,this.y=a.y):null!=a.width?(this.x=a.width,this.y=a.height):null!=a.angle?(this.x=a.length,this.y=0,this.setAngle(a.angle)):(this.x=this.y=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(a,b){return this.x=a,this.y=b,this},equals:function(a){return a===this||a&&(this.x===a.x&&this.y===a.y||Array.isArray(a)&&this.x===a[0]&&this.y===a[1])||!1},clone:function(){return new h(this.x,this.y)},toString:function(){var a=f.instance;return"{ x: "+a.number(this.x)+", y: "+a.number(this.y)+" }"},_serialize:function(a){var b=a.formatter;return[b.number(this.x),b.number(this.y)]},add:function(a){return a=h.read(arguments),new h(this.x+a.x,this.y+a.y)},subtract:function(a){return a=h.read(arguments),new h(this.x-a.x,this.y-a.y)},multiply:function(a){return a=h.read(arguments),new h(this.x*a.x,this.y*a.y)},divide:function(a){return a=h.read(arguments),new h(this.x/a.x,this.y/a.y)},modulo:function(a){return a=h.read(arguments),new h(this.x%a.x,this.y%a.y)},negate:function(){return new h(-this.x,-this.y)},transform:function(a){return a?a._transformPoint(this):this},getDistance:function(a,b){a=h.read(arguments);var c=a.x-this.x,d=a.y-this.y,e=c*c+d*d;return b?e:Math.sqrt(e)},getLength:function(){var a=this.x*this.x+this.y*this.y;return arguments.length&&arguments[0]?a:Math.sqrt(a)},setLength:function(a){if(this.isZero()){var b=this._angle||0;this.set(Math.cos(b)*a,Math.sin(b)*a)}else{var c=a/this.getLength();g.isZero(c)&&this.getAngle(),this.set(this.x*c,this.y*c)}return this},normalize:function(b){b===a&&(b=1);var c=this.getLength(),d=0!==c?b/c:0,e=new h(this.x*d,this.y*d);return e._angle=this._angle,e},getAngle:function(){return 180*this.getAngleInRadians(arguments[0])/Math.PI},setAngle:function(a){if(a=this._angle=a*Math.PI/180,!this.isZero()){var b=this.getLength();this.set(Math.cos(a)*b,Math.sin(a)*b)}return this},getAngleInRadians:function(){if(arguments[0]===a)return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x);var b=h.read(arguments),c=this.getLength()*b.getLength();return g.isZero(c)?0/0:Math.acos(this.dot(b)/c)},getAngleInDegrees:function(){return this.getAngle(arguments[0])},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3},getDirectedAngle:function(a){return a=h.read(arguments),180*Math.atan2(this.cross(a),this.dot(a))/Math.PI},rotate:function(a,b){if(0===a)return this.clone();a=a*Math.PI/180;var c=b?this.subtract(b):this,d=Math.sin(a),e=Math.cos(a);return c=new h(c.x*e-c.y*d,c.y*e+c.x*d),b?c.add(b):c},isInside:function(a){return a.contains(this)},isClose:function(a,b){return this.getDistance(a)<b},isColinear:function(a){return this.cross(a)<1e-5},isOrthogonal:function(a){return this.dot(a)<1e-5},isZero:function(){return g.isZero(this.x)&&g.isZero(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},dot:function(a){return a=h.read(arguments),this.x*a.x+this.y*a.y},cross:function(a){return a=h.read(arguments),this.x*a.y-this.y*a.x},project:function(a){if(a=h.read(arguments),a.isZero())return new h(0,0);var b=this.dot(a)/a.dot(a);return new h(a.x*b,a.y*b)},statics:{min:function(){var a=h.read(arguments);return point2=h.read(arguments),new h(Math.min(a.x,point2.x),Math.min(a.y,point2.y))},max:function(){var a=h.read(arguments);return point2=h.read(arguments),new h(Math.max(a.x,point2.x),Math.max(a.y,point2.y))},random:function(){return new h(Math.random(),Math.random())}}},b.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return new h(b(this.x),b(this.y))}},{})),j=h.extend({initialize:function(a,b,c,d){this._x=a,this._y=b,this._owner=c,this._setter=d},set:function(a,b,c){return this._x=a,this._y=b,c||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(a){this._x=a,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(a){this._y=a,this._owner[this._setter](this)}}),k=b.extend({_class:"Size",_readIndex:!0,initialize:function(a,b){var c=typeof a;if("number"===c){var d="number"==typeof b;this.width=a,this.height=d?b:a,this.__read&&(this.__read=d?2:1)}else"undefined"===c||null===a?(this.width=this.height=0,this.__read&&(this.__read=null===a?1:0)):(Array.isArray(a)?(this.width=a[0],this.height=a.length>1?a[1]:a[0]):null!=a.width?(this.width=a.width,this.height=a.height):null!=a.x?(this.width=a.x,this.height=a.y):(this.width=this.height=0,this.__read&&(this.__read=0)),this.__read&&(this.__read=1))},set:function(a,b){return this.width=a,this.height=b,this},equals:function(a){return a===this||a&&(this.width===a.width&&this.height===a.height||Array.isArray(a)&&this.width===a[0]&&this.height===a[1])||!1},clone:function(){return new k(this.width,this.height)},toString:function(){var a=f.instance;return"{ width: "+a.number(this.width)+", height: "+a.number(this.height)+" }"},_serialize:function(a){var b=a.formatter;return[b.number(this.width),b.number(this.height)]},add:function(a){return a=k.read(arguments),new k(this.width+a.width,this.height+a.height)},subtract:function(a){return a=k.read(arguments),new k(this.width-a.width,this.height-a.height)},multiply:function(a){return a=k.read(arguments),new k(this.width*a.width,this.height*a.height)},divide:function(a){return a=k.read(arguments),new k(this.width/a.width,this.height/a.height)},modulo:function(a){return a=k.read(arguments),new k(this.width%a.width,this.height%a.height)},negate:function(){return new k(-this.width,-this.height)},isZero:function(){return g.isZero(this.width)&&g.isZero(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(a,b){return new k(Math.min(a.width,b.width),Math.min(a.height,b.height))},max:function(a,b){return new k(Math.max(a.width,b.width),Math.max(a.height,b.height))},random:function(){return new k(Math.random(),Math.random())}}},b.each(["round","ceil","floor","abs"],function(a){var b=Math[a];this[a]=function(){return new k(b(this.width),b(this.height))}},{})),m=k.extend({initialize:function(a,b,c,d){this._width=a,this._height=b,this._owner=c,this._setter=d},set:function(a,b,c){return this._width=a,this._height=b,c||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(a){this._width=a,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(a){this._height=a,this._owner[this._setter](this)}}),n=b.extend({_class:"Rectangle",_readIndex:!0,initialize:function(c,d,e,f){var g=typeof c,i=0;if("number"===g?(this.x=c,this.y=d,this.width=e,this.height=f,i=4):"undefined"===g||null===c?(this.x=this.y=this.width=this.height=0,i=null===c?1:0):1===arguments.length&&(Array.isArray(c)?(this.x=c[0],this.y=c[1],this.width=c[2],this.height=c[3],i=1):c.x!==a||c.width!==a?(this.x=c.x||0,this.y=c.y||0,this.width=c.width||0,this.height=c.height||0,i=1):c.from===a&&c.to===a&&(this.x=this.y=this.width=this.height=0,this._set(c),i=1)),!i){var j=h.readNamed(arguments,"from"),l=b.peek(arguments);if(this.x=j.x,this.y=j.y,l&&l.x!==a||b.hasNamed(arguments,"to")){var m=h.readNamed(arguments,"to");this.width=m.x-j.x,this.height=m.y-j.y,this.width<0&&(this.x=m.x,this.width=-this.width),this.height<0&&(this.y=m.y,this.height=-this.height)}else{var n=k.read(arguments);this.width=n.width,this.height=n.height}i=arguments._index}this.__read&&(this.__read=i)},set:function(a,b,c,d){return this.x=a,this.y=b,this.width=c,this.height=d,this},clone:function(){return new n(this.x,this.y,this.width,this.height)},equals:function(a){return b.isPlainValue(a)&&(a=n.read(arguments)),a===this||a&&this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height||!1},toString:function(){var a=f.instance;return"{ x: "+a.number(this.x)+", y: "+a.number(this.y)+", width: "+a.number(this.width)+", height: "+a.number(this.height)+" }"},_serialize:function(a){var b=a.formatter;return[b.number(this.x),b.number(this.y),b.number(this.width),b.number(this.height)]},getPoint:function(){return new(arguments[0]?h:j)(this.x,this.y,this,"setPoint")},setPoint:function(a){a=h.read(arguments),this.x=a.x,this.y=a.y},getSize:function(){return new(arguments[0]?k:m)(this.width,this.height,this,"setSize")},setSize:function(a){a=k.read(arguments),this._fixX&&(this.x+=(this.width-a.width)*this._fixX),this._fixY&&(this.y+=(this.height-a.height)*this._fixY),this.width=a.width,this.height=a.height,this._fixW=1,this._fixH=1},getLeft:function(){return this.x},setLeft:function(a){this._fixW||(this.width-=a-this.x),this.x=a,this._fixX=0},getTop:function(){return this.y},setTop:function(a){this._fixH||(this.height-=a-this.y),this.y=a,this._fixY=0},getRight:function(){return this.x+this.width},setRight:function(b){this._fixX!==a&&1!==this._fixX&&(this._fixW=0),this._fixW?this.x=b-this.width:this.width=b-this.x,this._fixX=1},getBottom:function(){return this.y+this.height},setBottom:function(b){this._fixY!==a&&1!==this._fixY&&(this._fixH=0),this._fixH?this.y=b-this.height:this.height=b-this.y,this._fixY=1},getCenterX:function(){return this.x+.5*this.width},setCenterX:function(a){this.x=a-.5*this.width,this._fixX=.5},getCenterY:function(){return this.y+.5*this.height},setCenterY:function(a){this.y=a-.5*this.height,this._fixY=.5},getCenter:function(){return new(arguments[0]?h:j)(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(a){return a=h.read(arguments),this.setCenterX(a.x),this.setCenterY(a.y),this},isEmpty:function(){return 0==this.width||0==this.height},contains:function(b){return b&&b.width!==a||4==(Array.isArray(b)?b:arguments).length?this._containsRectangle(n.read(arguments)):this._containsPoint(h.read(arguments))},_containsPoint:function(a){var b=a.x,c=a.y;return b>=this.x&&c>=this.y&&b<=this.x+this.width&&c<=this.y+this.height},_containsRectangle:function(a){var b=a.x,c=a.y;return b>=this.x&&c>=this.y&&b+a.width<=this.x+this.width&&c+a.height<=this.y+this.height},intersects:function(a){return a=n.read(arguments),a.x+a.width>this.x&&a.y+a.height>this.y&&a.x<this.x+this.width&&a.y<this.y+this.height},touches:function(a){return a=n.read(arguments),a.x+a.width>=this.x&&a.y+a.height>=this.y&&a.x<=this.x+this.width&&a.y<=this.y+this.height},intersect:function(a){a=n.read(arguments);var b=Math.max(this.x,a.x),c=Math.max(this.y,a.y),d=Math.min(this.x+this.width,a.x+a.width),e=Math.min(this.y+this.height,a.y+a.height);return new n(b,c,d-b,e-c)},unite:function(a){a=n.read(arguments);var b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x+a.width),e=Math.max(this.y+this.height,a.y+a.height);return new n(b,c,d-b,e-c)},include:function(a){a=h.read(arguments);var b=Math.min(this.x,a.x),c=Math.min(this.y,a.y),d=Math.max(this.x+this.width,a.x),e=Math.max(this.y+this.height,a.y);return new n(b,c,d-b,e-c)},expand:function(b,c){return c===a&&(c=b),new n(this.x-b/2,this.y-c/2,this.width+b,this.height+c)},scale:function(b,c){return this.expand(this.width*b-this.width,this.height*(c===a?b:c)-this.height)}},new function(){return b.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(a,b){var c=a.join(""),d=/^[RL]/.test(c);b>=4&&(a[1]+=d?"Y":"X");var e=a[d?0:1],f=a[d?1:0],g="get"+e,i="get"+f,k="set"+e,l="set"+f,m="get"+c,n="set"+c;this[m]=function(){return new(arguments[0]?h:j)(this[g](),this[i](),this,n)},this[n]=function(a){a=h.read(arguments),this[k](a.x),this[l](a.y)}},{})}),o=n.extend({initialize:function(a,b,c,d,e,f){this.set(a,b,c,d,!0),this._owner=e,this._setter=f},set:function(a,b,c,d,e){return this._x=a,this._y=b,this._width=c,this._height=d,e||this._owner[this._setter](this),this}},new function(){var a=n.prototype;return b.each(["x","y","width","height"],function(a){var c=b.capitalize(a),d="_"+a;this["get"+c]=function(){return this[d]},this["set"+c]=function(a){this[d]=a,this._dontNotify||this._owner[this._setter](this)}},b.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(b){var c="set"+b;this[c]=function(){this._dontNotify=!0,a[c].apply(this,arguments),delete this._dontNotify,this._owner[this._setter](this)}},{isSelected:function(){return this._owner._boundsSelected},setSelected:function(a){var b=this._owner;b.setSelected&&(b._boundsSelected=a,b.setSelected(a||b._selectedSegmentState>0))}}))}),p=b.extend({_class:"Matrix",initialize:function gb(a){var b=arguments.length,c=!0;if(6===b?this.set.apply(this,arguments):1===b?a instanceof gb?this.set(a._a,a._c,a._b,a._d,a._tx,a._ty):Array.isArray(a)?this.set.apply(this,a):c=!1:0===b?this.reset():c=!1,!c)throw Error("Unsupported matrix parameters")},set:function(a,b,c,d,e,f,g){return this._a=a,this._c=b,this._b=c,this._d=d,this._tx=e,this._ty=f,g||this._changed(),this},_serialize:function(a){return b.serialize(this.getValues(),a)},_changed:function(){this._owner&&this._owner._changed(5)},clone:function(){return new p(this._a,this._c,this._b,this._d,this._tx,this._ty)},equals:function(a){return a===this||a&&this._a===a._a&&this._b===a._b&&this._c===a._c&&this._d===a._d&&this._tx===a._tx&&this._ty===a._ty||!1},toString:function(){var a=f.instance;return"[["+[a.number(this._a),a.number(this._b),a.number(this._tx)].join(", ")+"], ["+[a.number(this._c),a.number(this._d),a.number(this._ty)].join(", ")+"]]"},reset:function(){return this._a=this._d=1,this._c=this._b=this._tx=this._ty=0,this._changed(),this},scale:function(){var a=h.read(arguments),b=h.read(arguments,0,0,{readNull:!0});return b&&this.translate(b),this._a*=a.x,this._c*=a.x,this._b*=a.y,this._d*=a.y,b&&this.translate(b.negate()),this._changed(),this},translate:function(a){a=h.read(arguments);var b=a.x,c=a.y;return this._tx+=b*this._a+c*this._b,this._ty+=b*this._c+c*this._d,this._changed(),this},rotate:function(a,b){b=h.read(arguments,1),a=a*Math.PI/180;var c=b.x,d=b.y,e=Math.cos(a),f=Math.sin(a),g=c-c*e+d*f,i=d-c*f-d*e,j=this._a,k=this._b,l=this._c,m=this._d;return this._a=e*j+f*k,this._b=-f*j+e*k,this._c=e*l+f*m,this._d=-f*l+e*m,this._tx+=g*j+i*k,this._ty+=g*l+i*m,this._changed(),this},shear:function(){var a=h.read(arguments),b=h.read(arguments,0,0,{readNull:!0});b&&this.translate(b);var c=this._a,d=this._c;return this._a+=a.y*this._b,this._c+=a.y*this._d,this._b+=a.x*c,this._d+=a.x*d,b&&this.translate(b.negate()),this._changed(),this},concatenate:function(a){var b=this._a,c=this._b,d=this._c,e=this._d;return this._a=a._a*b+a._c*c,this._b=a._b*b+a._d*c,this._c=a._a*d+a._c*e,this._d=a._b*d+a._d*e,this._tx+=a._tx*b+a._ty*c,this._ty+=a._tx*d+a._ty*e,this._changed(),this},preConcatenate:function(a){var b=this._a,c=this._b,d=this._c,e=this._d,f=this._tx,g=this._ty;return this._a=a._a*b+a._b*d,this._b=a._a*c+a._b*e,this._c=a._c*b+a._d*d,this._d=a._c*c+a._d*e,this._tx=a._a*f+a._b*g+a._tx,this._ty=a._c*f+a._d*g+a._ty,this._changed(),this},isIdentity:function(){return 1===this._a&&0===this._c&&0===this._b&&1===this._d&&0===this._tx&&0===this._ty},isInvertible:function(){return!!this._getDeterminant()},isSingular:function(){return!this._getDeterminant()},transform:function(a,b,c,d,e){return arguments.length<5?this._transformPoint(h.read(arguments)):this._transformCoordinates(a,b,c,d,e)},_transformPoint:function(a,b,c){var d=a.x,e=a.y;return b||(b=new h),b.set(d*this._a+e*this._b+this._tx,d*this._c+e*this._d+this._ty,c)},_transformCoordinates:function(a,b,c,d,e){for(var f=b,g=d,h=f+2*e;h>f;){var i=a[f++],j=a[f++];c[g++]=i*this._a+j*this._b+this._tx,c[g++]=i*this._c+j*this._d+this._ty}return c},_transformCorners:function(a){var b=a.x,c=a.y,d=b+a.width,e=c+a.height,f=[b,c,d,c,d,e,b,e];
return this._transformCoordinates(f,0,f,0,4)},_transformBounds:function(a,b,c){for(var d=this._transformCorners(a),e=d.slice(0,2),f=d.slice(),g=2;8>g;g++){var h=d[g],i=1&g;h<e[i]?e[i]=h:h>f[i]&&(f[i]=h)}return b||(b=new n),b.set(e[0],e[1],f[0]-e[0],f[1]-e[1],c)},inverseTransform:function(){return this._inverseTransform(h.read(arguments))},_getDeterminant:function(){var a=this._a*this._d-this._b*this._c;return isFinite(a)&&!g.isZero(a)&&isFinite(this._tx)&&isFinite(this._ty)?a:null},_inverseTransform:function(a,b,c){var d=this._getDeterminant();if(!d)return null;var e=a.x-this._tx,f=a.y-this._ty;return b||(b=new h),b.set((e*this._d-f*this._b)/d,(f*this._a-e*this._c)/d,c)},decompose:function(){var a=this._a,b=this._b,c=this._c,d=this._d;if(g.isZero(a*d-b*c))return null;var e=Math.sqrt(a*a+b*b);a/=e,b/=e;var f=a*c+b*d;c-=a*f,d-=b*f;var i=Math.sqrt(c*c+d*d);return c/=i,d/=i,f/=i,b*c>a*d&&(a=-a,b=-b,f=-f,e=-e),{translation:this.getTranslation(),scaling:new h(e,i),rotation:180*-Math.atan2(b,a)/Math.PI,shearing:f}},getValues:function(){return[this._a,this._c,this._b,this._d,this._tx,this._ty]},getTranslation:function(){return new h(this._tx,this._ty)},setTranslation:function(){var a=h.read(arguments);this._tx=a.x,this._ty=a.y,this._changed()},getScaling:function(){return(this.decompose()||{}).scaling},setScaling:function(){var a=this.getScaling();if(null!=a){var b=h.read(arguments);(this._owner||this).scale(b.x/a.x,b.y/a.y)}},getRotation:function(){return(this.decompose()||{}).rotation},setRotation:function(a){var b=this.getRotation();null!=b&&(this._owner||this).rotate(a-b)},inverted:function(){var a=this._getDeterminant();return a&&new p(this._d/a,-this._c/a,-this._b/a,this._a/a,(this._b*this._ty-this._d*this._tx)/a,(this._c*this._tx-this._a*this._ty)/a)},shiftless:function(){return new p(this._a,this._c,this._b,this._d,0,0)},applyToContext:function(a){a.transform(this._a,this._c,this._b,this._d,this._tx,this._ty)}},new function(){return b.each({scaleX:"_a",scaleY:"_d",translateX:"_tx",translateY:"_ty",shearX:"_b",shearY:"_c"},function(a,c){c=b.capitalize(c),this["get"+c]=function(){return this[a]},this["set"+c]=function(b){this[a]=b,this._changed()}},{})}),q=b.extend({_class:"Line",initialize:function(a,b,c,d,e){var f=!1;arguments.length>=4?(this._px=a,this._py=b,this._vx=c,this._vy=d,f=e):(this._px=a.x,this._py=a.y,this._vx=b.x,this._vy=b.y,f=c),f||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new h(this._px,this._py)},getVector:function(){return new h(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(a,b){return q.intersect(this._px,this._py,this._vx,this._vy,a._px,a._py,a._vx,a._vy,!0,b)},getSide:function(a){return q.getSide(this._px,this._py,this._vx,this._vy,a.x,a.y,!0)},getDistance:function(a){return Math.abs(q.getSignedDistance(this._px,this._py,this._vx,this._vy,a.x,a.y,!0))},statics:{intersect:function(a,b,c,d,e,f,i,j,k,l){k||(c-=a,d-=b,i-=e,j-=f);var m=j*c-i*d;if(!g.isZero(m)){var n=a-e,o=b-f,p=(i*o-j*n)/m,q=(c*o-d*n)/m;if((l||p>=0&&1>=p)&&(l||q>=0&&1>=q))return new h(a+p*c,b+p*d)}},getSide:function(a,b,c,d,e,f,g){g||(c-=a,d-=b);var h=e-a,i=f-b,j=h*d-i*c;return 0===j&&(j=h*c+i*d,j>0&&(h-=c,i-=d,j=h*c+i*d,0>j&&(j=0))),0>j?-1:j>0?1:0},getSignedDistance:function(a,b,c,d,e,f,g){g||(c-=a,d-=b);var h=d/c,i=b-h*a;return(f-h*e-i)/Math.sqrt(h*h+1)}}}),r=e.extend({_class:"Project",_list:"projects",_reference:"project",initialize:function(a){e.call(this,!0),this.layers=[],this.symbols=[],this._currentStyle=new O,this.activeLayer=new v,a&&(this.view=a instanceof R?a:R.create(a)),this._selectedItems={},this._selectedItemCount=0,this._drawCount=0,this.options={}},_serialize:function(a,c){return b.serialize(this.layers,a,!0,c)},clear:function(){for(var a=this.layers.length-1;a>=0;a--)this.layers[a].remove();this.symbols=[]},isEmpty:function(){return this.layers.length<=1&&(!this.activeLayer||this.activeLayer.isEmpty())},remove:function hb(){return hb.base.call(this)?(this.view&&this.view.remove(),!0):!1},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(a){this._currentStyle.initialize(a)},getIndex:function(){return this._index},addChild:function(a){return a instanceof v?(b.splice(this.layers,[a]),this.activeLayer||(this.activeLayer=a)):a instanceof t?(this.activeLayer||this.addChild(new v({insert:!1}))).addChild(a):a=null,a},getSelectedItems:function(){var a=[];for(var b in this._selectedItems){var c=this._selectedItems[b];c.isInserted()&&a.push(c)}return a},_updateSelection:function(a){var b=a._id,c=this._selectedItems;a._selected?c[b]!==a&&(this._selectedItemCount++,c[b]=a):c[b]===a&&(this._selectedItemCount--,delete c[b])},selectAll:function(){for(var a=this.layers,b=0,c=a.length;c>b;b++)a[b].setFullySelected(!0)},deselectAll:function(){var a=this._selectedItems;for(var b in a)a[b].setFullySelected(!1)},hitTest:function(a,c){a=h.read(arguments),c=z.getOptions(b.read(arguments));for(var d=this.layers.length-1;d>=0;d--){var e=this.layers[d].hitTest(a,c);if(e)return e}return null}},new function(){function a(a,b,c){for(var d=a.layers,e=c&&[],f=0,g=d.length;g>f;f++){var h=d[f][c?"getItems":"getItem"](b);if(c)e.push.apply(e,h);else if(h)return h}return c?e:null}return{getItems:function(b){return a(this,b,!0)},getItem:function(b){return a(this,b,!1)}}},{importJSON:function(a){this.activate();var c=this.activeLayer;return b.importJSON(a,c&&c.isEmpty()&&c)},draw:function(a,c,d){this._drawCount++,a.save(),c.applyToContext(a);for(var e=new b({offset:new h(0,0),ratio:d,transforms:[c],trackTransforms:!0}),f=0,g=this.layers.length;g>f;f++)this.layers[f].draw(a,e);if(a.restore(),this._selectedItemCount>0){a.save(),a.strokeWidth=1;for(var i in this._selectedItems){var j=this._selectedItems[i];if(j._drawCount===this._drawCount&&(j._drawSelected||j._boundsSelected)){var k=j.getSelectedColor()||j.getLayer().getSelectedColor();a.strokeStyle=a.fillStyle=k?k.toCanvasStyle(a):"#009dec";var l=j._globalMatrix;if(j._drawSelected&&j._drawSelected(a,l),j._boundsSelected){var m=l._transformCorners(j._getBounds("getBounds"));a.beginPath();for(var f=0;8>f;f++)a[0===f?"moveTo":"lineTo"](m[f],m[++f]);a.closePath(),a.stroke();for(var f=0;8>f;f++)a.beginPath(),a.rect(m[f]-2,m[++f]-2,4,4),a.fill()}}}a.restore()}}}),s=b.extend({_class:"Symbol",initialize:function ib(a,b){this._id=ib._id=(ib._id||0)+1,this.project=paper.project,this.project.symbols.push(this),a&&this.setDefinition(a,b),this._instances={}},_serialize:function(a,c){return c.add(this,function(){return b.serialize([this._class,this._definition],a,!1,c)})},_changed:function(a){b.each(this._instances,function(b){b._changed(a)})},getDefinition:function(){return this._definition},setDefinition:function(a){a._parentSymbol&&(a=a.clone()),this._definition&&delete this._definition._parentSymbol,this._definition=a,a.remove(),a.setSelected(!1),arguments[1]||a.setPosition(new h),a._parentSymbol=this,this._changed(5)},place:function(a){return new y(this,a)},clone:function(){return new s(this._definition.clone(!1))}}),t=b.extend(c,{statics:{extend:function jb(a){a._serializeFields&&(a._serializeFields=new b(this.prototype._serializeFields,a._serializeFields));var c=jb.base.apply(this,arguments),d=c.prototype,e=d._class;return e&&(d._type=b.hyphenate(e)),c}},_class:"Item",_transformContent:!0,_boundsSelected:!1,_serializeFields:{name:null,matrix:new p,locked:!1,visible:!0,blendMode:"normal",opacity:1,guide:!1,selected:!1,clipMask:!1,data:{}},initialize:function(){},_initialize:function(a,b){if(this._id=t._id=(t._id||0)+1,!this._project){var c=paper.project;a&&a.insert===!1?this._setProject(c):(c.activeLayer||new v).addChild(this)}this._style=new O(this._project._currentStyle,this);var d=this._matrix=new p;return b&&d.translate(b),d._owner=this,a?this._set(a,{insert:!0}):!0},_events:new function(){var a={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}},c={install:function(b){var c=this._project.view._eventCounters;if(c)for(var d in a)c[d]=(c[d]||0)+(a[d][b]||0)},uninstall:function(b){var c=this._project.view._eventCounters;if(c)for(var d in a)c[d]-=a[d][b]||0}};return b.each(["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"],function(a){this[a]=c},{onFrame:{install:function(){this._animateItem(!0)},uninstall:function(){this._animateItem(!1)}},onLoad:{}})},_animateItem:function(a){this._project.view._animateItem(this,a)},_serialize:function(a,c){function d(d){for(var g in d){var h=f[g];b.equals(h,"leading"===g?1.2*d.fontSize:d[g])||(e[g]=b.serialize(h,a,"data"!==g,c))}}var e={},f=this;return d(this._serializeFields),this instanceof u||d(this._style._defaults),[this._class,e]},_changed:function(a){var b=this._parent,c=this._project,d=this._parentSymbol;if(this._drawCount=null,4&a&&(delete this._bounds,delete this._position),b&&12&a&&b._clearBoundsCache(),2&a&&this._clearBoundsCache(),c&&(1&a&&(c._needsRedraw=!0),c._changes)){var e=c._changesById[this._id];e?e.flags|=a:(e={item:this,flags:a},c._changesById[this._id]=e,c._changes.push(e))}d&&d._changed(a)},set:function(a){return a&&this._set(a),this},getId:function(){return this._id},getType:function(){return this._type},getName:function(){return this._name},setName:function(b,c){if(this._name&&this._removeNamed(),b===+b+"")throw Error("Names consisting only of numbers are not supported.");if(b&&this._parent){for(var d=this._parent._children,e=this._parent._namedChildren,f=b,g=1;c&&d[b];)b=f+" "+g++;(e[b]=e[b]||[]).push(this),d[b]=this}this._name=b||a,this._changed(32)},getStyle:function(){return this._style},setStyle:function(a){this.getStyle().set(a)},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()}},b.each(["locked","visible","blendMode","opacity","guide"],function(a){var c=b.capitalize(a),a="_"+a;this["get"+c]=function(){return this[a]},this["set"+c]=function(b){b!=this[a]&&(this[a]=b,this._changed("_locked"===a?32:33))}},{}),{_locked:!1,_visible:!0,_blendMode:"normal",_opacity:1,_guide:!1,isSelected:function(){if(this._children)for(var a=0,b=this._children.length;b>a;a++)if(this._children[a].isSelected())return!0;return this._selected},setSelected:function(a){if(this._children&&!arguments[1])for(var b=0,c=this._children.length;c>b;b++)this._children[b].setSelected(a);(a=!!a)!=this._selected&&(this._selected=a,this._project._updateSelection(this),this._changed(33))},_selected:!1,isFullySelected:function(){if(this._children&&this._selected){for(var a=0,b=this._children.length;b>a;a++)if(!this._children[a].isFullySelected())return!1;return!0}return this._selected},setFullySelected:function(a){if(this._children)for(var b=0,c=this._children.length;c>b;b++)this._children[b].setFullySelected(a);this.setSelected(a,!0)},isClipMask:function(){return this._clipMask},setClipMask:function(a){this._clipMask!=(a=!!a)&&(this._clipMask=a,a&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(33),this._parent&&this._parent._changed(256))},_clipMask:!1,getData:function(){return this._data||(this._data={}),this._data},setData:function(a){this._data=a},getPosition:function(){var a=this._position||(this._position=this.getBounds().getCenter(!0));return new(arguments[0]?h:j)(a.x,a.y,this,"setPosition")},setPosition:function(){this.translate(h.read(arguments).subtract(this.getPosition(!0)))}},b.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],function(a){this[a]=function(){var b=this._boundsGetter,c=this._getCachedBounds("string"==typeof b?b:b&&b[a]||a,arguments[0]);return"getBounds"===a?new o(c.x,c.y,c.width,c.height,this,"setBounds"):c}},{_getCachedBounds:function(a,b,c){var d=(!b||b.equals(this._matrix))&&a;if(c&&this._parent){var e=c._id,f=this._parent._boundsCache=this._parent._boundsCache||{ids:{},list:[]};f.ids[e]||(f.list.push(c),f.ids[e]=c)}if(d&&this._bounds&&this._bounds[d])return this._bounds[d].clone();var g=this._matrix.isIdentity();b=!b||b.isIdentity()?g?null:this._matrix:g?b:b.clone().concatenate(this._matrix);var h=this._getBounds(a,b,d?this:c);return d&&(this._bounds||(this._bounds={}),this._bounds[d]=h.clone()),h},_clearBoundsCache:function(){if(this._boundsCache){for(var a=0,b=this._boundsCache.list,c=b.length;c>a;a++){var d=b[a];delete d._bounds,d!=this&&d._boundsCache&&d._clearBoundsCache()}delete this._boundsCache}},_getBounds:function(a,b,c){var d=this._children;if(!d||0==d.length)return new n;for(var e=1/0,f=-e,g=e,h=f,i=0,j=d.length;j>i;i++){var k=d[i];if(k._visible&&!k.isEmpty()){var l=k._getCachedBounds(a,b,c);e=Math.min(l.x,e),g=Math.min(l.y,g),f=Math.max(l.x+l.width,f),h=Math.max(l.y+l.height,h)}}return isFinite(e)?new n(e,g,f-e,h-g):new n},setBounds:function(a){a=n.read(arguments);var b=this.getBounds(),c=new p,d=a.getCenter();c.translate(d),(a.width!=b.width||a.height!=b.height)&&c.scale(0!=b.width?a.width/b.width:1,0!=b.height?a.height/b.height:1),d=b.getCenter(),c.translate(-d.x,-d.y),this.transform(c)}}),{getMatrix:function(){return this._matrix},setMatrix:function(a){this._matrix.initialize(a),this._transformContent&&this.applyMatrix(!0),this._changed(5)},getGlobalMatrix:function(){return this._drawCount===this._project._drawCount&&this._globalMatrix||null},getTransformContent:function(){return this._transformContent},setTransformContent:function(a){this._transformContent=a,a&&this.applyMatrix()},getProject:function(){return this._project},_setProject:function(a){if(this._project!=a){var b=this.responds("frame");if(b&&this._animateItem(!1),this._project=a,b&&this._animateItem(!0),this._children)for(var c=0,d=this._children.length;d>c;c++)this._children[c]._setProject(a)}},getLayer:function(){for(var a=this;a=a._parent;)if(a instanceof v)return a;return null},getParent:function(){return this._parent},setParent:function(a){return a.addChild(this)},getChildren:function(){return this._children},setChildren:function(a){this.removeChildren(),this.addChildren(a)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){return this._parent&&this._parent._children[this._index+1]||null},getPreviousSibling:function(){return this._parent&&this._parent._children[this._index-1]||null},getIndex:function(){return this._index},isInserted:function(){return this._parent?this._parent.isInserted():!1},equals:function(a){return a===this||a&&this._class===a._class&&this._style.equals(a._style)&&this._matrix.equals(a._matrix)&&this._locked===a._locked&&this._visible===a._visible&&this._blendMode===a._blendMode&&this._opacity===a._opacity&&this._clipMask===a._clipMask&&this._guide===a._guide&&this._equals(a)||!1},_equals:function(a){return b.equals(this._children,a._children)},clone:function(a){return this._clone(new this.constructor({insert:!1}),a)},_clone:function(c,d){if(c.setStyle(this._style),this._children)for(var e=0,f=this._children.length;f>e;e++)c.addChild(this._children[e].clone(!1),!0);(d||d===a)&&c.insertAbove(this);for(var g=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],e=0,f=g.length;f>e;e++){var h=g[e];this.hasOwnProperty(h)&&(c[h]=this[h])}return c._matrix.initialize(this._matrix),c._data=this._data?b.clone(this._data):null,c.setSelected(this._selected),this._name&&c.setName(this._name,!0),c},copyTo:function(a){return a.addChild(this.clone(!1))},rasterize:function(a){var c=this.getStrokeBounds(),d=(a||72)/72,e=c.getTopLeft().floor(),f=c.getBottomRight().ceil();size=new k(f.subtract(e)),canvas=_.getCanvas(size),ctx=canvas.getContext("2d"),matrix=(new p).scale(d).translate(e.negate()),ctx.save(),matrix.applyToContext(ctx),this.draw(ctx,new b({transforms:[matrix]})),ctx.restore();var g=new x({canvas:canvas,insert:!1});return g.setPosition(e.add(size.divide(2))),g.insertAbove(this),g},contains:function(){return!!this._contains(this._matrix._inverseTransform(h.read(arguments)))},_contains:function(a){if(this._children){for(var b=this._children.length-1;b>=0;b--)if(this._children[b].contains(a))return!0;return!1}return a.isInside(this._getBounds("getBounds"))},hitTest:function(c,d){function e(e,f){var h=i["get"+f]();return c.getDistance(h)<d.tolerance?new z(e,g,{name:b.hyphenate(f),point:h}):a}if(c=h.read(arguments),d=z.getOptions(b.read(arguments)),this._locked||!this._visible||this._guide&&!d.guides)return null;if(!this._children&&!this.getRoughBounds().expand(2*d.tolerance)._containsPoint(c))return null;c=this._matrix._inverseTransform(c);var f,g=this;if(!(!d.center&&!d.bounds||this instanceof v&&!this._parent)){var i=this._getBounds("getBounds");if(d.center&&(f=e("center","Center")),!f&&d.bounds)for(var j=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],k=0;8>k&&!f;k++)f=e("bounds",j[k])}return(f||(f=this._children||!(d.guides&&!this._guide||d.selected&&!this._selected)?this._hitTest(c,d):null))&&f.point&&(f.point=g._matrix.transform(f.point)),f},_hitTest:function(a,b){var c=this._children;if(c){for(var d,e=c.length-1;e>=0;e--)if(d=c[e].hitTest(a,b))return d}else if(b.fill&&this.hasFill()&&this._contains(a))return new z("fill",this)},matches:function(a){function c(a,d){for(var e in a)if(a.hasOwnProperty(e)){var f=a[e],g=d[e];if(b.isPlainObject(f)&&b.isPlainObject(g)){if(!c(f,g))return!1}else if(!b.equals(f,g))return!1}return!0}for(var d in a)if(a.hasOwnProperty(d)){var e=this[d],f=a[d];if(f instanceof RegExp){if(!f.test(e))return!1}else if("function"==typeof f){if(!f(e))return!1}else if(b.isPlainObject(f)){if(!c(f,e))return!1}else if(!b.equals(e,f))return!1}return!0}},new function(){function a(b,c,d){for(var e=b._children,f=d&&[],g=0,h=e&&e.length;h>g;g++){var i=e[g];if(i.matches(c)){if(!d)return i;f.push(i)}var j=a(i,c,d);if(d)f.push.apply(f,j);else if(j)return j}return d?f:null}return{getItems:function(b){return a(this,b,!0)},getItem:function(b){return a(this,b,!1)}}},{importJSON:function(a){var c=b.importJSON(a,this);return c!==this?this.addChild(c):c},addChild:function(b,c){return this.insertChild(a,b,c)},insertChild:function(a,b,c){var d=this.insertChildren(a,[b],c);return d&&d[0]},addChildren:function(a,b){return this.insertChildren(this._children.length,a,b)},insertChildren:function(a,c,d,e){var f=this._children;if(f&&c&&c.length>0){c=Array.prototype.slice.apply(c);for(var g=c.length-1;g>=0;g--){var h=c[g];e&&h._type!==e?c.splice(g,1):h._remove(!0)}b.splice(f,c,a,0);for(var g=0,i=c.length;i>g;g++){var h=c[g];h._parent=this,h._setProject(this._project),h._name&&h.setName(h._name)}this._changed(7)}else c=null;return c},_insert:function(a,b,c){if(!b._parent)return null;var d=b._index+(a?1:0);return b._parent===this._parent&&d>this._index&&d--,b._parent.insertChild(d,this,c)},insertAbove:function(a,b){return this._insert(!0,a,b)},insertBelow:function(a,b){return this._insert(!1,a,b)},sendToBack:function(){return this._parent.insertChild(0,this)},bringToFront:function(){return this._parent.addChild(this)},appendTop:"#addChild",appendBottom:function(a){return this.insertChild(0,a)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",reduce:function(){if(this._children&&1===this._children.length){var a=this._children[0];return a.insertAbove(this),a.setStyle(this._style),this.remove(),a}return this},_removeNamed:function(){var a=this._parent._children,b=this._parent._namedChildren,c=this._name,d=b[c],e=d?d.indexOf(this):-1;-1!=e&&(a[c]==this&&delete a[c],d.splice(e,1),d.length?a[c]=d[d.length-1]:delete b[c])},_remove:function(a){return this._parent?(this._name&&this._removeNamed(),null!=this._index&&b.splice(this._parent._children,null,this._index,1),this.responds("frame")&&this._animateItem(!1),a&&this._parent._changed(7),this._parent=null,!0):!1},remove:function(){return this._remove(!0)},removeChildren:function(a,c){if(!this._children)return null;a=a||0,c=b.pick(c,this._children.length);for(var d=b.splice(this._children,null,a,c-a),e=d.length-1;e>=0;e--)d[e]._remove(!1);return d.length>0&&this._changed(7),d},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var a=0,b=this._children.length;b>a;a++)this._children[a]._index=a;this._changed(7)}},isEmpty:function(){return!this._children||0==this._children.length},isEditable:function(){for(var a=this;a;){if(!a._visible||a._locked)return!1;a=a._parent}return!0},_getOrder:function(a){function b(a){var b=[];do b.unshift(a);while(a=a._parent);return b}for(var c=b(this),d=b(a),e=0,f=Math.min(c.length,d.length);f>e;e++)if(c[e]!=d[e])return c[e]._index<d[e]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isAbove:function(a){return-1===this._getOrder(a)},isBelow:function(a){return 1===this._getOrder(a)},isParent:function(a){return this._parent===a},isChild:function(a){return a&&a._parent===this},isDescendant:function(a){for(var b=this;b=b._parent;)if(b==a)return!0;return!1},isAncestor:function(a){return a?a.isDescendant(this):!1},isGroupedWith:function(a){for(var b=this._parent;b;){if(b._parent&&/^(group|layer|compound-path)$/.test(b._type)&&a.isDescendant(b))return!0;b=b._parent}return!1},scale:function(a,b,c){return(arguments.length<2||"object"==typeof b)&&(c=b,b=a),this.transform((new p).scale(a,b,c||this.getPosition(!0)))},translate:function(){var a=new p;return this.transform(a.translate.apply(a,arguments))},rotate:function(a,b){return this.transform((new p).rotate(a,b||this.getPosition(!0)))},shear:function(a,b,c){return(arguments.length<2||"object"==typeof b)&&(c=b,b=a),this.transform((new p).shear(a,b,c||this.getPosition(!0)))},transform:function(a){var b=this._bounds,c=this._position;if(this._matrix.preConcatenate(a),(this._transformContent||arguments[1])&&this.applyMatrix(!0),this._changed(5),b&&0===a.getRotation()%90){for(var d in b){var e=b[d];a._transformBounds(e,e)}var f=this._boundsGetter,e=b[f&&f.getBounds||f||"getBounds"];e&&(this._position=e.getCenter(!0)),this._bounds=b}else c&&(this._position=a._transformPoint(c,c));return this},_applyMatrix:function(a,b){var c=this._children;if(c&&c.length>0){for(var d=0,e=c.length;e>d;d++)c[d].transform(a,b);return!0}},applyMatrix:function(a){var b=this._matrix;if(this._applyMatrix(b,!0)){var c=this._style,d=c.getFillColor(!0),e=c.getStrokeColor(!0);d&&d.transform(b),e&&e.transform(b),b.reset()}a||this._changed(5)},globalToLocal:function(){var a=this.getGlobalMatrix();return a&&a._transformPoint(h.read(arguments))},localToGlobal:function(){var a=this.getGlobalMatrix();return a&&a._inverseTransform(h.read(arguments))},fitBounds:function(a,b){a=n.read(arguments);var c=this.getBounds(),d=c.height/c.width,e=a.height/a.width,f=(b?d>e:e>d)?a.width/c.width:a.height/c.height,g=new n(new h,new k(c.width*f,c.height*f));g.setCenter(a.getCenter()),this.setBounds(g)},_setStyles:function(a){var b=this._style,c=b.getFillColor(),d=b.getStrokeColor(),e=b.getShadowColor();if(c&&(a.fillStyle=c.toCanvasStyle(a)),d){var f=b.getStrokeWidth();if(f>0){a.strokeStyle=d.toCanvasStyle(a),a.lineWidth=f;var g=b.getStrokeJoin(),h=b.getStrokeCap(),i=b.getMiterLimit();if(g&&(a.lineJoin=g),h&&(a.lineCap=h),i&&(a.miterLimit=i),paper.support.nativeDash){var j=b.getDashArray(),k=b.getDashOffset();j&&j.length&&("setLineDash"in a?(a.setLineDash(j),a.lineDashOffset=k):(a.mozDash=j,a.mozDashOffset=k))}}}if(e){var l=b.getShadowBlur();if(l>0){a.shadowColor=e.toCanvasStyle(a),a.shadowBlur=l;var m=this.getShadowOffset();a.shadowOffsetX=m.x,a.shadowOffsetY=m.y}}},draw:function(a,b){if(this._visible&&0!==this._opacity){this._drawCount=this._project._drawCount;var c=b.trackTransforms,d=b.transforms,e=d[d.length-1],f=e.clone().concatenate(this._matrix);c&&d.push(this._globalMatrix=f);var g,h,i,j=this._blendMode,l=this._opacity,m="normal"===j,n=ab.nativeModes[j],o=m&&1===l||(n||m&&1>l)&&this._canComposite();if(!o){var p=this.getStrokeBounds(e);if(!p.width||!p.height)return;i=b.offset,h=b.offset=p.getTopLeft().floor(),g=a,a=_.getContext(p.getSize().ceil().add(new k(1,1)),b.ratio)}a.save(),o?(a.globalAlpha=l,n&&(a.globalCompositeOperation=j)):a.translate(-h.x,-h.y),(o?this._matrix:f).applyToContext(a),!o&&b.clipItem&&b.clipItem.draw(a,b.extend({clip:!0})),this._draw(a,b),a.restore(),c&&d.pop(),b.clip&&a.clip(),o||(ab.process(j,a,g,l,h.subtract(i).multiply(b.ratio)),_.release(a),b.offset=i)}},_canComposite:function(){return!1}},b.each(["down","drag","up","move"],function(a){this["removeOn"+b.capitalize(a)]=function(){var b={};return b[a]=!0,this.removeOn(b)}},{removeOn:function(a){for(var b in a)if(a[b]){var c="mouse"+b,d=this._project,e=d._removeSets=d._removeSets||{};e[c]=e[c]||{},e[c][this._id]=this}return this}})),u=t.extend({_class:"Group",_serializeFields:{children:[]},initialize:function(a){this._children=[],this._namedChildren={},this._initialize(a)||this.addChildren(Array.isArray(a)?a:arguments)},_changed:function kb(a){kb.base.call(this,a),2&a&&this._transformContent&&!this._matrix.isIdentity()&&this.applyMatrix(),258&a&&delete this._clipItem},_getClipItem:function(){if(this._clipItem!==a)return this._clipItem;for(var b=0,c=this._children.length;c>b;b++){var d=this._children[b];if(d._clipMask)return this._clipItem=d}return this._clipItem=null},isClipped:function(){return!!this._getClipItem()},setClipped:function(a){var b=this.getFirstChild();b&&b.setClipMask(a)},_draw:function(a,b){var c=b.clipItem=this._getClipItem();c&&c.draw(a,b.extend({clip:!0}));for(var d=0,e=this._children.length;e>d;d++){var f=this._children[d];f!==c&&f.draw(a,b)}b.clipItem=null}}),v=u.extend({_class:"Layer",initialize:function(c){var d=b.isPlainObject(c)?new b(c):{children:Array.isArray(c)?c:arguments},e=d.insert;d.insert=!1,u.call(this,d),(e||e===a)&&(this._project.addChild(this),this.activate())},_remove:function lb(a){return this._parent?lb.base.call(this,a):null!=this._index?(this._project.activeLayer===this&&(this._project.activeLayer=this.getNextSibling()||this.getPreviousSibling()),b.splice(this._project.layers,null,this._index,1),this._project._needsRedraw=!0,!0):!1},getNextSibling:function mb(){return this._parent?mb.base.call(this):this._project.layers[this._index+1]||null},getPreviousSibling:function nb(){return this._parent?nb.base.call(this):this._project.layers[this._index-1]||null},isInserted:function ob(){return this._parent?ob.base.call(this):null!=this._index},activate:function(){this._project.activeLayer=this},_insert:function pb(a,c,d){return c instanceof v&&!c._parent?(this._remove(!0),b.splice(c._project.layers,[this],c._index+(a?1:0),0),this._setProject(c._project),this):pb.base.call(this,a,c,d)}}),w=t.extend({_class:"Shape",_transformContent:!1,_boundsSelected:!0,initialize:function(a,b,c,d,e){this._shape=a,this._size=c,this._radius=d,this._initialize(e,b)},_equals:function(a){return this._shape===a._shape&&this._size.equals(a._size)&&b.equals(this._radius,a._radius)},clone:function(a){return this._clone(new w(this._shape,this.getPosition(!0),this._size.clone(),this._radius.clone?this._radius.clone():this._radius,{insert:!1}),a)},getShape:function(){return this._shape},getSize:function(){var a=this._size;return new m(a.width,a.height,this,"setSize")},setSize:function(){var a=this._shape,b=k.read(arguments);if(!this._size.equals(b)){var c=b.width,d=b.height;if("rectangle"===a){var e=k.min(this._radius,b.divide(2));this._radius.set(e.width,e.height)}else"circle"===a?(c=d=(c+d)/2,this._radius=c/2):"ellipse"===a&&this._radius.set(c/2,d/2);this._size.set(c,d),this._changed(5)}},getRadius:function(){var a=this._radius;return"circle"===this._shape?a:new m(a.width,a.height,this,"setRadius")},setRadius:function(a){var b=this._shape;if("circle"===b){if(a===this._radius)return;var c=2*a;this._radius=a,this._size.set(c,c)}else{if(a=k.read(arguments),this._radius.equals(a))return;if(this._radius.set(a.width,a.height),"rectangle"===b){var c=k.max(this._size,a.multiply(2));this._size.set(c.width,c.height)}else"ellipse"===b&&this._size.set(2*a.width,2*a.height)}this._changed(5)},isEmpty:function(){return!1},toPath:function(c){var d=new(F[b.capitalize(this._shape)])({center:new h,size:this._size,radius:this._radius,insert:!1});return d.setStyle(this._style),d.transform(this._matrix),(c||c===a)&&d.insertAbove(this),d},_draw:function(a,b){var c=this._style,d=c.hasFill(),e=c.hasStroke(),f=b.clip;if(d||e||f){var h=this._radius,i=this._shape;if(a.beginPath(),"circle"===i)a.arc(0,0,h,0,2*Math.PI,!0);else{var j=h.width,k=h.height,l=g.KAPPA;if("ellipse"===i){var m=j*l,n=k*l;a.moveTo(-j,0),a.bezierCurveTo(-j,-n,-m,-k,0,-k),a.bezierCurveTo(m,-k,j,-n,j,0),a.bezierCurveTo(j,n,m,k,0,k),a.bezierCurveTo(-m,k,-j,n,-j,0)}else{var o=this._size,p=o.width,q=o.height;if(0===j&&0===k)a.rect(-p/2,-q/2,p,q);else{l=1-l;var r=p/2,s=q/2,m=j*l,n=k*l;a.moveTo(-r,-s+k),a.bezierCurveTo(-r,-s+n,-r+m,-s,-r+j,-s),a.lineTo(r-j,-s),a.bezierCurveTo(r-m,-s,r,-s+n,r,-s+k),a.lineTo(r,s-k),a.bezierCurveTo(r,s-n,r-m,s,r-j,s),a.lineTo(-r+j,s),a.bezierCurveTo(-r+m,s,-r,s-n,-r,s-k)}}}a.closePath()}f||!d&&!e||(this._setStyles(a),d&&(a.fill(c.getWindingRule()),a.shadowColor="rgba(0,0,0,0)"),e&&a.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(a,b){var c=new n(this._size).setCenter(0,0);return"getBounds"!==a&&this.hasStroke()&&(c=c.expand(this.getStrokeWidth())),b?b._transformBounds(c):c}},new function(){function a(a,b,c){var d=a._radius;if(!d.isZero())for(var e=a._size.divide(2),f=0;4>f;f++){var g=new h(1&f?1:-1,f>1?1:-1),i=g.multiply(e),j=i.subtract(g.multiply(d)),k=new n(i,j);if((c?k.expand(c):k).contains(b))return j}}function b(a,b){var c=a.getAngleInRadians(),d=2*b.width,e=2*b.height,f=d*Math.sin(c),g=e*Math.cos(c);return d*e/(2*Math.sqrt(f*f+g*g))}return{_contains:function c(b){if("rectangle"===this._shape){var d=a(this,b);return d?b.subtract(d).divide(this._radius).getLength()<=1:c.base.call(this,b)}return b.divide(this.size).getLength()<=.5},_hitTest:function d(c,e){var f=!1;if(this.hasStroke()){var g=this._shape,h=this._radius,i=this.getStrokeWidth()+2*e.tolerance;if("rectangle"===g){var j=a(this,c,i);if(j){var k=c.subtract(j);f=2*Math.abs(k.getLength()-b(k,h))<=i}else{var l=new n(this._size).setCenter(0,0),m=l.expand(i),o=l.expand(-i);f=m._containsPoint(c)&&!o._containsPoint(c)}}else"ellipse"===g&&(h=b(c,h)),f=2*Math.abs(c.getLength()-h)<=i}return f?new z("stroke",this):d.base.apply(this,arguments)}}},{statics:new function(){function a(a,c,d,e,f){return new w(a,c,d,e,b.getNamed(f))}return{Circle:function(){var c=h.readNamed(arguments,"center"),d=b.readNamed(arguments,"radius");return a("circle",c,new k(2*d),d,arguments)},Rectangle:function(){var b=n.readNamed(arguments,"rectangle"),c=k.min(k.readNamed(arguments,"radius"),b.getSize(!0).divide(2));return a("rectangle",b.getCenter(!0),b.getSize(!0),c,arguments)},Ellipse:function(){var b=w._readEllipse(arguments);return radius=b.radius,a("ellipse",b.center,radius.multiply(2),radius,arguments)},_readEllipse:function(a){var c,d;if(b.hasNamed(a,"radius"))c=h.readNamed(a,"center"),d=k.readNamed(a,"radius");else{var e=n.readNamed(a,"rectangle");c=e.getCenter(!0),d=e.getSize(!0).divide(2)}return{center:c,radius:d}}}}}),x=t.extend({_class:"Raster",_transformContent:!1,_boundsGetter:"getBounds",_boundsSelected:!0,_serializeFields:{source:null},initialize:function(b,c){this._initialize(b,c!==a&&h.read(arguments,1))||("string"==typeof b?this.setSource(b):this.setImage(b)),this._size||(this._size=new k)},_equals:function(a){return this.getSource()===a.getSource()},clone:function(a){var b={insert:!1},c=this._image;if(c)b.image=c;else if(this._canvas){var d=b.canvas=_.getCanvas(this._size);d.getContext("2d").drawImage(this._canvas,0,0)}return this._clone(new x(b),a)},getSize:function(){var a=this._size;return new m(a.width,a.height,this,"setSize")},setSize:function(){var a=k.read(arguments);if(!this._size.equals(a)){var b=this.getElement();
this.setCanvas(_.getCanvas(a)),b&&this.getContext(!0).drawImage(b,0,0,a.width,a.height)}},getWidth:function(){return this._size.width},getHeight:function(){return this._size.height},isEmpty:function(){return 0==this._size.width&&0==this._size.height},getPpi:function(){var a=this._matrix,b=new h(0,0).transform(a),c=new h(1,0).transform(a).subtract(b),d=new h(0,1).transform(a).subtract(b);return new k(72/c.getLength(),72/d.getLength())},getImage:function(){return this._image},setImage:function(a){this._canvas&&_.release(this._canvas),a.getContext?(this._image=null,this._canvas=a):(this._image=a,this._canvas=null),this._size=new k(a.naturalWidth||a.width,a.naturalHeight||a.height),this._context=null,this._changed(133)},getCanvas:function(){if(!this._canvas){var a=_.getContext(this._size);try{this._image&&a.drawImage(this._image,0,0),this._canvas=a.canvas}catch(b){_.release(a)}}return this._canvas},setCanvas:"#setImage",getContext:function(){return this._context||(this._context=this.getCanvas().getContext("2d")),arguments[0]&&(this._image=null,this._changed(129)),this._context},setContext:function(a){this._context=a},getSource:function(){return this._image&&this._image.src||this.toDataURL()},setSource:function(a){function b(){var a=c._project.view;a&&(paper=a._scope),c.fire("load"),a&&a.draw(!0)}var c=this,d=document.getElementById(a)||new Image;d.naturalWidth&&d.naturalHeight?setTimeout(b,0):(Q.add(d,{load:function(){c.setImage(d),b()}}),d.src||(d.src=a)),this.setImage(d)},getElement:function(){return this._canvas||this._image},getSubCanvas:function(a){a=n.read(arguments);var b=_.getContext(a.getSize());return b.drawImage(this.getCanvas(),a.x,a.y,a.width,a.height,0,0,a.width,a.height),b.canvas},getSubRaster:function(a){a=n.read(arguments);var b=new x({canvas:this.getSubCanvas(a),insert:!1});return b.translate(a.getCenter().subtract(this.getSize().divide(2))),b._matrix.preConcatenate(this._matrix),b.insertAbove(this),b},toDataURL:function(){var a=this._image&&this._image.src;if(/^data:/.test(a))return a;var b=this.getCanvas();return b?b.toDataURL():null},drawImage:function(a,b){b=h.read(arguments,1),this.getContext(!0).drawImage(a,b.x,b.y)},getAverageColor:function(a){var c,d;a?a instanceof E?(d=a,c=a.getBounds()):a.width?c=new n(a):a.x&&(c=new n(a.x-.5,a.y-.5,1,1)):c=this.getBounds();var e=32,f=Math.min(c.width,e),g=Math.min(c.height,e),h=x._sampleContext;h?h.clearRect(0,0,e+1,e+1):h=x._sampleContext=_.getContext(new k(e)),h.save();var i=(new p).scale(f/c.width,g/c.height).translate(-c.x,-c.y);i.applyToContext(h),d&&d.draw(h,new b({clip:!0,transforms:[i]})),this._matrix.applyToContext(h),h.drawImage(this.getElement(),-this._size.width/2,-this._size.height/2),h.restore();for(var j=h.getImageData(.5,.5,Math.ceil(f),Math.ceil(g)).data,l=[0,0,0],m=0,o=0,q=j.length;q>o;o+=4){var r=j[o+3];m+=r,r/=255,l[0]+=j[o]*r,l[1]+=j[o+1]*r,l[2]+=j[o+2]*r}for(var o=0;3>o;o++)l[o]/=m;return m?L.read(l):null},getPixel:function(a){a=h.read(arguments);var b=this.getContext().getImageData(a.x,a.y,1,1).data;return new L("rgb",[b[0]/255,b[1]/255,b[2]/255],b[3]/255)},setPixel:function(){var a=h.read(arguments),b=L.read(arguments),c=b._convert("rgb"),d=b._alpha,e=this.getContext(!0),f=e.createImageData(1,1),g=f.data;g[0]=255*c[0],g[1]=255*c[1],g[2]=255*c[2],g[3]=null!=d?255*d:255,e.putImageData(f,a.x,a.y)},createImageData:function(a){return a=k.read(arguments),this.getContext().createImageData(a.width,a.height)},getImageData:function(a){return a=n.read(arguments),a.isEmpty()&&(a=new n(this._size)),this.getContext().getImageData(a.x,a.y,a.width,a.height)},setImageData:function(a,b){b=h.read(arguments,1),this.getContext(!0).putImageData(a,b.x,b.y)},_getBounds:function(a,b){var c=new n(this._size).setCenter(0,0);return b?b._transformBounds(c):c},_hitTest:function(a){if(this._contains(a)){var b=this;return new z("pixel",b,{offset:a.add(b._size.divide(2)).round(),color:{get:function(){return b.getPixel(this.offset)}}})}},_draw:function(a){var b=this.getElement();b&&(a.globalAlpha=this._opacity,a.drawImage(b,-this._size.width/2,-this._size.height/2))},_canComposite:function(){return!0}}),y=t.extend({_class:"PlacedSymbol",_transformContent:!1,_boundsGetter:{getBounds:"getStrokeBounds"},_boundsSelected:!0,_serializeFields:{symbol:null},initialize:function(b,c){this._initialize(b,c!==a&&h.read(arguments,1))||this.setSymbol(b instanceof s?b:new s(b))},_equals:function(a){return this._symbol===a._symbol},getSymbol:function(){return this._symbol},setSymbol:function(a){this._symbol&&delete this._symbol._instances[this._id],this._symbol=a,a._instances[this._id]=this},clone:function(a){return this._clone(new y({symbol:this.symbol,insert:!1}),a)},isEmpty:function(){return this._symbol._definition.isEmpty()},_getBounds:function(a,b){return this.symbol._definition._getCachedBounds(a,b)},_hitTest:function(a,b,c){var d=this._symbol._definition._hitTest(a,b,c);return d&&(d.item=this),d},_draw:function(a,b){this.symbol._definition.draw(a,b)}}),z=b.extend({_class:"HitResult",initialize:function(a,b,c){this.type=a,this.item=b,c&&(c.enumerable=!0,this.inject(c))},statics:{getOptions:function(a){return a&&a._merged?a:new b({type:null,tolerance:paper.project.options.hitTolerance||2,fill:!a,stroke:!a,segments:!a,handles:!1,ends:!1,center:!1,bounds:!1,guides:!1,selected:!1,_merged:!0},a)}}}),A=b.extend({_class:"Segment",initialize:function(b,c,d,e,f,g){var h,i,j,k=arguments.length;0===k||(1===k?b.point?(h=b.point,i=b.handleIn,j=b.handleOut):h=b:2===k&&"number"==typeof b?h=arguments:3>=k?(h=b,i=c,j=d):(h=b!==a?[b,c]:null,i=d!==a?[d,e]:null,j=f!==a?[f,g]:null)),new B(h,this,"_point"),new B(i,this,"_handleIn"),new B(j,this,"_handleOut")},_serialize:function(a){return b.serialize(this.isLinear()?this._point:[this._point,this._handleIn,this._handleOut],a,!0)},_changed:function(a){if(this._path){var b,c=this._path._curves&&this.getCurve();c&&(c._changed(),(b=c[a==this._point||a==this._handleIn&&c._segment1==this?"getPrevious":"getNext"]())&&b._changed()),this._path._changed(5)}},getPoint:function(){return this._point},setPoint:function(a){a=h.read(arguments),this._point.set(a.x,a.y)},getHandleIn:function(){return this._handleIn},setHandleIn:function(a){a=h.read(arguments),this._handleIn.set(a.x,a.y)},getHandleOut:function(){return this._handleOut},setHandleOut:function(a){a=h.read(arguments),this._handleOut.set(a.x,a.y)},isLinear:function(){return this._handleIn.isZero()&&this._handleOut.isZero()},setLinear:function(){this._handleIn.set(0,0),this._handleOut.set(0,0)},isColinear:function(a){var b=this.getNext(),c=a.getNext();return this._handleOut.isZero()&&b._handleIn.isZero()&&a._handleOut.isZero()&&c._handleIn.isZero()&&b._point.subtract(this._point).isColinear(c._point.subtract(a._point))},isOrthogonal:function(){var a=this.getPrevious(),b=this.getNext();return a._handleOut.isZero()&&this._handleIn.isZero()&&this._handleOut.isZero()&&b._handleIn.isZero()&&this._point.subtract(a._point).isOrthogonal(b._point.subtract(this._point))},isArc:function(){var a=this.getNext(),b=this._handleOut,c=a._handleIn,d=g.KAPPA;if(b.isOrthogonal(c)){var e=this._point,f=a._point,h=new q(e,b,!0).intersect(new q(f,c,!0),!0);return h&&g.isZero(b.getLength()/h.subtract(e).getLength()-d)&&g.isZero(c.getLength()/h.subtract(f).getLength()-d)}return!1},_isSelected:function(a){var b=this._selectionState;return a==this._point?!!(4&b):a==this._handleIn?!!(1&b):a==this._handleOut?!!(2&b):!1},_setSelected:function(a,b){var c=this._path,b=!!b,d=this._selectionState||0,e=[!!(4&d),!!(1&d),!!(2&d)];if(a===this._point){if(b)e[1]=e[2]=!1;else{var f=this.getPrevious(),g=this.getNext();e[1]=f&&(f._point.isSelected()||f._handleOut.isSelected()),e[2]=g&&(g._point.isSelected()||g._handleIn.isSelected())}e[0]=b}else{var h=a===this._handleIn?1:2;e[h]!=b&&(b&&(e[0]=!1),e[h]=b)}this._selectionState=(e[0]?4:0)|(e[1]?1:0)|(e[2]?2:0),c&&d!=this._selectionState&&(c._updateSelection(this,d,this._selectionState),c._changed(33))},isSelected:function(){return this._isSelected(this._point)},setSelected:function(a){this._setSelected(this._point,a)},getIndex:function(){return this._index!==a?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var a=this._path,b=this._index;return a?(a._closed||b!=a._segments.length-1||b--,a.getCurves()[b]||null):null},getLocation:function(){var a=this.getCurve();return a?new D(a,a.getNext()?0:1):null},getNext:function(){var a=this._path&&this._path._segments;return a&&(a[this._index+1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._segments;return a&&(a[this._index-1]||this._path._closed&&a[a.length-1])||null},reverse:function(){return new A(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new A(this._point,this._handleIn,this._handleOut)},equals:function(a){return a===this||a&&this._class===a._class&&this._point.equals(a._point)&&this._handleIn.equals(a._handleIn)&&this._handleOut.equals(a._handleOut)||!1},toString:function(){var a=["point: "+this._point];return this._handleIn.isZero()||a.push("handleIn: "+this._handleIn),this._handleOut.isZero()||a.push("handleOut: "+this._handleOut),"{ "+a.join(", ")+" }"},_transformCoordinates:function(a,b,c){var d=this._point,e=c&&this._handleIn.isZero()?null:this._handleIn,f=c&&this._handleOut.isZero()?null:this._handleOut,g=d._x,h=d._y,i=2;return b[0]=g,b[1]=h,e&&(b[i++]=e._x+g,b[i++]=e._y+h),f&&(b[i++]=f._x+g,b[i++]=f._y+h),a&&(a._transformCoordinates(b,0,b,0,i/2),g=b[0],h=b[1],c?(d._x=g,d._y=h,i=2,e&&(e._x=b[i++]-g,e._y=b[i++]-h),f&&(f._x=b[i++]-g,f._y=b[i++]-h)):(e||(b[i++]=g,b[i++]=h),f||(b[i++]=g,b[i++]=h))),b}}),B=h.extend({initialize:function(b,c,d){var e,f,g;b?(e=b[0])!==a?f=b[1]:((e=b.x)===a&&(b=h.read(arguments),e=b.x),f=b.y,g=b.selected):e=f=0,this._x=e,this._y=f,this._owner=c,c[d]=this,g&&this.setSelected(!0)},set:function(a,b){return this._x=a,this._y=b,this._owner._changed(this),this},_serialize:function(a){var b=a.formatter,c=b.number(this._x),d=b.number(this._y);return this.isSelected()?{x:c,y:d,selected:!0}:[c,d]},getX:function(){return this._x},setX:function(a){this._x=a,this._owner._changed(this)},getY:function(){return this._y},setY:function(a){this._y=a,this._owner._changed(this)},isZero:function(){return g.isZero(this._x)&&g.isZero(this._y)},setSelected:function(a){this._owner._setSelected(this,a)},isSelected:function(){return this._owner._isSelected(this)}}),C=b.extend({_class:"Curve",initialize:function(a,b,c,d,e,f,g,h){var i=arguments.length;if(3===i)this._path=a,this._segment1=b,this._segment2=c;else if(0===i)this._segment1=new A,this._segment2=new A;else if(1===i)this._segment1=new A(a.segment1),this._segment2=new A(a.segment2);else if(2===i)this._segment1=new A(a),this._segment2=new A(b);else{var j,k,l,m;4===i?(j=a,k=b,l=c,m=d):8===i&&(j=[a,b],m=[g,h],k=[c-a,d-b],l=[e-g,f-h]),this._segment1=new A(j,null,k),this._segment2=new A(m,l,null)}},_changed:function(){delete this._length,delete this._bounds},getPoint1:function(){return this._segment1._point},setPoint1:function(a){a=h.read(arguments),this._segment1._point.set(a.x,a.y)},getPoint2:function(){return this._segment2._point},setPoint2:function(a){a=h.read(arguments),this._segment2._point.set(a.x,a.y)},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(a){a=h.read(arguments),this._segment1._handleOut.set(a.x,a.y)},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(a){a=h.read(arguments),this._segment2._handleIn.set(a.x,a.y)},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index+1]||this._path._closed&&a[0])||null},getPrevious:function(){var a=this._path&&this._path._curves;return a&&(a[this._segment1._index-1]||this._path._closed&&a[a.length-1])||null},isSelected:function(){return this.getHandle1().isSelected()&&this.getHandle2().isSelected()},setSelected:function(a){this.getHandle1().setSelected(a),this.getHandle2().setSelected(a)},getValues:function(){return C.getValues(this._segment1,this._segment2)},getPoints:function(){for(var a=this.getValues(),b=[],c=0;8>c;c+=2)b.push(new h(a[c],a[c+1]));return b},getLength:function(){var a=arguments[0],b=arguments[1],c=0===arguments.length||0===a&&1===b;if(c&&null!=this._length)return this._length;var d=C.getLength(this.getValues(),a,b);return c&&(this._length=d),d},getArea:function(){return C.getArea(this.getValues())},getPart:function(a,b){return new C(C.getPart(this.getValues(),a,b))},isLinear:function(){return this._segment1._handleOut.isZero()&&this._segment2._handleIn.isZero()},getIntersections:function(a){return C.getIntersections(this.getValues(),a.getValues(),this,a,[])},reverse:function(){return new C(this._segment2.reverse(),this._segment1.reverse())},_getParameter:function(b,c){return c?b:b&&b.curve===this?b.parameter:b===a&&c===a?.5:this.getParameterAt(b,0)},divide:function(a,b){var c=this._getParameter(a,b),d=1e-5,e=null;if(c>d&&1-d>c){var f=C.subdivide(this.getValues(),c),g=this.isLinear(),i=f[0],j=f[1];g||(this._segment1._handleOut.set(i[2]-i[0],i[3]-i[1]),this._segment2._handleIn.set(j[4]-j[6],j[5]-j[7]));var k=i[6],l=i[7],m=new A(new h(k,l),!g&&new h(i[4]-k,i[5]-l),!g&&new h(j[2]-k,j[3]-l));if(this._path)this._segment1._index>0&&0===this._segment2._index?this._path.add(m):this._path.insert(this._segment2._index,m),e=this;else{var n=this._segment2;this._segment2=m,e=new C(m,n)}}return e},split:function(a,b){return this._path?this._path.split(this._segment1._index,this._getParameter(a,b)):null},clone:function(){return new C(this._segment1,this._segment2)},toString:function(){var a=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||a.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||a.push("handle2: "+this._segment2._handleIn),a.push("point2: "+this._segment2._point),"{ "+a.join(", ")+" }"},statics:{getValues:function(a,b){var c=a._point,d=a._handleOut,e=b._handleIn,f=b._point;return[c._x,c._y,c._x+d._x,c._y+d._y,f._x+e._x,f._y+e._y,f._x,f._y]},evaluate:function(a,b,c){var d,e,f=a[0],g=a[1],i=a[2],j=a[3],k=a[4],l=a[5],m=a[6],n=a[7];if(0!==c||0!==b&&1!==b){var o=3*(i-f),p=3*(k-i)-o,q=m-f-o-p,r=3*(j-g),s=3*(l-j)-r,t=n-g-r-s;if(0===c)d=((q*b+p)*b+o)*b+f,e=((t*b+s)*b+r)*b+g;else{var u=1e-5;if(u>b&&i===f&&j===g||b>1-u&&k===m&&l===n?(d=m-f,e=n-g):(d=(3*q*b+2*p)*b+o,e=(3*t*b+2*s)*b+r),3===c){var v=6*q*b+2*p,w=6*t*b+2*s;return(d*w-e*v)/Math.pow(d*d+e*e,1.5)}}}else d=0===b?f:m,e=0===b?g:n;return 2==c?new h(e,-d):new h(d,e)},subdivide:function(b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7];c===a&&(c=.5);var l=1-c,m=l*d+c*f,n=l*e+c*g,o=l*f+c*h,p=l*g+c*i,q=l*h+c*j,r=l*i+c*k,s=l*m+c*o,t=l*n+c*p,u=l*o+c*q,v=l*p+c*r,w=l*s+c*u,x=l*t+c*v;return[[d,e,m,n,s,t,w,x],[w,x,u,v,q,r,j,k]]},solveCubic:function(a,b,c,d,e,f){var h=a[b],i=a[b+2],j=a[b+4],k=a[b+6],l=3*(i-h),m=3*(j-i)-l,n=k-h-l-m;return g.solveCubic(n,m,l,h-c,d,e,f)},getParameterOf:function(a,b,c){if(Math.abs(a[0]-b)<1e-5&&Math.abs(a[1]-c)<1e-5)return 0;if(Math.abs(a[6]-b)<1e-5&&Math.abs(a[7]-c)<1e-5)return 1;for(var d,e,f=[],g=[],h=C.solveCubic(a,0,b,f),i=C.solveCubic(a,1,c,g),j=0;-1==h||h>j;)if(-1==h||(d=f[j++])>=0&&1>=d){for(var k=0;-1==i||i>k;)if((-1==i||(e=g[k++])>=0&&1>=e)&&(-1==h?d=e:-1==i&&(e=d),Math.abs(d-e)<1e-5))return.5*(d+e);if(-1==h)break}return null},getPart:function(a,b,c){return b>0&&(a=C.subdivide(a,b)[1]),1>c&&(a=C.subdivide(a,(c-b)/(1-b))[0]),a},isLinear:function(a){var b=g.isZero;return b(a[0]-a[2])&&b(a[1]-a[3])&&b(a[4]-a[6])&&b(a[5]-a[7])},isFlatEnough:function(a,b){var c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=3*e-2*c-i,l=3*f-2*d-j,m=3*g-2*i-c,n=3*h-2*j-d;return Math.max(k*k,m*m)+Math.max(l*l,n*n)<10*b*b},getArea:function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7];return(3*e*b-1.5*e*f-1.5*e*h-3*c*d-1.5*c*f-.5*c*h+1.5*g*b+1.5*g*d-3*g*h+.5*i*b+1.5*i*d+3*i*f)/10},getBounds:function(a){for(var b=a.slice(0,2),c=b.slice(),d=[0,0],e=0;2>e;e++)C._addBounds(a[e],a[e+2],a[e+4],a[e+6],e,0,b,c,d);return new n(b[0],b[1],c[0]-b[0],c[1]-b[1])},_addBounds:function(a,b,c,d,e,f,h,i,j){function k(a,b){var c=a-b,d=a+b;c<h[e]&&(h[e]=c),d>i[e]&&(i[e]=d)}var l=3*(b-c)-a+d,m=2*(a+c)-4*b,n=b-a,o=g.solveQuadratic(l,m,n,j),p=1e-5,q=1-p;k(d,0);for(var r=0;o>r;r++){var s=j[r],t=1-s;s>p&&q>s&&k(t*t*t*a+3*t*t*s*b+3*t*s*s*c+s*s*s*d,f)}},_getWinding:function(a,b,c,d,e,f){function h(a){var b=a[1],c=a[7],e=b>c?-1:1;return 1===e&&(b>d||d>c)||-1===e&&(c>d||d>b)?0:e}var i=1e-5,j=Math.abs;if(C.isLinear(a)){var k=h(a);if(!k)return 0;var l=(a[6]-a[0])*(d-a[1])-(a[7]-a[1])*(c-a[0]);return(-i>l?-1:1)==k?0:k}for(var m,n=a[1],o=a[3],p=a[5],q=a[7],r=3*(o-p)-n+q,s=2*(n+p)-4*o,t=o-n,u=g.solveQuadratic(r,s,t,e,i,1-i),v=a,w=e[0],x=0,y=0;u>=y;y++){if(y===u)m=v;else{var z=C.subdivide(v,w);m=z[0],v=z[1],w=e[y],w=(e[y+1]-w)/(1-w)}y>0&&(m[3]=m[1]),u>y&&(m[5]=v[1]);var k=h(m);if(k){var A,B;if(1===C.solveCubic(m,1,d,f,-i,1+-i))A=f[0],B=C.evaluate(m,A,0).x;else{var D=(m[1]+m[7])/2;if(A=D>d&&k>0?0:1,1===A&&d==m[7])continue;B=0===A?m[0]:m[6]}var E=C.evaluate(m,A,1).y,F=j(E)<i||i>A&&C.evaluate(b,1,1).y*E<0;!(c>=B+(F?-i:i*k))||F&&(j(A)<i&&j(c-m[0])>i||j(A-1)<i&&j(c-m[6])>i)||(x+=F&&j(A-(k>0?1:0))<i?-k:k),b=m}}return x}}},b.each(["getBounds","getStrokeBounds","getHandleBounds","getRoughBounds"],function(a){this[a]=function(){this._bounds||(this._bounds={});var b=this._bounds[a];return b||(b=this._bounds[a]=F[a]([this._segment1,this._segment2],!1,this._path.getStyle())),b.clone()}},{}),b.each(["getPoint","getTangent","getNormal","getCurvature"],function(a,b){this[a+"At"]=function(a,c){var d=this.getValues();return C.evaluate(d,c?a:C.getParameterAt(d,a,0),b)},this[a]=function(a){return C.evaluate(this.getValues(),a,b)}},{getParameterAt:function(b,c){return C.getParameterAt(this.getValues(),b,c!==a?c:0>b?1:0)},getParameterOf:function(a){return a=h.read(arguments),C.getParameterOf(this.getValues(),a.x,a.y)},getLocationAt:function(a,b){return b||(a=this.getParameterAt(a)),new D(this,a)},getLocationOf:function(a){a=h.read(arguments);var b=this.getParameterOf(a);return null!=b?new D(this,b):null},getNearestLocation:function(a){function b(b){if(b>=0&&1>=b){var d=a.getDistance(C.evaluate(c,b,0),!0);if(f>d)return f=d,i=b,!0}}a=h.read(arguments);for(var c=this.getValues(),d=100,e=g.TOLERANCE,f=1/0,i=0,j=0;d>=j;j++)b(j/d);for(var k=1/(2*d);k>e;)b(i-k)||b(i+k)||(k/=2);var l=C.evaluate(c,i,0);return new D(this,i,l,null,null,null,a.getDistance(l))},getNearestPoint:function(a){return a=h.read(arguments),this.getNearestLocation(a).getPoint()}}),new function(){function b(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=9*(d-f)+3*(h-b),k=6*(b+f)-12*d,l=3*(d-b),m=9*(e-g)+3*(i-c),n=6*(c+g)-12*e,o=3*(e-c);return function(a){var b=(j*a+k)*a+l,c=(m*a+n)*a+o;return Math.sqrt(b*b+c*c)}}function c(a,b){return Math.max(2,Math.min(16,Math.ceil(32*Math.abs(b-a))))}return{statics:!0,getLength:function(d,e,f){e===a&&(e=0),f===a&&(f=1);var h=g.isZero;if(h(d[0]-d[2])&&h(d[1]-d[3])&&h(d[6]-d[4])&&h(d[7]-d[5])){var i=d[6]-d[0],j=d[7]-d[1];return(f-e)*Math.sqrt(i*i+j*j)}var k=b(d);return g.integrate(k,e,f,c(e,f))},getParameterAt:function(a,d,e){function f(a){var b=c(e,a);return n+=a>e?g.integrate(k,e,a,b):-g.integrate(k,a,e,b),e=a,n-d}if(0===d)return e;var h=d>0,i=h?e:0,j=h?1:e,d=Math.abs(d),k=b(a),l=g.integrate(k,i,j,c(i,j));if(d>=l)return h?j:i;var m=d/l,n=0;return g.findRoot(f,k,h?i+m:j-m,i,j,16,1e-5)}}},new function(){function a(a,b,c,d,e,f,h){var i=a[0],j=a[a.length-1];i&&d.isClose(i._point,g.EPSILON)||j&&d.isClose(j._point,g.EPSILON)||a.push(new D(b,c,d,e,f,h))}function b(d,e,f,g,h,i,j,k){if(k=(k||0)+1,!(k>20)){i=i||[0,1],j=j||[0,1];for(var l=C.getPart(d,i[0],i[1]),m=C.getPart(e,j[0],j[1]),n=0;n++<20;){var o,p=c(l,m,o=j.slice()),q=0;if(0===p)break;if(p>0){if(j=o,m=C.getPart(e,j[0],j[1]),q=c(m,l,o=i.slice()),0===q)break;p>0&&(i=o,l=C.getPart(d,i[0],i[1]))}if(0>p||0>q){if(i[1]-i[0]>j[1]-j[0]){var r=(i[0]+i[1])/2;b(d,e,f,g,h,[i[0],r],j,k),b(d,e,f,g,h,[r,i[1]],j,k);break}var r=(j[0]+j[1])/2;b(d,e,f,g,h,i,[j[0],r],k),b(d,e,f,g,h,i,[r,j[1]],k);break}if(Math.abs(i[1]-i[0])<=1e-5&&Math.abs(j[1]-j[0])<=1e-5){var s=(i[0]+i[1])/2,t=(j[0]+j[1])/2;a(h,f,s,C.evaluate(d,s,0),g,t,C.evaluate(e,t,0));break}}}}function c(a,b,c){var e=a[0],f=a[1],g=a[2],h=a[3],i=a[4],j=a[5],k=a[6],l=a[7],m=b[0],n=b[1],o=b[2],p=b[3],r=b[4],s=b[5],t=b[6],u=b[7],v=q.getSignedDistance,w=v(e,f,k,l,g,h)||0,x=v(e,f,k,l,i,j)||0,y=w*x>0?.75:4/9,z=y*Math.min(0,w,x),A=y*Math.max(0,w,x),B=v(e,f,k,l,m,n),D=v(e,f,k,l,o,p),E=v(e,f,k,l,r,s),F=v(e,f,k,l,t,u);if(z>Math.max(B,D,E,F)||A<Math.min(B,D,E,F))return 0;var G,H=d(B,D,E,F);B>F&&(G=z,z=A,A=G);for(var I=-1/0,J=1/0,K=-1/0,L=0,M=H.length;M>L;L++){var N=H[L],O=H[(L+1)%M];O[1]<N[1]&&(G=O,O=N,N=G);var P=N[0],Q=N[1],R=O[0],S=O[1],T=(S-Q)/(R-P);if(z>=Q&&S>=z){var U=P+(z-Q)/T;J>U&&(J=U),U>I&&(I=U)}if(A>=Q&&S>=A){var U=P+(A-Q)/T;U>K&&(K=U),J>U&&(J=0)}}if(1/0!==J&&K!==-1/0){var V=Math.min(z,A),W=Math.max(z,A);F>V&&W>F&&(K=1),B>V&&W>B&&(J=0),I>K&&(K=1);var X=c[0],Y=c[1]-X;if(c[0]=X+J*Y,c[1]=X+K*Y,(Y-(c[1]-c[0]))/Y>=.2)return 1}return C.getBounds(a).touches(C.getBounds(b))?-1:0}function d(a,b,c,d){var e=[0,a],f=[1/3,b],g=[2/3,c],h=[1,d],i=q.getSignedDistance,j=i(0,a,1,d,1/3,b),k=i(0,a,1,d,2/3,c);if(0>j*k)return[e,f,h,g];var l,m;return Math.abs(j)>Math.abs(k)?(l=f,m=(d-c-(d-a)/3)*(2*(d-c)-d+b)/3):(l=g,m=(b-a+(a-d)/3)*(-2*(a-b)+a-c)/3),0>m?[e,l,h]:[e,f,g,h]}function e(b,c,d,e,f){for(var g=C.isLinear(b),h=g?c:b,i=g?b:c,j=i[0],k=i[1],l=i[6],m=i[7],n=l-j,o=m-k,p=Math.atan2(-o,n),q=Math.sin(p),r=Math.cos(p),s=n*r-o*q,t=[0,0,0,0,s,0,s,0],u=[],v=0;8>v;v+=2){var w=h[v]-j,x=h[v+1]-k;u.push(w*r-x*q,x*r+w*q)}for(var y=[],z=C.solveCubic(u,1,0,y,0,1),v=0;z>v;v++){var A=y[v],w=C.evaluate(u,A,0).x;if(w>=0&&s>=w){var B=C.getParameterOf(t,w,0),D=g?B:A,E=g?A:B;a(f,d,D,C.evaluate(b,D,0),e,E,C.evaluate(c,E,0))}}}function f(b,c,d,e,f){var g=q.intersect(b[0],b[1],b[6],b[7],c[0],c[1],c[6],c[7]);g&&a(f,d,null,g,e)}return{statics:{getIntersections:function(c,d,g,h,i){var j=C.isLinear(c),k=C.isLinear(d),l=g.getPoint1(),m=g.getPoint2(),n=h.getPoint1(),o=h.getPoint2(),p=1e-5;return l.isClose(n,p)&&a(i,g,0,l,h,0,l),l.isClose(o,p)&&a(i,g,0,l,h,1,l),(j&&k?f:j||k?e:b)(c,d,g,h,i),m.isClose(n,p)&&a(i,g,1,m,h,0,m),m.isClose(o,p)&&a(i,g,1,m,h,1,m),i}}}}),D=b.extend({_class:"CurveLocation",initialize:function qb(a,b,c,d,e,f,g){this._id=qb._id=(qb._id||0)+1,this._curve=a,this._segment1=a._segment1,this._segment2=a._segment2,this._parameter=b,this._point=c,this._curve2=d,this._parameter2=e,this._point2=f,this._distance=g},getSegment:function(){if(!this._segment){var a=this.getCurve(),b=this.getParameter();if(1===b)this._segment=a._segment2;else if(0===b||arguments[0])this._segment=a._segment1;else{if(null==b)return null;this._segment=a.getLength(0,b)<a.getLength(b,1)?a._segment1:a._segment2}}return this._segment},getCurve:function(){return(!this._curve||arguments[0])&&(this._curve=this._segment1.getCurve(),null==this._curve.getParameterOf(this._point)&&(this._curve=this._segment2.getPrevious().getCurve())),this._curve},getIntersection:function(){var a=this._intersection;if(!a&&this._curve2){var b=this._parameter2;this._intersection=a=new D(this._curve2,b,this._point2||this._point,this),a._intersection=this}return a},getPath:function(){var a=this.getCurve();return a&&a._path},getIndex:function(){var a=this.getCurve();return a&&a.getIndex()},getOffset:function(){var a=this.getPath();return a&&a._getOffset(this)},getCurveOffset:function(){var a=this.getCurve(),b=this.getParameter();return null!=b&&a&&a.getLength(0,b)},getParameter:function(){if((null==this._parameter||arguments[0])&&this._point){var a=this.getCurve(arguments[0]&&this._point);this._parameter=a&&a.getParameterOf(this._point)}return this._parameter},getPoint:function(){if((!this._point||arguments[0])&&null!=this._parameter){var a=this.getCurve();this._point=a&&a.getPointAt(this._parameter,!0)}return this._point},getTangent:function(){var a=this.getParameter(),b=this.getCurve();return null!=a&&b&&b.getTangentAt(a,!0)},getNormal:function(){var a=this.getParameter(),b=this.getCurve();return null!=a&&b&&b.getNormalAt(a,!0)},getDistance:function(){return this._distance},divide:function(){var a=this.getCurve(!0);return a&&a.divide(this.getParameter(!0),!0)},split:function(){var a=this.getCurve(!0);return a&&a.split(this.getParameter(!0),!0)},toString:function(){var a=[],b=this.getPoint(),c=f.instance;b&&a.push("point: "+b);var d=this.getIndex();null!=d&&a.push("index: "+d);var e=this.getParameter();return null!=e&&a.push("parameter: "+c.number(e)),null!=this._distance&&a.push("distance: "+c.number(this._distance)),"{ "+a.join(", ")+" }"}}),E=t.extend({_class:"PathItem",initialize:function(){},getIntersections:function(a){if(!this.getBounds().touches(a.getBounds()))return[];for(var b=[],c=this.getCurves(),d=a.getCurves(),e=d.length,f=[],g=0;e>g;g++)f[g]=d[g].getValues();for(var g=0,h=c.length;h>g;g++)for(var i=c[g],j=i.getValues(),k=0;e>k;k++)C.getIntersections(j,f[k],i,d[k],b);return b},setPathData:function(a){function b(a,b,c){var e=parseFloat(d[a]);return g&&(e+=i[b]),c&&(i[b]=e),e}function c(a,c){return new h(b(a,"x",c),b(a+1,"y",c))}var d,e,f=a.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/gi),g=!1,i=new h;this.clear();for(var j=0,k=f.length;k>j;j++){var l=f[j],m=l[0],n=m.toLowerCase();d=l.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var o=d&&d.length;switch(g=m===n,n){case"m":case"l":for(var p=0;o>p;p+=2)this[0===p&&"m"===n?"moveTo":"lineTo"](c(p,!0));e=i;break;case"h":case"v":for(var q="h"==n?"x":"y",p=0;o>p;p++)b(p,q,!0),this.lineTo(i);e=i;break;case"c":for(var p=0;o>p;p+=6)this.cubicCurveTo(c(p),e=c(p+2),c(p+4,!0));break;case"s":for(var p=0;o>p;p+=4)this.cubicCurveTo(i.multiply(2).subtract(e),e=c(p),c(p+2,!0));break;case"q":for(var p=0;o>p;p+=4)this.quadraticCurveTo(e=c(p),c(p+2,!0));break;case"t":for(var p=0;o>p;p+=2)this.quadraticCurveTo(e=i.multiply(2).subtract(e),c(p,!0));break;case"a":break;case"z":this.closePath()}}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(a){var b=this._getWinding(a);return!!("evenodd"===this.getWindingRule()?1&b:b)}}),F=E.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(b){this._closed=!1,this._segments=[];var c=Array.isArray(b)?"object"==typeof b[0]?b:arguments:b&&(b.point!==a&&b.size===a||b.x!==a)?arguments:null;this.setSegments(c||[]),this._initialize(!c&&b)},_equals:function(a){return b.equals(this._segments,a._segments)},clone:function(b){var c=this._clone(new F({segments:this._segments,insert:!1}),b);return c._closed=this._closed,this._clockwise!==a&&(c._clockwise=this._clockwise),c},_changed:function rb(a){if(rb.base.call(this,a),4&a){if(delete this._length,delete this._clockwise,this._curves)for(var b=0,c=this._curves.length;c>b;b++)this._curves[b]._changed(5)}else 8&a&&delete this._bounds},getSegments:function(){return this._segments},setSegments:function(a){var b=this.isFullySelected();this._segments.length=0,this._selectedSegmentState=0,delete this._curves,this._add(A.readAll(a)),b&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var a=this._curves,b=this._segments;if(!a){var c=this._countCurves();a=this._curves=Array(c);for(var d=0;c>d;d++)a[d]=new C(this,b[d],b[d+1]||b[0])}return a},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var a=this.getCurves();return a[a.length-1]},getPathData:function(){function a(a,b,f){var g=a._point,h=b._point,i=a._handleOut,j=b._handleIn;if(i.isZero()&&j.isZero())f||e.push("L"+d.point(h,c));else{var k=h.subtract(g);e.push("c"+d.point(i,c)+" "+d.point(k.add(j),c)+" "+d.point(k,c))}}var b=this._segments,c=arguments[0],d=f.instance,e=[];if(0===b.length)return"";e.push("M"+d.point(b[0]._point));for(var g=0,h=b.length-1;h>g;g++)a(b[g],b[g+1],!1);return this._closed&&(a(b[b.length-1],b[0],!0),e.push("z")),e.join("")},isClosed:function(){return this._closed},setClosed:function(a){if(this._closed!=(a=!!a)){if(this._closed=a,this._curves){var b=this._curves.length=this._countCurves();a&&(this._curves[b-1]=new C(this,this._segments[b-1],this._segments[0]))}this._changed(5)}},isEmpty:function(){return 0===this._segments.length},isPolygon:function(){for(var a=0,b=this._segments.length;b>a;a++)if(!this._segments[a].isLinear())return!1;return!0},_applyMatrix:function(a){for(var b=Array(6),c=0,d=this._segments.length;d>c;c++)this._segments[c]._transformCoordinates(a,b,!0);return!0},_add:function(a,b){for(var c=this._segments,d=this._curves,e=a.length,f=null==b,b=f?c.length:b,g=0;e>g;g++){var h=a[g];h._path&&(h=a[g]=h.clone()),h._path=this,h._index=b+g,h._selectionState&&this._updateSelection(h,0,h._selectionState)}if(f)c.push.apply(c,a);else{c.splice.apply(c,[b,0].concat(a));for(var g=b+e,i=c.length;i>g;g++)c[g]._index=g}if(d||a._curves){d||(d=this._curves=[]);var j=b>0?b-1:b,k=j,l=Math.min(j+e,this._countCurves());a._curves&&(d.splice.apply(d,[j,0].concat(a._curves)),k+=a._curves.length);for(var g=k;l>g;g++)d.splice(g,0,new C(this,null,null));this._adjustCurves(j,l)}return this._changed(5),a},_adjustCurves:function(a,b){for(var c,d=this._segments,e=this._curves,f=a;b>f;f++)c=e[f],c._path=this,c._segment1=d[f],c._segment2=d[f+1]||d[0];(c=e[this._closed&&0===a?d.length-1:a-1])&&(c._segment2=d[a]||d[0]),(c=e[b])&&(c._segment1=d[b])},_countCurves:function(){var a=this._segments.length;return!this._closed&&a>0?a-1:a},add:function(a){return arguments.length>1&&"number"!=typeof a?this._add(A.readAll(arguments)):this._add([A.read(arguments)])[0]},insert:function(a,b){return arguments.length>2&&"number"!=typeof b?this._add(A.readAll(arguments,1),a):this._add([A.read(arguments,1)],a)[0]},addSegment:function(){return this._add([A.read(arguments)])[0]},insertSegment:function(a){return this._add([A.read(arguments,1)],a)[0]},addSegments:function(a){return this._add(A.readAll(a))},insertSegments:function(a,b){return this._add(A.readAll(b),a)},removeSegment:function(a){return this.removeSegments(a,a+1)[0]||null},removeSegments:function(a,c){a=a||0,c=b.pick(c,this._segments.length);var d=this._segments,e=this._curves,f=d.length,g=d.splice(a,c-a),h=g.length;if(!h)return g;for(var i=0;h>i;i++){var j=g[i];j._selectionState&&this._updateSelection(j,j._selectionState,0),delete j._index,delete j._path}for(var i=a,k=d.length;k>i;i++)d[i]._index=i;if(e){var l=a>0&&c===f+(this._closed?1:0)?a-1:a,e=e.splice(l,h);arguments[2]&&(g._curves=e.slice(1)),this._adjustCurves(l,l)}return this._changed(5),g},clear:"#removeSegments",isFullySelected:function(){var a=this._segments.length;return this._selected&&a>0&&this._selectedSegmentState===4*a},setFullySelected:function(a){a&&this._selectSegments(!0),this.setSelected(a)},setSelected:function sb(a){a||this._selectSegments(!1),sb.base.call(this,a)},_selectSegments:function(a){var b=this._segments.length;this._selectedSegmentState=a?4*b:0;for(var c=0;b>c;c++)this._segments[c]._selectionState=a?4:0},_updateSelection:function(a,b,c){a._selectionState=c;var d=this._selectedSegmentState+=c-b;d>0&&this.setSelected(!0)},flatten:function(a){for(var b=new H(this),c=0,d=b.length/Math.ceil(b.length/a),e=b.length+(this._closed?-d:d)/2,f=[];e>=c;)f.push(new A(b.evaluate(c,0))),c+=d;this.setSegments(f)},simplify:function(a){if(this._segments.length>2){var b=new I(this,a||2.5);this.setSegments(b.fit())}},split:function(a,b){if(null!==b){if(1===arguments.length){var c=a;"number"==typeof c&&(c=this.getLocationAt(c)),a=c.index,b=c.parameter}b>=1&&(a++,b--);var d=this.getCurves();if(a>=0&&a<d.length){b>0&&d[a++].divide(b,!0);var e,f=this.removeSegments(a,this._segments.length,!0);return this._closed?(this.setClosed(!1),e=this):a>0&&(e=this._clone((new F).insertAbove(this,!0))),e._add(f,0),this.addSegment(f[0]),e
}return null}},isClockwise:function(){return this._clockwise!==a?this._clockwise:F.isClockwise(this._segments)},setClockwise:function(a){this.isClockwise()!=(a=!!a)&&this.reverse(),this._clockwise=a},reverse:function(){this._segments.reverse();for(var b=0,c=this._segments.length;c>b;b++){var d=this._segments[b],e=d._handleIn;d._handleIn=d._handleOut,d._handleOut=e,d._index=b}delete this._curves,this._clockwise!==a&&(this._clockwise=!this._clockwise)},join:function(a){if(a){var b=a._segments,c=this.getLastSegment(),d=a.getLastSegment();c._point.equals(d._point)&&a.reverse();var e,f=a.getFirstSegment();return c._point.equals(f._point)?(c.setHandleOut(f._handleOut),this._add(b.slice(1))):(e=this.getFirstSegment(),e._point.equals(f._point)&&a.reverse(),d=a.getLastSegment(),e._point.equals(d._point)?(e.setHandleIn(d._handleIn),this._add(b.slice(0,b.length-1),0)):this._add(b.slice())),a.closed&&this._add([b[0]]),a.remove(),e=this.getFirstSegment(),c=this.getLastSegment(),c._point.equals(e._point)&&(e.setHandleIn(c._handleIn),c.remove(),this.setClosed(!0)),this._changed(5),!0}return!1},getLength:function(){if(null==this._length){var a=this.getCurves();this._length=0;for(var b=0,c=a.length;c>b;b++)this._length+=a[b].getLength()}return this._length},getArea:function(){for(var a=this.getCurves(),b=0,c=0,d=a.length;d>c;c++)b+=a[c].getArea();return b},_getOffset:function(a){var b=a&&a.getIndex();if(null!=b){for(var c=this.getCurves(),d=0,e=0;b>e;e++)d+=c[e].getLength();var f=c[b];return d+f.getLength(0,a.getParameter())}return null},getLocationOf:function(a){a=h.read(arguments);for(var b=this.getCurves(),c=0,d=b.length;d>c;c++){var e=b[c].getLocationOf(a);if(e)return e}return null},getLocationAt:function(a,b){var c=this.getCurves(),d=0;if(b){var e=~~a;return c[e].getLocationAt(a-e,!0)}for(var f=0,g=c.length;g>f;f++){var h=d,i=c[f];if(d+=i.getLength(),d>=a)return i.getLocationAt(a-h)}return a<=this.getLength()?new D(c[c.length-1],1):null},getPointAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getPoint()},getTangentAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getTangent()},getNormalAt:function(a,b){var c=this.getLocationAt(a,b);return c&&c.getNormal()},getNearestLocation:function(a){a=h.read(arguments);for(var b=this.getCurves(),c=1/0,d=null,e=0,f=b.length;f>e;e++){var g=b[e].getNearestLocation(a);g._distance<c&&(c=g._distance,d=g)}return d},getNearestPoint:function(a){return a=h.read(arguments),this.getNearestLocation(a).getPoint()},getStyle:function(){var a=this._parent;return(a&&"compound-path"===a._type?a:this)._style},toShape:function(b){function c(a,b){return m[a].isColinear(m[b])}function d(a){return m[a].isOrthogonal()}function e(a){return m[a].isArc()}function f(a,b){return m[a]._point.getDistance(m[b]._point)}if(!this._closed)return null;var h,i,j,l,m=this._segments;if(this.isPolygon()&&4===m.length&&c(0,2)&&c(1,3)&&d(1)?(h=w.Rectangle,i=new k(f(0,3),f(0,1)),l=m[1]._point.add(m[2]._point).divide(2)):8===m.length&&e(0)&&e(2)&&e(4)&&e(6)&&c(1,5)&&c(3,7)?(h=w.Rectangle,i=new k(f(1,6),f(0,3)),j=i.subtract(new k(f(0,7),f(1,2))).divide(2),l=m[3]._point.add(m[4]._point).divide(2)):4===m.length&&e(0)&&e(1)&&e(2)&&e(3)&&(g.isZero(f(0,2)-f(1,3))?(h=w.Circle,j=f(0,2)/2):(h=w.Ellipse,j=new k(f(2,0)/2,f(3,1)/2)),l=m[1]._point),h){var n=this.getPosition(!0),o=new h({center:n,size:i,radius:j,insert:!1});return o.rotate(l.subtract(n).getAngle()+90),o.setStyle(this._style),(b||b===a)&&o.insertAbove(this),o}return null},_getWinding:function(a){var b=this._closed;if(!b&&!this.hasFill()||!this._getBounds("getRoughBounds")._containsPoint(a))return 0;for(var c=this.getCurves(),d=this._segments,e=0,f=[],g=[],h=(b?c[c.length-1]:new C(d[d.length-1]._point,d[0]._point)).getValues(),i=h,j=0,k=c.length;k>j;j++){var l=c[j].getValues(),m=l[0],n=l[1];(m!==l[2]||n!==l[3]||m!==l[4]||n!==l[5]||m!==l[6]||n!==l[7])&&(e+=C._getWinding(l,i,a.x,a.y,f,g),i=l)}return b||(e+=C._getWinding(h,i,a.x,a.y,f,g)),e},_hitTest:function(b,c){function d(c,d,e){return b.getDistance(d)<s?new z(e,u,{segment:c,point:d}):a}function e(a,b){var e=a._point;return(b||c.segments)&&d(a,e,"segment")||!b&&c.handles&&(d(a,e.add(a._handleIn),"handle-in")||d(a,e.add(a._handleOut),"handle-out"))}function f(a){m.push(a)}function g(a){var b=m[a],c=m[(a+1)%m.length];return[b.x,b.y,b.x,b.y,c.x,c.y,c.x,c.y]}function h(a){for(var b=m.length,c=g(b-1),d=[],e=[],f=0,h=0;b>h;h++){var i=g(h);f+=C._getWinding(i,c,a.x,a.y,d,e),c=i}return!!f}function i(a){return("round"!==j||"round"!==k)&&(m=[],r||a._index>0&&a._index<q.length-1?"round"!==j&&(a._handleIn.isZero()||a._handleOut.isZero())&&F._addSquareJoin(a,j,t,l,f,!0):"round"!==k&&F._addSquareCap(a,k,t,f,!0),m.length>0)?h(b):b.getDistance(a._point)<=t}var j,k,l,m,n,o,p=this.getStyle(),q=this._segments,r=this._closed,s=c.tolerance,t=0,u=this;if(c.stroke&&(t=p.getStrokeWidth()/2,t>0?(j=p.getStrokeJoin(),k=p.getStrokeCap(),l=t*p.getMiterLimit()):j=k="round",t+=s),!c.ends||c.segments||r){if(c.segments||c.handles)for(var v=0,w=q.length;w>v;v++)if(o=e(q[v]))return o}else if(o=e(q[0],!0)||e(q[q.length-1],!0))return o;if(t>0){if(n=this.getNearestLocation(b)){var x=n.getParameter();0===x||1===x?i(n.getSegment())||(n=null):n._distance>t&&(n=null)}if(!n&&"miter"===j)for(var v=0,w=q.length;w>v;v++){var y=q[v];if(b.getDistance(y._point)<=l&&i(y)){n=y.getLocation();break}}}return!n&&c.fill&&this.hasFill()&&this._contains(b)?new z("fill",this):n?new z("stroke",this,{location:n}):null}},new function(){function a(a,b,c,d){function e(b){var c=g[b],d=g[b+1];(m!=c||n!=d)&&(a.beginPath(),a.moveTo(m,n),a.lineTo(c,d),a.stroke(),a.beginPath(),a.arc(c,d,f,0,2*Math.PI,!0),a.fill())}for(var f=d/2,g=Array(6),h=0,i=b.length;i>h;h++){var j=b[h];j._transformCoordinates(c,g,!1);var k=j._selectionState,l=4&k,m=g[0],n=g[1];(l||1&k)&&e(2),(l||2&k)&&e(4),a.save(),a.beginPath(),a.rect(m-f,n-f,d,d),a.fill(),l||(a.beginPath(),a.rect(m-f+1,n-f+1,d-2,d-2),a.fillStyle="#ffffff",a.fill()),a.restore()}}function b(a,b,c){function d(b){var d=m[b];if(c)d._transformCoordinates(c,o,!1),e=o[0],f=o[1];else{var n=d._point;e=n._x,f=n._y}if(p)a.moveTo(e,f),p=!1;else{if(c)i=o[2],j=o[3];else{var q=d._handleIn;i=e+q._x,j=f+q._y}i==e&&j==f&&k==g&&l==h?a.lineTo(e,f):a.bezierCurveTo(k,l,i,j,e,f)}if(g=e,h=f,c)k=o[4],l=o[5];else{var q=d._handleOut;k=g+q._x,l=h+q._y}}for(var e,f,g,h,i,j,k,l,m=b._segments,n=m.length,o=Array(6),p=!0,q=0;n>q;q++)d(q);b._closed&&n>1&&d(0)}return{_draw:function(a,c){function d(a){return j[(a%k+k)%k]}var e=c.clip,f=c.compound;f||a.beginPath();var g=this.getStyle(),h=g.hasFill(),i=g.hasStroke(),j=g.getDashArray(),k=!paper.support.nativeDash&&i&&j&&j.length;if((h||i&&!k||f||e)&&b(a,this),this._closed&&a.closePath(),!e&&!f&&(h||i)&&(this._setStyles(a),h&&(a.fill(g.getWindingRule()),a.shadowColor="rgba(0,0,0,0)"),i)){if(k){a.beginPath();var l,m=new H(this),n=m.length,o=-g.getDashOffset(),p=0;for(o%=n;o>0;)o-=d(p--)+d(p--);for(;n>o;)l=o+d(p++),(o>0||l>0)&&m.drawPart(a,Math.max(o,0),Math.max(l,0)),o=l+d(p++)}a.stroke()}},_drawSelected:function(c,d){c.beginPath(),b(c,this,d),c.stroke(),a(c,this._segments,d,this._project.options.handleSize||4)}}},new function(){function a(a){var b=a.length,c=[],d=[],e=2;c[0]=a[0]/e;for(var f=1;b>f;f++)d[f]=1/e,e=(b-1>f?4:2)-d[f],c[f]=(a[f]-c[f-1])/e;for(var f=1;b>f;f++)c[b-f-1]-=d[b-f]*c[b-f];return c}return{smooth:function(){var b=this._segments,c=b.length,d=this._closed,e=c,f=0;if(!(2>=c)){d&&(f=Math.min(c,4),e+=2*Math.min(c,f));for(var g=[],i=0;c>i;i++)g[i+f]=b[i]._point;if(d)for(var i=0;f>i;i++)g[i]=b[i+c-f]._point,g[i+c+f]=b[i]._point;else e--;for(var j=[],i=1;e-1>i;i++)j[i]=4*g[i]._x+2*g[i+1]._x;j[0]=g[0]._x+2*g[1]._x,j[e-1]=3*g[e-1]._x;for(var k=a(j),i=1;e-1>i;i++)j[i]=4*g[i]._y+2*g[i+1]._y;j[0]=g[0]._y+2*g[1]._y,j[e-1]=3*g[e-1]._y;var l=a(j);if(d){for(var i=0,m=c;f>i;i++,m++){var n=i/f,o=1-n,p=i+f,q=m+f;k[m]=k[i]*n+k[m]*o,l[m]=l[i]*n+l[m]*o,k[q]=k[p]*o+k[q]*n,l[q]=l[p]*o+l[q]*n}e--}for(var r=null,i=f;e-f>=i;i++){var s=b[i-f];r&&s.setHandleIn(r.subtract(s._point)),e>i&&(s.setHandleOut(new h(k[i],l[i]).subtract(s._point)),r=e-1>i?new h(2*g[i+1]._x-k[i+1],2*g[i+1]._y-l[i+1]):new h((g[e]._x+k[e-1])/2,(g[e]._y+l[e-1])/2))}if(d&&r){var s=this._segments[0];s.setHandleIn(r.subtract(s._point))}}}}},new function(){function a(a){var b=a._segments;if(0==b.length)throw Error("Use a moveTo() command first");return b[b.length-1]}return{moveTo:function(){1===this._segments.length&&this.removeSegment(0),this._segments.length||this._add([new A(h.read(arguments))])},moveBy:function(){throw Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new A(h.read(arguments))])},cubicCurveTo:function(){var b=h.read(arguments),c=h.read(arguments),d=h.read(arguments),e=a(this);e.setHandleOut(b.subtract(e._point)),this._add([new A(d,c.subtract(d))])},quadraticCurveTo:function(){var b=h.read(arguments),c=h.read(arguments),d=a(this)._point;this.cubicCurveTo(b.add(d.subtract(b).multiply(1/3)),b.add(c.subtract(b).multiply(1/3)),c)},curveTo:function(){var c=h.read(arguments),d=h.read(arguments),e=b.pick(b.read(arguments),.5),f=1-e,g=a(this)._point,i=c.subtract(g.multiply(f*f)).subtract(d.multiply(e*e)).divide(2*e*f);if(i.isNaN())throw Error("Cannot put a curve through points with parameter = "+e);this.quadraticCurveTo(i,d)},arcTo:function(){var c,d=a(this),e=d._point,f=h.read(arguments),g=b.pick(b.peek(arguments),!0);if("boolean"==typeof g)var i=e.add(f).divide(2),c=i.add(i.subtract(e).rotate(g?-90:90));else c=f,f=h.read(arguments);var j=new q(e.add(c).divide(2),c.subtract(e).rotate(90),!0),k=new q(c.add(f).divide(2),f.subtract(c).rotate(90),!0),l=j.intersect(k,!0),m=new q(e,f),n=m.getSide(c);if(!l){if(!n)return this.lineTo(f);throw Error("Cannot put an arc through the given points: "+[e,c,f])}var o=e.subtract(l),p=o.getDirectedAngle(f.subtract(l)),r=m.getSide(l);0==r?p=n*Math.abs(p):n==r&&(p-=360*(0>p?-1:1));for(var s=Math.abs(p),t=s>=360?4:Math.ceil(s/90),u=p/t,v=u*Math.PI/360,w=4/3*Math.sin(v)/(1+Math.cos(v)),x=[],y=0;t>=y;y++){var z=t>y?l.add(o):f,B=t>y?o.rotate(90).multiply(w):null;0==y?d.setHandleOut(B):x.push(new A(z,o.rotate(-90).multiply(w),B)),o=o.rotate(u)}this._add(x)},lineBy:function(){var b=h.read(arguments),c=a(this)._point;this.lineTo(c.add(b))},curveBy:function(){var c=h.read(arguments),d=h.read(arguments),e=b.read(arguments),f=a(this)._point;this.curveTo(f.add(c),f.add(d),e)},cubicCurveBy:function(){var b=h.read(arguments),c=h.read(arguments),d=h.read(arguments),e=a(this)._point;this.cubicCurveTo(e.add(b),e.add(c),e.add(d))},quadraticCurveBy:function(){var b=h.read(arguments),c=h.read(arguments),d=a(this)._point;this.quadraticCurveTo(d.add(b),d.add(c))},arcBy:function(){var c=a(this)._point,d=c.add(h.read(arguments)),e=b.pick(b.peek(arguments),!0);"boolean"==typeof e?this.arcTo(d,e):this.arcTo(d,c.add(h.read(arguments)))},closePath:function(){var a=this.getFirstSegment(),b=this.getLastSegment();a._point.equals(b._point)&&(a.setHandleIn(b._handleIn),b.remove()),this.setClosed(!0)}}},{_getBounds:function(a,b){return F[a](this._segments,this._closed,this.getStyle(),b)},statics:{isClockwise:function(a){for(var b=0,c=0,d=a.length;d>c;c++)for(var e=C.getValues(a[c],a[d>c+1?c+1:0]),f=2;8>f;f+=2)b+=(e[f-2]-e[f])*(e[f+1]+e[f-1]);return b>0},getBounds:function(a,b,c,d,e){function f(a){a._transformCoordinates(d,h,!1);for(var b=0;2>b;b++)C._addBounds(i[b],i[b+4],h[b+2],h[b],b,e?e[b]:0,j,k,l);var c=i;i=h,h=c}var g=a[0];if(!g)return new n;for(var h=Array(6),i=g._transformCoordinates(d,Array(6),!1),j=i.slice(0,2),k=j.slice(),l=Array(2),m=1,o=a.length;o>m;m++)f(a[m]);return b&&f(g),new n(j[0],j[1],k[0]-j[0],k[1]-j[1])},getStrokeBounds:function(a,b,c,d){function e(a,b){if(!b)return[a,a];var c=b.shiftless(),d=c.transform(new h(a,0)),e=c.transform(new h(0,a)),f=d.getAngleInRadians(),g=d.getLength(),i=e.getLength(),j=Math.sin(f),k=Math.cos(f),l=Math.tan(f),m=-Math.atan(i*l/g),n=Math.atan(i/(l*g));return[Math.abs(g*Math.cos(m)*k-i*Math.sin(m)*j),Math.abs(i*Math.sin(n)*k+g*Math.cos(n)*j)]}function f(a){o=o.include(d?d._transformPoint(a,a):a)}function g(a,b){"round"===b||!a._handleIn.isZero()&&!a._handleOut.isZero()?o=o.unite(s.setCenter(d?d._transformPoint(a._point):a._point)):F._addSquareJoin(a,b,l,r,f)}function i(a,b){switch(b){case"round":g(a,b);break;case"butt":case"square":F._addSquareCap(a,b,l,f)}}if(!c.hasStroke())return F.getBounds(a,b,c,d);for(var j=a.length-(b?0:1),l=c.getStrokeWidth()/2,m=e(l,d),o=F.getBounds(a,b,c,d,m),p=c.getStrokeJoin(),q=c.getStrokeCap(),r=l*c.getMiterLimit(),s=new n(new k(m).multiply(2)),t=1;j>t;t++)g(a[t],p);return b?g(a[0],p):(i(a[0],q),i(a[a.length-1],q)),o},_addSquareJoin:function(a,b,c,d,e,f){var g=a.getCurve(),i=g.getPrevious(),j=g.getPointAt(0,!0),k=i.getNormalAt(1,!0),l=g.getNormalAt(0,!0),m=k.getDirectedAngle(l)<0?-c:c;if(k.setLength(m),l.setLength(m),f&&(e(j),e(j.add(k))),"miter"===b){var n=new q(j.add(k),new h(-k.y,k.x),!0).intersect(new q(j.add(l),new h(-l.y,l.x),!0),!0);if(n&&j.getDistance(n)<=d&&(e(n),!f))return}f||e(j.add(k)),e(j.add(l))},_addSquareCap:function(a,b,c,d,e){var f=a._point,g=a.getLocation(),h=g.getNormal().normalize(c);e&&(d(f.subtract(h)),d(f.add(h))),"square"===b&&(f=f.add(h.rotate(0==g.getParameter()?-90:90))),d(f.add(h)),d(f.subtract(h))},getHandleBounds:function(a,b,c,d,e,f){var g=Array(6),h=1/0,i=-h,j=h,k=i;e=e/2||0,f=f/2||0;for(var l=0,m=a.length;m>l;l++){var o=a[l];o._transformCoordinates(d,g,!1);for(var p=0;6>p;p+=2){var q=0==p?f:e,r=g[p],s=g[p+1],t=r-q,u=r+q,v=s-q,w=s+q;h>t&&(h=t),u>i&&(i=u),j>v&&(j=v),w>k&&(k=w)}}return new n(h,j,i-h,k-j)},getRoughBounds:function(a,b,c,d){var e=c.getStrokeColor()?c.getStrokeWidth():0,f=e;return 0===e?e=1e-5:("miter"===c.getStrokeJoin()&&(f=e*c.getMiterLimit()),"square"===c.getStrokeCap()&&(f=Math.max(f,e*Math.sqrt(2)))),F.getHandleBounds(a,b,c,d,e,f)}}});F.inject({statics:new function(){function a(a,c,e){for(var f=new F,g=Array(4),h=0;4>h;h++){var i=d[h];g[h]=new A(i._point.multiply(c).add(a),i._handleIn.multiply(c),i._handleOut.multiply(c))}return f._add(g),f._closed=!0,f.set(b.getNamed(e))}var c=g.KAPPA,d=[new A([-1,0],[0,c],[0,-c]),new A([0,-1],[-c,0],[c,0]),new A([1,0],[0,-c],[0,c]),new A([0,1],[c,0],[-c,0])];return{Line:function(){return new F(h.readNamed(arguments,"from"),h.readNamed(arguments,"to")).set(b.getNamed(arguments))},Circle:function(){var c=h.readNamed(arguments,"center"),d=b.readNamed(arguments,"radius");return a(c,new k(d),arguments)},Rectangle:function(){var a=n.readNamed(arguments,"rectangle"),d=k.readNamed(arguments,"radius",0,0,{readNull:!0}),e=a.getBottomLeft(!0),f=a.getTopLeft(!0),g=a.getTopRight(!0),h=a.getBottomRight(!0);if(path=new F,!d||d.isZero())path._add([new A(e),new A(f),new A(g),new A(h)]);else{d=k.min(d,a.getSize(!0).divide(2));var i=d.width,j=d.height,l=i*c,m=j*c;path._add([new A(e.add(i,0),null,[-l,0]),new A(e.subtract(0,j),[0,m]),new A(f.add(0,j),null,[0,-m]),new A(f.add(i,0),[-l,0],null),new A(g.subtract(i,0),null,[l,0]),new A(g.add(0,j),[0,-m],null),new A(h.subtract(0,j),null,[0,m]),new A(h.subtract(i,0),[l,0])])}return path._closed=!0,path.set(b.getNamed(arguments))},RoundRectangle:"#Rectangle",Ellipse:function(){var b=w._readEllipse(arguments);return a(b.center,b.radius,arguments)},Oval:"#Ellipse",Arc:function(){var a=h.readNamed(arguments,"from"),c=h.readNamed(arguments,"through"),d=h.readNamed(arguments,"to"),e=new F;return e.moveTo(a),e.arcTo(c,d),e.set(b.getNamed(arguments))},RegularPolygon:function(){for(var a=h.readNamed(arguments,"center"),c=b.readNamed(arguments,"sides"),d=b.readNamed(arguments,"radius"),e=new F,f=360/c,g=!(c%3),i=new h(0,g?-d:d),j=g?-1:.5,k=Array(c),l=0;c>l;l++)k[l]=new A(a.add(i.rotate((l+j)*f)));return e._add(k),e._closed=!0,e.set(b.getNamed(arguments))},Star:function(){for(var a=h.readNamed(arguments,"center"),c=2*b.readNamed(arguments,"points"),d=b.readNamed(arguments,"radius1"),e=b.readNamed(arguments,"radius2"),f=new F,g=360/c,i=new h(0,-1),j=Array(c),k=0;c>k;k++)j[k]=new A(a.add(i.rotate(g*k).multiply(k%2?e:d)));return f._add(j),f._closed=!0,f.set(b.getNamed(arguments))}}}});var G=E.extend({_class:"CompoundPath",_serializeFields:{children:[]},initialize:function(a){this._children=[],this._namedChildren={},this._initialize(a)||this.addChildren(Array.isArray(a)?a:arguments)},insertChildren:function tb(b,c,d){c=tb.base.call(this,b,c,d,"path");for(var e=0,f=!d&&c&&c.length;f>e;e++){var g=c[e];g._clockwise===a&&g.setClockwise(0===g._index)}return c},reverse:function(){for(var a=this._children,b=0,c=a.length;c>b;b++)a[b].reverse()},smooth:function(){for(var a=0,b=this._children.length;b>a;a++)this._children[a].smooth()},isClockwise:function(){var a=this.getFirstChild();return a&&a.isClockwise()},setClockwise:function(a){this.isClockwise()!=!!a&&this.reverse()},getFirstSegment:function(){var a=this.getFirstChild();return a&&a.getFirstSegment()},getLastSegment:function(){var a=this.getLastChild();return a&&a.getLastSegment()},getCurves:function(){for(var a=this._children,b=[],c=0,d=a.length;d>c;c++)b=b.concat(a[c].getCurves());return b},getFirstCurve:function(){var a=this.getFirstChild();return a&&a.getFirstCurve()},getLastCurve:function(){var a=this.getLastChild();return a&&a.getFirstCurve()},getArea:function(){for(var a=this._children,b=0,c=0,d=a.length;d>c;c++)b+=a[c].getArea();return b},getPathData:function(){for(var a=this._children,b=[],c=0,d=a.length;d>c;c++)b.push(a[c].getPathData(arguments[0]));return b.join(" ")},_getWinding:function(a){for(var b=this._children,c=0,d=0,e=b.length;e>d;d++)c+=b[d]._getWinding(a);return c},_hitTest:function ub(a,c){var d=ub.base.call(this,a,new b(c,{fill:!1}));if(!d)if(c.compoundChildren)for(var e=this._children,f=e.length-1;f>=0&&!d;f--)d=e[f]._hitTest(a,c);else c.fill&&this.hasFill()&&this._contains(a)&&(d=new z("fill",this));return d},_draw:function(a,b){var c=this._children;if(0!==c.length){a.beginPath(),b=b.extend({compound:!0});for(var d=0,e=c.length;e>d;d++)c[d].draw(a,b);if(!b.clip){this._setStyles(a);var f=this._style;f.hasFill()&&(a.fill(f.getWindingRule()),a.shadowColor="rgba(0,0,0,0)"),f.hasStroke()&&a.stroke()}}}},new function(){function a(a){if(!a._children.length)throw Error("Use a moveTo() command first");return a._children[a._children.length-1]}var c={moveTo:function(){var a=new F;this.addChild(a),a.moveTo.apply(a,arguments)},moveBy:function(){this.moveTo(a(this).getLastSegment()._point.add(h.read(arguments)))},closePath:function(){a(this).closePath()}};return b.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(b){c[b]=function(){var c=a(this);c[b].apply(c,arguments)}}),c}),H=b.extend({initialize:function(a){function b(a,b){var c=C.getValues(a,b);f.curves.push(c),f._computeParts(c,a._index,0,1)}this.curves=[],this.parts=[],this.length=0,this.index=0;for(var c,d=a._segments,e=d[0],f=this,g=1,h=d.length;h>g;g++)c=d[g],b(e,c),e=c;a._closed&&b(c,d[0])},_computeParts:function(a,b,c,d){if(d-c>1/32&&!C.isFlatEnough(a,.25)){var e=C.subdivide(a),f=(c+d)/2;this._computeParts(e[0],b,c,f),this._computeParts(e[1],b,f,d)}else{var g=a[6]-a[0],h=a[7]-a[1],i=Math.sqrt(g*g+h*h);i>1e-5&&(this.length+=i,this.parts.push({offset:this.length,value:d,index:b}))}},getParameterAt:function(a){for(var b,c=this.index;b=c,!(0==c||this.parts[--c].offset<a););for(var d=this.parts.length;d>b;b++){var e=this.parts[b];if(e.offset>=a){this.index=b;var f=this.parts[b-1],g=f&&f.index==e.index?f.value:0,h=f?f.offset:0;return{value:g+(e.value-g)*(a-h)/(e.offset-h),index:e.index}}}var e=this.parts[this.parts.length-1];return{value:1,index:e.index}},evaluate:function(a,b){var c=this.getParameterAt(a);return C.evaluate(this.curves[c.index],c.value,b)},drawPart:function(a,b,c){b=this.getParameterAt(b),c=this.getParameterAt(c);for(var d=b.index;d<=c.index;d++){var e=C.getPart(this.curves[d],d==b.index?b.value:0,d==c.index?c.value:1);d==b.index&&a.moveTo(e[0],e[1]),a.bezierCurveTo.apply(a,e.slice(2))}}}),I=b.extend({initialize:function(a,b){this.points=[];for(var c,d=a._segments,e=0,f=d.length;f>e;e++){var g=d[e].point.clone();c&&c.equals(g)||(this.points.push(g),c=g)}this.error=b},fit:function(){var a=this.points,b=a.length;return this.segments=b>0?[new A(a[0])]:[],b>1&&this.fitCubic(0,b-1,a[1].subtract(a[0]).normalize(),a[b-2].subtract(a[b-1]).normalize()),this.segments},fitCubic:function(b,c,d,e){if(1==c-b){var f=this.points[b],g=this.points[c],h=f.getDistance(g)/3;return this.addCurve([f,f.add(d.normalize(h)),g.add(e.normalize(h)),g]),a}for(var i,j=this.chordLengthParameterize(b,c),k=Math.max(this.error,this.error*this.error),l=0;4>=l;l++){var m=this.generateBezier(b,c,j,d,e),n=this.findMaxError(b,c,m,j);if(n.error<this.error)return this.addCurve(m),a;if(i=n.index,n.error>=k)break;this.reparameterize(b,c,j,m),k=n.error}var o=this.points[i-1].subtract(this.points[i]),p=this.points[i].subtract(this.points[i+1]),q=o.add(p).divide(2).normalize();this.fitCubic(b,i,d,q),this.fitCubic(i,c,q.negate(),e)},addCurve:function(a){var b=this.segments[this.segments.length-1];b.setHandleOut(a[1].subtract(a[0])),this.segments.push(new A(a[3],a[2].subtract(a[3])))},generateBezier:function(a,b,c,d,e){for(var f=1e-11,g=this.points[a],h=this.points[b],i=[[0,0],[0,0]],j=[0,0],k=0,l=b-a+1;l>k;k++){var m=c[k],n=1-m,o=3*m*n,p=n*n*n,q=o*n,r=o*m,s=m*m*m,t=d.normalize(q),u=e.normalize(r),v=this.points[a+k].subtract(g.multiply(p+q)).subtract(h.multiply(r+s));i[0][0]+=t.dot(t),i[0][1]+=t.dot(u),i[1][0]=i[0][1],i[1][1]+=u.dot(u),j[0]+=t.dot(v),j[1]+=u.dot(v)}var w,x,y=i[0][0]*i[1][1]-i[1][0]*i[0][1];if(Math.abs(y)>f){var z=i[0][0]*j[1]-i[1][0]*j[0],A=j[0]*i[1][1]-j[1]*i[0][1];w=A/y,x=z/y}else{var B=i[0][0]+i[0][1],C=i[1][0]+i[1][1];w=x=Math.abs(B)>f?j[0]/B:Math.abs(C)>f?j[1]/C:0}var D=h.getDistance(g);return f*=D,(f>w||f>x)&&(w=x=D/3),[g,g.add(d.normalize(w)),h.add(e.normalize(x)),h]},reparameterize:function(a,b,c,d){for(var e=a;b>=e;e++)c[e-a]=this.findRoot(d,this.points[e],c[e-a])},findRoot:function(a,b,c){for(var d=[],e=[],f=0;2>=f;f++)d[f]=a[f+1].subtract(a[f]).multiply(3);for(var f=0;1>=f;f++)e[f]=d[f+1].subtract(d[f]).multiply(2);var g=this.evaluate(3,a,c),h=this.evaluate(2,d,c),i=this.evaluate(1,e,c),j=g.subtract(b),k=h.dot(h)+j.dot(i);return Math.abs(k)<1e-5?c:c-j.dot(h)/k},evaluate:function(a,b,c){for(var d=b.slice(),e=1;a>=e;e++)for(var f=0;a-e>=f;f++)d[f]=d[f].multiply(1-c).add(d[f+1].multiply(c));return d[0]},chordLengthParameterize:function(a,b){for(var c=[0],d=a+1;b>=d;d++)c[d-a]=c[d-a-1]+this.points[d].getDistance(this.points[d-1]);for(var d=1,e=b-a;e>=d;d++)c[d]/=c[e];return c},findMaxError:function(a,b,c,d){for(var e=Math.floor((b-a+1)/2),f=0,g=a+1;b>g;g++){var h=this.evaluate(3,c,d[g-a]),i=h.subtract(this.points[g]),j=i.x*i.x+i.y*i.y;j>=f&&(f=j,e=g)}return{error:f,index:e}}});E.inject(new function(){function a(a,b){a.sort(function(a,b){var c=a.getPath(),d=b.getPath();return c===d?a.getIndex()+a.getParameter()-(b.getIndex()+b.getParameter()):c._id-d._id});for(var c=b&&[],d=a.length-1;d>=0;d--){var e=a[d],f=e.getIntersection(),g=e.divide(),h=g&&g.getSegment1()||e.getSegment();c&&c.push(f),h._intersection=f,e._segment=h}return c}function b(a){if(a instanceof G){var b,c=a.removeChildren(),d=c.length,e=Array(d),f=Array(d);c.sort(function(a,b){var c=a.getBounds(),d=b.getBounds();return c._width*c._height<d._width*d._height}),a.addChildren(c),b=c[0].isClockwise();for(var g=0;d>g;g++)e[g]=c[g].getBounds(),f[g]=0;for(var g=0;d>g;g++){for(var h=1;d>h;h++)g!==h&&e[g].contains(e[h])&&f[h]++;g>0&&0===f[g]%2&&c[g].setClockwise(b)}}return a}function c(c,e,f,g){c=b(c.clone(!1)),e=b(e.clone(!1));var i=c.isClockwise(),j=e.isClockwise(),k=c.getIntersections(e);a(a(k,!0)),i||c.reverse(),g^j||e.reverse(),i=!0,j=!g;for(var l=[].concat(c._children||[c]).concat(e._children||[e]),m=[],n=new G,o=0,p=l.length;p>o;o++){var q=l[o],r=q._parent,s=q.isClockwise(),t=q._segments;q=r instanceof G?r:q;for(var u=t.length-1;u>=0;u--){var v=t[u],w=v.getCurve().getPoint(.5),x=q!==c&&c.contains(w)&&(s===i||g||!d(c,w)),y=q!==e&&e.contains(w)&&(s===j||!d(e,w));f(q===c,x,y)?v._invalid=!0:m.push(v)}}for(var o=0,p=m.length;p>o;o++){var v=m[o];if(!v._visited){var q=new F,z=v._intersection,B=z&&z.getSegment(!0);v.getPrevious()._invalid&&v.setHandleIn(B?B._handleIn:new h(0,0));do{if(v._visited=!0,v._invalid&&v._intersection){var C=v._intersection.getSegment(!0);q.add(new A(v._point,v._handleIn,C._handleOut)),C._visited=!0,v=C}else q.add(v.clone());v=v.getNext()}while(v&&!v._visited&&v!==B);var D=q._segments.length;D>1&&(D>2||!q.isPolygon())?(q.setClosed(!0),n.addChild(q,!0)):q.remove()}}return c.remove(),e.remove(),n.reduce()}function d(a,b){var c=a.getCurves(),d=a.getBounds();if(d.contains(b))for(var e=0,f=c.length;f>e;e++){var g=c[e];if(g.getBounds().contains(b)&&g.getParameterOf(b))return!0}return!1}return{unite:function(a){return c(this,a,function(a,b,c){return b||c})},intersect:function(a){return c(this,a,function(a,b,c){return!(b||c)})},subtract:function(a){return c(this,a,function(a,b,c){return a&&c||!a&&!b},!0)},exclude:function(a){return new u([this.subtract(a),a.subtract(this)])},divide:function(a){return new u([this.subtract(a),this.intersect(a)])}}});var J=t.extend({_class:"TextItem",_boundsSelected:!0,_serializeFields:{content:null},_boundsGetter:"getBounds",initialize:function(c){this._content="",this._lines=[];var d=c&&b.isPlainObject(c)&&c.x===a&&c.y===a;this._initialize(d&&c,!d&&h.read(arguments))},_equals:function(a){return this._content===a._content},_clone:function vb(a){return a.setContent(this._content),vb.base.call(this,a)},getContent:function(){return this._content},setContent:function(a){this._content=""+a,this._lines=this._content.split(/\r\n|\n|\r/gm),this._changed(69)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),K=J.extend({_class:"PointText",initialize:function(){J.apply(this,arguments)},clone:function(a){return this._clone(new K({insert:!1}),a)},getPoint:function(){var a=this._matrix.getTranslation();return new j(a.x,a.y,this,"setPoint")},setPoint:function(a){a=h.read(arguments),this.translate(a.subtract(this._matrix.getTranslation()))},_draw:function(a){if(this._content){this._setStyles(a);var b=this._style,c=this._lines,d=b.getLeading(),e=a.shadowColor;a.font=b.getFontStyle(),a.textAlign=b.getJustification();for(var f=0,g=c.length;g>f;f++){a.shadowColor=e;var h=c[f];b.hasFill()&&(a.fillText(h,0,0),a.shadowColor="rgba(0,0,0,0)"),b.hasStroke()&&a.strokeText(h,0,0),a.translate(0,d)}}}},new function(){var a=null;return{_getBounds:function(b,c){a||(a=_.getContext(1,1));var d=this._style,e=this._lines,f=e.length,g=d.getJustification(),h=d.getLeading(),i=0;a.font=d.getFontStyle();for(var j=0,k=0;f>k;k++)j=Math.max(j,a.measureText(e[k]).width);"left"!==g&&(i-=j/("center"===g?2:1));var l=new n(i,f?-.75*h:0,j,f*h);return c?c._transformBounds(l,l):l}}}),L=b.extend(new function(){function a(a){var b,d=a.match(/^#(\w{1,2})(\w{1,2})(\w{1,2})$/);if(d){b=[0,0,0];for(var e=0;3>e;e++){var f=d[e+1];b[e]=parseInt(1==f.length?f+f:f,16)/255}}else if(d=a.match(/^rgba?\((.*)\)$/)){b=d[1].split(",");for(var e=0,h=b.length;h>e;e++){var f=parseFloat(b[e]);b[e]=3>e?f/255:f}}else{var i=g[a];if(!i){c||(c=_.getContext(1,1),c.globalCompositeOperation="copy"),c.fillStyle="rgba(0,0,0,0)",c.fillStyle=a,c.fillRect(0,0,1,1);var j=c.getImageData(0,0,1,1).data;i=g[a]=[j[0]/255,j[1]/255,j[2]/255]}b=i.slice()}return b}var c,d={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},e={},g={},i=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],j={"rgb-hsb":function(a,b,c){var d=Math.max(a,b,c),e=Math.min(a,b,c),f=d-e,g=0===f?0:60*(d==a?(b-c)/f+(c>b?6:0):d==b?(c-a)/f+2:(a-b)/f+4);return[g,0===d?0:f/d,d]},"hsb-rgb":function(a,b,c){var a=a/60%6,d=Math.floor(a),e=a-d,d=i[d],f=[c,c*(1-b),c*(1-b*e),c*(1-b*(1-e))];return[f[d[0]],f[d[1]],f[d[2]]]},"rgb-hsl":function(a,b,c){var d=Math.max(a,b,c),e=Math.min(a,b,c),f=d-e,g=0===f,h=g?0:60*(d==a?(b-c)/f+(c>b?6:0):d==b?(c-a)/f+2:(a-b)/f+4),i=(d+e)/2,j=g?0:.5>i?f/(d+e):f/(2-d-e);return[h,j,i]},"hsl-rgb":function(a,b,c){if(a/=360,0===b)return[c,c,c];for(var d=[a+1/3,a,a-1/3],e=.5>c?c*(1+b):c+b-c*b,f=2*c-e,g=[],h=0;3>h;h++){var i=d[h];0>i&&(i+=1),i>1&&(i-=1),g[h]=1>6*i?f+6*(e-f)*i:1>2*i?e:2>3*i?f+6*(e-f)*(2/3-i):f}return g},"rgb-gray":function(a,b,c){return[.2989*a+.587*b+.114*c]},"gray-rgb":function(a){return[a,a,a]},"gray-hsb":function(a){return[0,0,a]},"gray-hsl":function(a){return[0,0,a]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return b.each(d,function(a,c){e[c]=[],b.each(a,function(a,f){var g=b.capitalize(a),i=/^(hue|saturation)$/.test(a),j=e[c][f]="gradient"===a?function(a){var b=this._components[0];return a=M.read(Array.isArray(a)?a:arguments,0,0,{readNull:!0}),b!==a&&(b&&b._removeOwner(this),a&&a._addOwner(this)),a}:"hue"===a?function(a){return isNaN(a)?0:(a%360+360)%360}:"gradient"===c?function(){return h.read(arguments,0,0,{readNull:"highlight"===a,clone:!0})}:function(a){return isNaN(a)?0:Math.min(Math.max(a,0),1)};this["get"+g]=function(){return this._type===c||i&&/^hs[bl]$/.test(this._type)?this._components[f]:this._convert(c)[f]},this["set"+g]=function(a){this._type===c||i&&/^hs[bl]$/.test(this._type)||(this._components=this._convert(c),this._properties=d[c],this._type=c),a=j.call(this,a),null!=a&&(this._components[f]=a,this._changed())}},this)},{_class:"Color",_readIndex:!0,initialize:function k(b){var c,f,g,h,i=Array.prototype.slice,j=arguments,l=0,m=!0;Array.isArray(b)&&(j=b,b=j[0]);var n=null!=b&&typeof b;if("string"===n&&b in d&&(c=b,b=j[1],Array.isArray(b)?(f=b,g=j[2]):(this.__read&&(l=1),j=i.call(j,1),n=typeof b)),!f){if(m=!(this.__options&&this.__options.dontParse),h="number"===n?j:"object"===n&&null!=b.length?b:null){c||(c=h.length>=3?"rgb":"gray");var o=d[c].length;g=h[o],this.__read&&(l+=h===arguments?o+(null!=g?1:0):1),h.length>o&&(h=i.call(h,0,o))}else if("string"===n)c="rgb",f=a(b),4===f.length&&(g=f[3],f.length--);else if("object"===n)if(b.constructor===k){if(c=b._type,f=b._components.slice(),g=b._alpha,"gradient"===c)for(var p=1,q=f.length;q>p;p++){var r=f[p];r&&(f[p]=r.clone())}}else if(b.constructor===M)c="gradient",h=j;else{c="hue"in b?"lightness"in b?"hsl":"hsb":"gradient"in b||"stops"in b||"radial"in b?"gradient":"gray"in b?"gray":"rgb";var s=d[c];u=m&&e[c],this._components=f=[];for(var p=0,q=s.length;q>p;p++){var t=b[s[p]];null==t&&0===p&&"gradient"===c&&"stops"in b&&(t={stops:b.stops,radial:b.radial}),m&&(t=u[p].call(this,t)),null!=t&&(f[p]=t)}g=b.alpha}this.__read&&c&&(l=1)}if(this._type=c||"rgb","gradient"===c&&(this._id=k._id=(k._id||0)+1),!f){this._components=f=[];for(var u=e[this._type],p=0,q=u.length;q>p;p++){var t=h&&h[p];m&&(t=u[p].call(this,t)),null!=t&&(f[p]=t)}}this._components=f,this._properties=d[this._type],this._alpha=g,this.__read&&(this.__read=l)},_serialize:function(a,c){var d=this.getComponents();return b.serialize(/^(gray|rgb)$/.test(this._type)?d:[this._type].concat(d),a,!0,c)},_changed:function(){this._canvasStyle=null,this._owner&&this._owner._changed(17)},_convert:function(a){var b;return this._type===a?this._components.slice():(b=j[this._type+"-"+a])?b.apply(this,this._components):j["rgb-"+a].apply(this,j[this._type+"-rgb"].apply(this,this._components))},convert:function(a){return new L(a,this._convert(a),this._alpha)},getType:function(){return this._type},setType:function(a){this._components=this._convert(a),this._properties=d[a],this._type=a},getComponents:function(){var a=this._components.slice();return null!=this._alpha&&a.push(this._alpha),a},getAlpha:function(){return null!=this._alpha?this._alpha:1},setAlpha:function(a){this._alpha=null==a?null:Math.min(Math.max(a,0),1),this._changed()},hasAlpha:function(){return null!=this._alpha},equals:function(a){return b.isPlainValue(a)&&(a=L.read(arguments)),a===this||a&&this._class===a._class&&this._type===a._type&&this._alpha===a._alpha&&b.equals(this._components,a._components)||!1
},toString:function(){for(var a=this._properties,b=[],c="gradient"===this._type,d=f.instance,e=0,g=a.length;g>e;e++){var h=this._components[e];null!=h&&b.push(a[e]+": "+(c?h:d.number(h)))}return null!=this._alpha&&b.push("alpha: "+d.number(this._alpha)),"{ "+b.join(", ")+" }"},toCSS:function(a){var b=this._convert("rgb"),c=a||null==this._alpha?1:this._alpha;return b=[Math.round(255*b[0]),Math.round(255*b[1]),Math.round(255*b[2])],1>c&&b.push(c),a?"#"+((1<<24)+(b[0]<<16)+(b[1]<<8)+b[2]).toString(16).slice(1):(4==b.length?"rgba(":"rgb(")+b.join(",")+")"},toCanvasStyle:function(a){if(this._canvasStyle)return this._canvasStyle;if("gradient"!==this._type)return this._canvasStyle=this.toCSS();var b,c=this._components,d=c[0],e=d._stops,f=c[1],g=c[2];if(d._radial){var h=g.getDistance(f),i=c[3];if(i){var j=i.subtract(f);j.getLength()>h&&(i=f.add(j.normalize(h-.1)))}var k=i||f;b=a.createRadialGradient(k.x,k.y,0,f.x,f.y,h)}else b=a.createLinearGradient(f.x,f.y,g.x,g.y);for(var l=0,m=e.length;m>l;l++){var n=e[l];b.addColorStop(n._rampPoint,n._color.toCanvasStyle())}return this._canvasStyle=b},transform:function(a){if("gradient"===this._type){for(var b=this._components,c=1,d=b.length;d>c;c++){var e=b[c];a._transformPoint(e,e,!0)}this._changed()}},statics:{_types:d,random:function(){var a=Math.random;return new L(a(),a(),a())}}})},new function(){function a(a,b){return 0>a?0:b&&a>360?360:!b&&a>1?1:a}var c={add:function(b,c,d){return a(b+c,d)},subtract:function(b,c,d){return a(b-c,d)},multiply:function(b,c,d){return a(b*c,d)},divide:function(b,c,d){return a(b/c,d)}};return b.each(c,function(a,b){var c={dontParse:/^(multiply|divide)$/.test(b)};this[b]=function(b){b=L.read(arguments,0,0,c);for(var d=this._type,e=this._properties,f=this._components,g=b._convert(d),h=0,i=f.length;i>h;h++)g[h]=a(f[h],g[h],"hue"===e[h]);return new L(d,g,null!=this._alpha?a(this._alpha,b.getAlpha()):null)}},{})});b.each(L._types,function(a,c){var d=this[b.capitalize(c)+"Color"]=function(a){var b=null!=a&&typeof a,d="object"===b&&null!=a.length?a:"string"===b?null:arguments;return d?new L(c,d):new L(a)};if(3==c.length){var e=c.toUpperCase();L[e]=this[e+"Color"]=d}},b.exports);var M=b.extend({_class:"Gradient",initialize:function wb(a,b){this._id=wb._id=(wb._id||0)+1,a&&this._set(a)&&(a=b=null),this._stops||this.setStops(a||["white","black"]),null==this._radial&&this.setRadial("string"==typeof b&&"radial"===b||b||!1)},_serialize:function(a,c){return c.add(this,function(){return b.serialize([this._stops,this._radial],a,!0,c)})},_changed:function(){for(var a=0,b=this._owners&&this._owners.length;b>a;a++)this._owners[a]._changed()},_addOwner:function(a){this._owners||(this._owners=[]),this._owners.push(a)},_removeOwner:function(a){var b=this._owners?this._owners.indexOf(a):-1;-1!=b&&(this._owners.splice(b,1),0===this._owners.length&&delete this._owners)},clone:function(){for(var a=[],b=0,c=this._stops.length;c>b;b++)a[b]=this._stops[b].clone();return new M(a)},getStops:function(){return this._stops},setStops:function(a){if(this.stops)for(var b=0,c=this._stops.length;c>b;b++)delete this._stops[b]._owner;if(a.length<2)throw Error("Gradient stop list needs to contain at least two stops.");this._stops=N.readAll(a,0,!1,!0);for(var b=0,c=this._stops.length;c>b;b++){var d=this._stops[b];d._owner=this,d._defaultRamp&&d.setRampPoint(b/(c-1))}this._changed()},getRadial:function(){return this._radial},setRadial:function(a){this._radial=a,this._changed()},equals:function(a){if(a===this)return!0;if(a&&this._class===a._class&&this._stops.length===a._stops.length){for(var b=0,c=this._stops.length;c>b;b++)if(!this._stops[b].equals(a._stops[b]))return!1;return!0}return!1}}),N=b.extend({_class:"GradientStop",initialize:function(b,c){if(b){var d,e;c===a&&Array.isArray(b)?(d=b[0],e=b[1]):b.color?(d=b.color,e=b.rampPoint):(d=b,e=c),this.setColor(d),this.setRampPoint(e)}},clone:function(){return new N(this._color.clone(),this._rampPoint)},_serialize:function(a,c){return b.serialize([this._color,this._rampPoint],a,!0,c)},_changed:function(){this._owner&&this._owner._changed(17)},getRampPoint:function(){return this._rampPoint},setRampPoint:function(a){this._defaultRamp=null==a,this._rampPoint=a||0,this._changed()},getColor:function(){return this._color},setColor:function(a){this._color=L.read(arguments),this._color===a&&(this._color=a.clone()),this._color._owner=this,this._changed()},equals:function(a){return a===this||a&&this._class===a._class&&this._color.equals(a._color)&&this._rampPoint==a._rampPoint||!1}}),O=b.extend(new function(){var c={fillColor:a,strokeColor:a,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",miterLimit:10,dashOffset:0,dashArray:[],windingRule:"nonzero",shadowColor:a,shadowBlur:0,shadowOffset:new h,selectedColor:a,font:"sans-serif",fontSize:12,leading:null,justification:"left"},d={strokeWidth:25,strokeCap:25,strokeJoin:25,miterLimit:25,font:5,fontSize:5,leading:5,justification:5},e={},f={_defaults:c,_textDefaults:new b(c,{fillColor:new L})};return b.each(c,function(c,g){var h=/Color$/.test(g),i=b.capitalize(g),j=d[g],k="set"+i,l="get"+i;f[k]=function(a){var b=this._item&&this._item._children;if(b&&b.length>0&&"compound-path"!==this._item._type)for(var c=0,d=b.length;d>c;c++)b[c]._style[k](a);else{var e=this._values[g];e!=a&&(h&&(e&&delete e._owner,a&&a.constructor===L&&(a._owner&&(a=a.clone()),a._owner=this._item)),this._values[g]=a,this._item&&this._item._changed(j||17))}},f[l]=function(){var c,d=this._item&&this._item._children;if(!d||0===d.length||arguments[0]||"compound-path"===this._item._type){var c=this._values[g];return c===a?(c=this._defaults[g],c&&c.clone&&(c=c.clone()),this._values[g]=c):!h||c&&c.constructor===L||(this._values[g]=c=L.read([c],0,0,{readNull:!0,clone:!0}),c&&(c._owner=this._item)),c}for(var e=0,f=d.length;f>e;e++){var i=d[e]._style[l]();if(0===e)c=i;else if(!b.equals(c,i))return a}return c},e[l]=function(){return this._style[l]()},e[k]=function(a){this._style[k](a)}}),t.inject(e),f},{_class:"Style",initialize:function(a,b){this._values={},this._item=b,b instanceof J&&(this._defaults=this._textDefaults),a&&this.set(a)},set:function(a){var b=a instanceof O,c=b?a._values:a;if(c)for(var d in c)if(d in this._defaults){var e=c[d];this[d]=e&&b&&e.clone?e.clone():e}},equals:function(a){return a===this||a&&this._class===a._class&&b.equals(this._values,a._values)||!1},hasFill:function(){return!!this.getFillColor()},hasStroke:function(){return!!this.getStrokeColor()&&this.getStrokeWidth()>0},hasShadow:function(){return!!this.getShadowColor()&&this.getShadowBlur()>0},getLeading:function xb(){var a=xb.base.call(this);return null!=a?a:1.2*this.getFontSize()},getFontStyle:function(){var a=this.getFontSize();return a+(/[a-z]/i.test(a+"")?" ":"px ")+this.getFont()}}),P=new function(){function c(a,d){for(var e=[],f=0,g=a&&a.length;g>f;){var h=a[f++];if("string"==typeof h)h=document.createElement(h);else if(!h||!h.nodeType)continue;b.isPlainObject(a[f])&&P.set(h,a[f++]),Array.isArray(a[f])&&c(a[f++],h),d&&d.appendChild(h),e.push(h)}return e}var d=/^(checked|value|selected|disabled)$/i,e={text:"textContent",html:"innerHTML"},f={lineHeight:1,zoom:1,zIndex:1,opacity:1};return{create:function(a,b){var d=Array.isArray(a),e=c(d?a:arguments,d?b:null);return 1==e.length?e[0]:e},find:function(a,b){return(b||document).querySelector(a)},findAll:function(a,b){return(b||document).querySelectorAll(a)},get:function(a,b){return a?d.test(b)?"value"===b||"string"!=typeof a[b]?a[b]:!0:b in e?a[e[b]]:a.getAttribute(b):null},set:function(b,c,f){if("string"!=typeof c)for(var g in c)c.hasOwnProperty(g)&&this.set(b,g,c[g]);else{if(!b||f===a)return b;d.test(c)?b[c]=f:c in e?b[e[c]]=f:"style"===c?this.setStyle(b,f):"events"===c?Q.add(b,f):b.setAttribute(c,f)}return b},getStyles:function(a){var b=a&&9!==a.nodeType?a.ownerDocument:a,c=b&&b.defaultView;return c&&c.getComputedStyle(a,"")},getStyle:function(a,b){return a&&a.style[b]||this.getStyles(a)[b]||null},setStyle:function(a,b,c){if("string"!=typeof b)for(var d in b)b.hasOwnProperty(d)&&this.setStyle(a,d,b[d]);else!/^-?[\d\.]+$/.test(c)||b in f||(c+="px"),a.style[b]=c;return a},hasClass:function(a,b){return RegExp("\\s*"+b+"\\s*").test(a.className)},addClass:function(a,b){a.className=(a.className+" "+b).trim()},removeClass:function(a,b){a.className=a.className.replace(RegExp("\\s*"+b+"\\s*")," ").trim()},remove:function(a){a.parentNode&&a.parentNode.removeChild(a)},removeChildren:function(a){for(;a.firstChild;)a.removeChild(a.firstChild)},getBounds:function(a,b){var c,d=a.ownerDocument,e=d.body,f=d.documentElement;try{c=a.getBoundingClientRect()}catch(g){c={left:0,top:0,width:0,height:0}}var h=c.left-(f.clientLeft||e.clientLeft||0),i=c.top-(f.clientTop||e.clientTop||0);if(!b){var j=d.defaultView;h+=j.pageXOffset||f.scrollLeft||e.scrollLeft,i+=j.pageYOffset||f.scrollTop||e.scrollTop}return new n(h,i,c.width,c.height)},getViewportBounds:function(a){var b=a.ownerDocument,c=b.defaultView,d=b.documentElement;return new n(0,0,c.innerWidth||d.clientWidth,c.innerHeight||d.clientHeight)},getOffset:function(a,b){return this.getBounds(a,b).getPoint()},getSize:function(a){return this.getBounds(a,!0).getSize()},isInvisible:function(a){return this.getSize(a).equals(new k(0,0))},isInView:function(a){return!this.isInvisible(a)&&this.getViewportBounds(a).intersects(this.getBounds(a,!0))},getPrefixValue:function(a,b){for(var c=a[b],d=["webkit","moz","ms","o"],e=b[0].toUpperCase()+b.substring(1),f=0;4>f&&null==c;f++)c=a[d[f]+e];return c}}},Q={add:function(a,b){for(var c in b){var d=b[c];a.addEventListener?a.addEventListener(c,d,!1):a.attachEvent&&a.attachEvent("on"+c,d.bound=function(){d.call(a,window.event)})}},remove:function(a,b){for(var c in b){var d=b[c];a.removeEventListener?a.removeEventListener(c,d,!1):a.detachEvent&&a.detachEvent("on"+c,d.bound)}},getPoint:function(a){var b=a.targetTouches?a.targetTouches.length?a.targetTouches[0]:a.changedTouches[0]:a;return new h(b.pageX||b.clientX+document.documentElement.scrollLeft,b.pageY||b.clientY+document.documentElement.scrollTop)},getTarget:function(a){return a.target||a.srcElement},getOffset:function(a,b){return Q.getPoint(a).subtract(P.getOffset(b||Q.getTarget(a)))},preventDefault:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1},stopPropagation:function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},stop:function(a){Q.stopPropagation(a),Q.preventDefault(a)}};Q.requestAnimationFrame=new function(){function a(){for(var b=f.length-1;b>=0;b--){var h=f[b],i=h[0],j=h[1];(!j||("true"==d.getAttribute(j,"keepalive")||g)&&P.isInView(j))&&(f.splice(b,1),i())}c&&(f.length?c(a):e=!1)}var b,c=P.getPrefixValue(window,"requestAnimationFrame"),e=!1,f=[],g=!0;return Q.add(window,{focus:function(){g=!0},blur:function(){g=!1}}),function(d,g){f.push([d,g]),c?e||(c(a),e=!0):b||(b=setInterval(a,1e3/60))}};var R=b.extend(c,{_class:"View",initialize:function yb(a){this._scope=paper,this._project=paper.project,this._element=a;var b;if(this._id=a.getAttribute("id"),null==this._id&&a.setAttribute("id",this._id="view-"+yb._id++),Q.add(a,this._viewHandlers),d.hasAttribute(a,"resize")){var c=P.getOffset(a,!0),e=this;b=P.getViewportBounds(a).getSize().subtract(c),this._windowHandlers={resize:function(){P.isInvisible(a)||(c=P.getOffset(a,!0)),e.setViewSize(P.getViewportBounds(a).getSize().subtract(c))}},Q.add(window,this._windowHandlers)}else b=P.getSize(a),(b.isNaN()||b.isZero())&&(b=new k(parseInt(a.getAttribute("width"),10),parseInt(a.getAttribute("height"),10)));if(this._setViewSize(b),d.hasAttribute(a,"stats")&&"undefined"!=typeof Stats){this._stats=new Stats;var f=this._stats.domElement,g=f.style,c=P.getOffset(a);g.position="absolute",g.left=c.x+"px",g.top=c.y+"px",document.body.appendChild(f)}yb._views.push(this),yb._viewsById[this._id]=this,this._viewSize=b,(this._matrix=new p)._owner=this,this._zoom=1,yb._focused||(yb._focused=this),this._frameItems={},this._frameItemCount=0},remove:function(){return this._project?(R._focused==this&&(R._focused=null),R._views.splice(R._views.indexOf(this),1),delete R._viewsById[this._id],this._project.view==this&&(this._project.view=null),Q.remove(this._element,this._viewHandlers),Q.remove(window,this._windowHandlers),this._element=this._project=null,this.detach("frame"),this._frameItems={},!0):!1},_events:{onFrame:{install:function(){this._animate=!0,this._requested||this._requestFrame()},uninstall:function(){this._animate=!1}},onResize:{}},_animate:!1,_time:0,_count:0,_requestFrame:function(){var a=this;Q.requestAnimationFrame(function(){a._requested=!1,a._animate&&(a._requestFrame(),a._handleFrame())},this._element),this._requested=!0},_handleFrame:function(){paper=this._scope;var a=Date.now()/1e3,c=this._before?a-this._before:0;this._before=a,this._handlingFrame=!0,this.fire("frame",new b({delta:c,time:this._time+=c,count:this._count++})),this._stats&&this._stats.update(),this._handlingFrame=!1,this.draw(!0)},_animateItem:function(a,b){var c=this._frameItems;b?(c[a._id]={item:a,time:0,count:0},1===++this._frameItemCount&&this.attach("frame",this._handleFrameItems)):(delete c[a._id],0===--this._frameItemCount&&this.detach("frame",this._handleFrameItems))},_handleFrameItems:function(a){for(var c in this._frameItems){var d=this._frameItems[c];d.item.fire("frame",new b(a,{time:d.time+=a.delta,count:d.count++}))}},_redraw:function(){this._project._needsRedraw=!0,this._handlingFrame||(this._animate?this._handleFrame():this.draw())},_changed:function(a){1&a&&(this._project._needsRedraw=!0)},_transform:function(a){this._matrix.concatenate(a),this._bounds=null,this._redraw()},getElement:function(){return this._element},getViewSize:function(){var a=this._viewSize;return new m(a.width,a.height,this,"setViewSize")},setViewSize:function(a){a=k.read(arguments);var b=a.subtract(this._viewSize);b.isZero()||(this._viewSize.set(a.width,a.height),this._setViewSize(a),this._bounds=null,this.fire("resize",{size:a,delta:b}),this._redraw())},_setViewSize:function(a){var b=this._element;b.width=a.width,b.height=a.height},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new n(new h,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize(arguments[0])},getCenter:function(){return this.getBounds().getCenter(arguments[0])},setCenter:function(a){a=h.read(arguments),this.scrollBy(a.subtract(this.getCenter()))},getZoom:function(){return this._zoom},setZoom:function(a){this._transform((new p).scale(a/this._zoom,this.getCenter())),this._zoom=a},isVisible:function(){return P.isInView(this._element)},scrollBy:function(){this._transform((new p).translate(h.read(arguments).negate()))},projectToView:function(){return this._matrix._transformPoint(h.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(h.read(arguments))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(a){return"string"==typeof a&&(a=document.getElementById(a)),new S(a)}}},new function(){function a(a){var b=Q.getTarget(a);return b.getAttribute&&R._viewsById[b.getAttribute("id")]}function b(a,b){return a.viewToProject(Q.getOffset(b,a._element))}function c(){if(!R._focused||!R._focused.isVisible())for(var a=0,b=R._views.length;b>a;a++){var c=R._views[a];if(c&&c.isVisible()){R._focused=j=c;break}}}function d(c){var d=R._focused=a(c),e=b(d,c);k=!0,d._onMouseDown&&d._onMouseDown(c,e),(h=d._scope._tool)&&h._onHandleEvent("mousedown",e,c),d.draw(!0)}function e(d){var e;if(k||(e=a(d),e?(i=R._focused,R._focused=j=e):j&&j==R._focused&&(R._focused=i,c())),e=e||R._focused){var f=d&&b(e,d);e._onMouseMove&&e._onMouseMove(d,f),(h=e._scope._tool)&&h._onHandleEvent(k&&h.responds("mousedrag")?"mousedrag":"mousemove",f,d)&&Q.stop(d),e.draw(!0)}}function f(a){var c=R._focused;if(c&&k){var d=b(c,a);curPoint=null,k=!1,c._onMouseUp&&c._onMouseUp(a,d),h&&h._onHandleEvent("mouseup",d,a)&&Q.stop(a),c.draw(!0)}}function g(a){k&&Q.stop(a)}var h,i,j,k=!1;return Q.add(document,{mousemove:e,mouseup:f,touchmove:e,touchend:f,selectstart:g,scroll:c}),Q.add(window,{load:c}),{_viewHandlers:{mousedown:d,touchstart:d,selectstart:g},statics:{updateFocus:c}}}),S=R.extend({_class:"CanvasView",initialize:function(a){if(!(a instanceof HTMLCanvasElement)){var b=k.read(arguments);if(b.isZero())throw Error("Cannot create CanvasView with the provided argument: "+a);a=_.getCanvas(b)}if(this._context=a.getContext("2d"),this._eventCounters={},this._ratio=1,"off"!==d.getAttribute(a,"hidpi")){var c=window.devicePixelRatio||1,e=P.getPrefixValue(this._context,"backingStorePixelRatio")||1;this._ratio=c/e}R.call(this,a)},_setViewSize:function(a){var b=a.width,c=a.height,d=this._ratio,e=this._element,f=e.style;e.width=b*d,e.height=c*d,1!==d&&(f.width=b+"px",f.height=c+"px",this._context.scale(d,d))},draw:function(a){if(a&&!this._project._needsRedraw)return!1;var b=this._context,c=this._viewSize;return b.clearRect(0,0,c.width+1,c.height+1),this._project.draw(b,this._matrix,this._ratio),this._project._needsRedraw=!1,!0}},new function(){function a(a,b,c,d,e,f){for(var g,h=d;h;){if(h.responds(a)&&(g||(g=new W(a,b,c,d,e?c.subtract(e):null)),h.fire(a,g)&&(!f||g._stopped)))return!1;h=h.getParent()}return!0}function b(b,c,d,e,f){if(b._eventCounters[c]){var g=b._project,j=g.hitTest(e,{tolerance:g.options.hitTolerance||0,fill:!0,stroke:!0}),k=j&&j.item;if(k)return"mousemove"===c&&k!=h&&(f=e),"mousemove"===c&&i||a(c,d,e,k,f),k}}var c,d,e,f,g,h,i,j,k;return{_onMouseDown:function(a,h){var l=b(this,"mousedown",a,h);j=g==l&&Date.now()-k<300,f=g=l,c=d=e=h,i=f&&f.responds("mousedrag")},_onMouseUp:function(g,h){var l=b(this,"mouseup",g,h);i&&(d&&!d.equals(h)&&a("mousedrag",g,h,f,d),l!=f&&(e=h,a("mousemove",g,h,l,e))),l===f&&(k=Date.now(),(!j||a("doubleclick",g,c,l))&&a("click",g,c,l),j=!1),f=null,i=!1},_onMouseMove:function(c,g){f&&a("mousedrag",c,g,f,d);var i=b(this,"mousemove",c,g,e);d=e=g,i!==h&&(a("mouseleave",c,g,h),h=i,a("mouseenter",c,g,i))}}}),T=b.extend({_class:"Event",initialize:function(a){this.event=a},preventDefault:function(){this._prevented=!0,Q.preventDefault(this.event)},stopPropagation:function(){this._stopped=!0,Q.stopPropagation(this.event)},stop:function(){this.stopPropagation(),this.preventDefault()},getModifiers:function(){return V.modifiers}}),U=T.extend({_class:"KeyEvent",initialize:function(a,b,c,d){T.call(this,d),this.type=a?"keydown":"keyup",this.key=b,this.character=c},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),V=new function(){function a(a,c,e,i){var j,k=e?String.fromCharCode(e):"",l=d[c],m=l||k.toLowerCase(),n=a?"keydown":"keyup",o=R._focused,p=o&&o.isVisible()&&o._scope,q=p&&p._tool;h[m]=a,l&&(j=b.camelize(l))in f&&(f[j]=a),a?g[c]=e:delete g[c],q&&q.responds(n)&&(paper=p,q.fire(n,new U(a,m,k,i)),o&&o.draw(!0))}var c,d={8:"backspace",9:"tab",13:"enter",16:"shift",17:"control",18:"option",19:"pause",20:"caps-lock",27:"escape",32:"space",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",46:"delete",91:"command",93:"command",224:"command"},e={9:!0,13:!0,32:!0},f=new b({shift:!1,control:!1,option:!1,command:!1,capsLock:!1,space:!1}),g={},h={};return Q.add(document,{keydown:function(b){var f=b.which||b.keyCode;f in d?a(!0,f,f in e?f:0,b):c=f},keypress:function(b){null!=c&&(a(!0,c,b.which||b.keyCode,b),c=null)},keyup:function(b){var c=b.which||b.keyCode;c in g&&a(!1,c,g[c],b)}}),Q.add(window,{blur:function(b){for(var c in g)a(!1,c,g[c],b)}}),{modifiers:f,isDown:function(a){return!!h[a]}}},W=T.extend({_class:"MouseEvent",initialize:function(a,b,c,d,e){T.call(this,b),this.type=a,this.point=c,this.target=d,this.delta=e},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}});b.extend(c,{_class:"Palette",_events:["onChange"],initialize:function(c,d,e){var f=P.find(".palettejs-panel")||P.find("body").appendChild(P.create("div",{"class":"palettejs-panel"}));this._element=f.appendChild(P.create("table",{"class":"palettejs-pane"})),this._title=c,e||(e={});for(var g in this.components=d){var h=d[g];h instanceof X||(null==h.value&&(h.value=e[g]),h.name=g,h=d[g]=new X(h)),this._element.appendChild(h._element),h._palette=this,e[g]===a&&(e[g]=h.value)}this.values=b.each(e,function(a,c){var f=d[c];f&&b.define(e,c,{enumerable:!0,configurable:!0,get:function(){return f._value},set:function(a){f.setValue(a)}})}),window.paper&&paper.palettes.push(this)},reset:function(){for(var a in this.components)this.components[a].reset()},remove:function(){P.remove(this._element)}});var X=b.extend(c,{_class:"Component",_events:["onChange","onClick"],_types:{"boolean":{type:"checkbox",value:"checked"},string:{type:"text"},number:{type:"number",number:!0},button:{type:"button"},text:{tag:"div",value:"text"},slider:{type:"range",number:!0},list:{tag:"select",setOptions:function(){P.removeChildren(this._input),P.create(b.each(this._options,function(a){this.push("option",{value:a,text:a})},[]),this._input)}},color:{type:"color",getValue:function(a){return new L(a)},setValue:function(a){return new L(a).toCSS("color"===P.get(this._input,"type"))}}},initialize:function zb(a){this._id=zb._id=(zb._id||0)+1,this._type=a.type in this._types?a.type:"options"in a?"list":"onClick"in a?"button":typeof a.value,this._meta=this._types[this._type]||{type:this._type};var c=this,d="component-"+this._id;this._dontFire=!0,this._input=P.create(this._meta.tag||"input",{id:d,type:this._meta.type,events:{change:function(){c.setValue(P.get(this,c._meta.value||"value"))},click:function(){c.fire("click")}}}),this.attach("change",function(a){this._dontFire||this._palette.fire("change",this,this.name,a)}),this._element=P.create("tr",["td",[this._label=P.create("label",{"for":d})],"td",[this._input]]),b.each(a,function(a,b){this[b]=a},this),this._defaultValue=this._value,this._dontFire=!1},getType:function(){return this._type},getLabel:function(){return this.__label},setLabel:function(a){this.__label=a,P.set(this._label,"text",a+":")},getOptions:function(){return this._options},setOptions:function(a){this._options=a;var b=this._meta.setOptions;b&&b.call(this)},getValue:function(){var a=this._value,b=this._meta.getValue;return b?b.call(this,a):a},setValue:function(a){var b=this._meta.value||"value",c=this._meta.setValue;c&&(a=c.call(this,a)),P.set(this._input,b,a),a=P.get(this._input,b),this._meta.number&&(a=parseFloat(a,10)),this._value!==a&&(this._value=a,this._dontFire||this.fire("change",this.getValue()))},getRange:function(){return[parseFloat(P.get(this._input,"min")),parseFloat(P.get(this._input,"max"))]},setRange:function(a,b){var c=Array.isArray(a)?a:[a,b];P.set(this._input,{min:c[0],max:c[1]})},getMin:function(){return this.getRange()[0]},setMin:function(a){this.setRange(a,this.getMax())},getMax:function(){return this.getRange()[1]},setMax:function(a){this.setRange(this.getMin(),a)},getStep:function(){return parseFloat(P.get(this._input,"step"))},setStep:function(a){P.set(this._input,"step",a)},reset:function(){this.setValue(this._defaultValue)}}),Y=T.extend({_class:"ToolEvent",_item:null,initialize:function(a,b,c){this.tool=a,this.type=b,this.event=c},_choosePoint:function(a,b){return a?a:b?b.clone():null},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(a){this._point=a},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(a){this._lastPoint=a},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(a){this._downPoint=a},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(a){this._middlePoint=a},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(a){this._delta=a},getCount:function(){return/^mouse(down|up)$/.test(this.type)?this.tool._downCount:this.tool._count},setCount:function(a){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=a},getItem:function(){if(!this._item){var a=this.tool._scope.project.hitTest(this.getPoint());if(a){for(var b=a.item,c=b._parent;/^(group|compound-path)$/.test(c._type);)b=c,c=c._parent;this._item=b}}return this._item},setItem:function(a){this._item=a},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}}),Z=e.extend({_class:"Tool",_list:"tools",_reference:"_tool",_events:["onActivate","onDeactivate","onEditOptions","onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onKeyDown","onKeyUp"],initialize:function(a){e.call(this),this._firstMove=!0,this._count=0,this._downCount=0,this._set(a)},getMinDistance:function(){return this._minDistance},setMinDistance:function(a){this._minDistance=a,null!=this._minDistance&&null!=this._maxDistance&&this._minDistance>this._maxDistance&&(this._maxDistance=this._minDistance)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(a){this._maxDistance=a,null!=this._minDistance&&null!=this._maxDistance&&this._maxDistance<this._minDistance&&(this._minDistance=a)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(a){this._minDistance=a,this._maxDistance=a},_updateEvent:function(a,b,c,d,e,f,g){if(!e){if(null!=c||null!=d){var h=null!=c?c:0,i=b.subtract(this._point),j=i.getLength();if(h>j)return!1;var k=null!=d?d:0;if(0!=k)if(j>k)b=this._point.add(i.normalize(k));else if(g)return!1}if(f&&b.equals(this._point))return!1}switch(this._lastPoint=e&&"mousemove"==a?b:this._point,this._point=b,a){case"mousedown":this._lastPoint=this._downPoint,this._downPoint=this._point,this._downCount++;break;case"mouseup":this._lastPoint=this._downPoint}return this._count=e?0:this._count+1,!0},_fireEvent:function(a,b){var c=paper.project._removeSets;if(c){"mouseup"===a&&(c.mousedrag=null);var d=c[a];if(d){for(var e in d){var f=d[e];for(var g in c){var h=c[g];h&&h!=d&&delete h[f._id]}f.remove()}c[a]=null}}return this.responds(a)&&this.fire(a,new Y(this,a,b))},_onHandleEvent:function(a,b,c){paper=this._scope;var d=!1;switch(a){case"mousedown":this._updateEvent(a,b,null,null,!0,!1,!1),d=this._fireEvent(a,c);break;case"mousedrag":for(var e=!1,f=!1;this._updateEvent(a,b,this.minDistance,this.maxDistance,!1,e,f);)d=this._fireEvent(a,c)||d,e=!0,f=!0;break;case"mouseup":!b.equals(this._point)&&this._updateEvent("mousedrag",b,this.minDistance,this.maxDistance,!1,!1,!1)&&(d=this._fireEvent("mousedrag",c)),this._updateEvent(a,b,null,this.maxDistance,!1,!1,!1),d=this._fireEvent(a,c)||d,this._updateEvent(a,b,null,null,!0,!1,!1),this._firstMove=!0;break;case"mousemove":for(;this._updateEvent(a,b,this.minDistance,this.maxDistance,this._firstMove,!0,!1);)d=this._fireEvent(a,c)||d,this._firstMove=!1}return d}}),$={request:function(a,b,c){var d=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");return d.open(a.toUpperCase(),b,!0),"overrideMimeType"in d&&d.overrideMimeType("text/plain"),d.onreadystatechange=function(){if(4===d.readyState){var a=d.status;if(0!==a&&200!==a)throw Error("Could not load "+b+" (Error "+a+")");c.call(d,d.responseText)}},d.send(null)}},_={canvases:[],getCanvas:function(a,b,c){var d,e=!0;"object"==typeof a&&(c=b,b=a.height,a=a.width),c?1!==c&&(a*=c,b*=c):c=1,d=this.canvases.length?this.canvases.pop():document.createElement("canvas");var f=d.getContext("2d");return d.width===a&&d.height===b?e&&f.clearRect(0,0,a+1,b+1):(d.width=a,d.height=b),f.save(),1!==c&&f.scale(c,c),d},getContext:function(a,b){return this.getCanvas(a,b).getContext("2d")},release:function(a){var b=a.canvas?a.canvas:a;b.getContext("2d").restore(),this.canvases.push(b)}},ab=new function(){function a(a,b,c){return.2989*a+.587*b+.114*c}function c(b,c,d,e){var f=e-a(b,c,d);n=b+f,o=c+f,p=d+f;var e=a(n,o,p),g=q(n,o,p),h=r(n,o,p);if(0>g){var i=e-g;n=e+(n-e)*e/i,o=e+(o-e)*e/i,p=e+(p-e)*e/i}if(h>255){var j=255-e,k=h-e;n=e+(n-e)*j/k,o=e+(o-e)*j/k,p=e+(p-e)*j/k}}function d(a,b,c){return r(a,b,c)-q(a,b,c)}function e(a,b,c,d){var e,f=[a,b,c],g=r(a,b,c),h=q(a,b,c);h=h===a?0:h===b?1:2,g=g===a?0:g===b?1:2,e=0===q(h,g)?1===r(h,g)?2:1:0,f[g]>f[h]?(f[e]=(f[e]-f[h])*d/(f[g]-f[h]),f[g]=d):f[e]=f[g]=0,f[h]=0,n=f[0],o=f[1],p=f[2]}var f,g,h,i,j,k,l,m,n,o,p,q=Math.min,r=Math.max,s=Math.abs,t={multiply:function(){n=j*f/255,o=k*g/255,p=l*h/255},screen:function(){n=j+f-j*f/255,o=k+g-k*g/255,p=l+h-l*h/255},overlay:function(){n=128>j?2*j*f/255:255-2*(255-j)*(255-f)/255,o=128>k?2*k*g/255:255-2*(255-k)*(255-g)/255,p=128>l?2*l*h/255:255-2*(255-l)*(255-h)/255},"soft-light":function(){var a=f*j/255;n=a+j*(255-(255-j)*(255-f)/255-a)/255,a=g*k/255,o=a+k*(255-(255-k)*(255-g)/255-a)/255,a=h*l/255,p=a+l*(255-(255-l)*(255-h)/255-a)/255},"hard-light":function(){n=128>f?2*f*j/255:255-2*(255-f)*(255-j)/255,o=128>g?2*g*k/255:255-2*(255-g)*(255-k)/255,p=128>h?2*h*l/255:255-2*(255-h)*(255-l)/255},"color-dodge":function(){n=0===j?0:255===f?255:q(255,255*j/(255-f)),o=0===k?0:255===g?255:q(255,255*k/(255-g)),p=0===l?0:255===h?255:q(255,255*l/(255-h))},"color-burn":function(){n=255===j?255:0===f?0:r(0,255-255*(255-j)/f),o=255===k?255:0===g?0:r(0,255-255*(255-k)/g),p=255===l?255:0===h?0:r(0,255-255*(255-l)/h)},darken:function(){n=f>j?j:f,o=g>k?k:g,p=h>l?l:h},lighten:function(){n=j>f?j:f,o=k>g?k:g,p=l>h?l:h},difference:function(){n=j-f,0>n&&(n=-n),o=k-g,0>o&&(o=-o),p=l-h,0>p&&(p=-p)},exclusion:function(){n=j+f*(255-j-j)/255,o=k+g*(255-k-k)/255,p=l+h*(255-l-l)/255},hue:function(){e(f,g,h,d(j,k,l)),c(n,o,p,a(j,k,l))},saturation:function(){e(j,k,l,d(f,g,h)),c(n,o,p,a(j,k,l))},luminosity:function(){c(j,k,l,a(f,g,h))},color:function(){c(f,g,h,a(j,k,l))},add:function(){n=q(j+f,255),o=q(k+g,255),p=q(l+h,255)},subtract:function(){n=r(j-f,0),o=r(k-g,0),p=r(l-h,0)},average:function(){n=(j+f)/2,o=(k+g)/2,p=(l+h)/2},negation:function(){n=255-s(255-f-j),o=255-s(255-g-k),p=255-s(255-h-l)}},u=this.nativeModes=b.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(a){this[a]=!0},{}),v=_.getContext(1,1);b.each(t,function(a,b){v.save();var c="darken"===b,d=!1;v.fillStyle=c?"#300":"#a00",v.fillRect(0,0,1,1),v.globalCompositeOperation=b,v.globalCompositeOperation===b&&(v.fillStyle=c?"#a00":"#300",v.fillRect(0,0,1,1),d=v.getImageData(0,0,1,1).data[0]!==(c?170:51)),u[b]=d,v.restore()}),_.release(v),this.process=function(a,b,c,d,e){var q=b.canvas,r="normal"===a;if(r||u[a])c.save(),c.setTransform(1,0,0,1,0,0),c.globalAlpha=d,r||(c.globalCompositeOperation=a),c.drawImage(q,e.x,e.y),c.restore();else{var s=t[a];if(!s)return;for(var v=c.getImageData(e.x,e.y,q.width,q.height),w=v.data,x=b.getImageData(0,0,q.width,q.height).data,y=0,z=w.length;z>y;y+=4){f=x[y],j=w[y],g=x[y+1],k=w[y+1],h=x[y+2],l=w[y+2],i=x[y+3],m=w[y+3],s();var A=i*d/255,B=1-A;w[y]=A*n+B*j,w[y+1]=A*o+B*k,w[y+2]=A*p+B*l,w[y+3]=i*d+B*m}c.putImageData(v,e.x,e.y)}}},bb=b.each({fillColor:["fill","color"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],font:["font-family","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","string"]},function(a,c){var d=b.capitalize(c),e=a[2];this[c]={type:a[1],property:c,attribute:a[0],toSVG:e,fromSVG:e&&b.each(e,function(a,b){this[a]=b},{}),get:"get"+d,set:"set"+d}},{}),cb={href:"http://www.w3.org/1999/xlink",xlink:"http://www.w3.org/2000/xmlns"};return new function(){function a(a,b){for(var c in b){var d=b[c],e=cb[c];
"number"==typeof d&&(d=y.number(d)),e?a.setAttributeNS(e,c,d):a.setAttribute(c,d)}return a}function c(b,c){return a(document.createElementNS("http://www.w3.org/2000/svg",b),c)}function d(a,b,c){var d=a._matrix,e=d.getTranslation(),f={};if(b){d=d.shiftless();var h=d._inverseTransform(e);f[c?"cx":"x"]=h.x,f[c?"cy":"y"]=h.y,e=null}if(d.isIdentity())return f;var i=d.decompose();if(i&&!i.shearing){var j=[],k=i.rotation,l=i.scaling;e&&!e.isZero()&&j.push("translate("+y.point(e)+")"),g.isZero(l.x-1)&&g.isZero(l.y-1)||j.push("scale("+y.point(l)+")"),k&&j.push("rotate("+y.number(k)+")"),f.transform=j.join(" ")}else f.transform="matrix("+d.getValues().join(",")+")";return f}function e(b,e){for(var f=d(b),g=b._children,h=c("g",f),i=0,j=g.length;j>i;i++){var k=g[i],l=w(k,e);if(l)if(k.isClipMask()){var m=c("clipPath");m.appendChild(l),u(k,m,"clip"),a(h,{"clip-path":"url(#"+m.id+")"})}else h.appendChild(l)}return h}function h(a){var b=d(a,!0),e=a.getSize();return b.x-=e.width/2,b.y-=e.height/2,b.width=e.width,b.height=e.height,b.href=a.toDataURL(),c("image",b)}function j(a,b){if(b.matchShapes){var d=a.toShape(!1);if(d)return k(d,b)}var e,f,g=a._segments;if(0===g.length)return null;if(a.isPolygon())if(g.length>=3){e=a._closed?"polygon":"polyline";var h=[];for(i=0,l=g.length;l>i;i++)h.push(y.point(g[i]._point));f={points:h.join(" ")}}else{e="line";var j=g[0]._point,m=g[g.length-1]._point;f={x1:j.x,y1:j.y,x2:m.x,y2:m.y}}else{e="path";var n=a.getPathData();f=n&&{d:n}}return c(e,f)}function k(a){var b=a._shape,e=a._radius,f=d(a,!0,"rectangle"!==b);if("rectangle"===b){b="rect";var g=a._size,h=g.width,i=g.height;f.x-=h/2,f.y-=i/2,f.width=h,f.height=i,e.isZero()&&(e=null)}return e&&("circle"===b?f.r=e:(f.rx=e.width,f.ry=e.height)),c(b,f)}function m(a){var b=d(a,!0),e=a.getPathData();return e&&(b.d=e),c("path",b)}function n(a,b){var e=d(a,!0),f=a.getSymbol(),g=s(f,"symbol"),h=f.getDefinition(),i=h.getBounds();return g||(g=c("symbol",{viewBox:y.rectangle(i)}),g.appendChild(w(h,b)),u(f,g,"symbol")),e.href="#"+g.id,e.x+=i.x,e.y+=i.y,e.width=y.number(i.width),e.height=y.number(i.height),c("use",e)}function o(a){var b=s(a,"color");if(!b){var d,e=a.getGradient(),f=e._radial,g=a.getOrigin().transform(),h=a.getDestination().transform();if(f){d={cx:g.x,cy:g.y,r:g.getDistance(h)};var i=a.getHighlight();i&&(i=i.transform(),d.fx=i.x,d.fy=i.y)}else d={x1:g.x,y1:g.y,x2:h.x,y2:h.y};d.gradientUnits="userSpaceOnUse",b=c((f?"radial":"linear")+"Gradient",d);for(var j=e._stops,k=0,l=j.length;l>k;k++){var m=j[k],n=m._color,o=n.getAlpha();d={offset:m._rampPoint,"stop-color":n.toCSS(!0)},1>o&&(d["stop-opacity"]=o),b.appendChild(c("stop",d))}u(a,b,"color")}return"url(#"+b.id+")"}function p(a){var b=c("text",d(a,!0));return b.textContent=a._content,b}function q(c,d){var e={},f=c.getParent();return null!=c._name&&(e.id=c._name),b.each(bb,function(a){var d=a.get,g=a.type,h=c[d]();if(!f||!b.equals(f[d](),h)){if("color"===g&&null!=h){var i=h.getAlpha();1>i&&(e[a.attribute+"-opacity"]=i)}e[a.attribute]=null==h?"none":"number"===g?y.number(h):"color"===g?h.gradient?o(h,c):h.toCSS(!0):"array"===g?h.join(","):"lookup"===g?a.toSVG[h]:h}}),1===e.opacity&&delete e.opacity,null==c._visibility||c._visibility||(e.visibility="hidden"),a(d,e)}function s(a,b){return z||(z={ids:{},svgs:{}}),a&&z.svgs[b+"-"+a._id]}function u(a,b,c){z||s();var d=z.ids[c]=(z.ids[c]||0)+1;b.id=c+"-"+d,z.svgs[c+"-"+a._id]=b}function v(a,b){var d=a,e=null;if(z){d="svg"===a.nodeName.toLowerCase()&&a;for(var f in z.svgs)e||(d||(d=c("svg"),d.appendChild(a)),e=d.insertBefore(c("defs"),d.firstChild)),e.appendChild(z.svgs[f]);z=null}return b.asString?(new XMLSerializer).serializeToString(d):d}function w(a,b){var c=A[a._type],d=c&&c(a,b);return d&&a._data&&d.setAttribute("data-paper-data",JSON.stringify(a._data)),d&&q(a,d)}function x(a){return a||(a={}),y=new f(a.precision),a}var y,z,A={group:e,layer:e,raster:h,path:j,shape:k,"compound-path":m,"placed-symbol":n,"point-text":p};t.inject({exportSVG:function(a){return a=x(a),v(w(this,a),a)}}),r.inject({exportSVG:function(a){a=x(a);for(var b=this.layers,d=this.view.getSize(),e=c("svg",{x:0,y:0,width:d.width,height:d.height,version:"1.1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),f=0,g=b.length;g>f;f++)e.appendChild(w(b[f],a));return v(e,a)}})},new function(){function c(a,b,c,d){var e=cb[b],f=e?a.getAttributeNS(e,b):a.getAttribute(b);return"null"===f&&(f=null),null==f?d?null:c?"":0:c?f:parseFloat(f)}function d(a,b,d,e){return b=c(a,b,!1,e),d=c(a,d,!1,e),!e||null!=b&&null!=d?new h(b,d):null}function e(a,b,d,e){return b=c(a,b,!1,e),d=c(a,d,!1,e),!e||null!=b&&null!=d?new k(b,d):null}function f(a,b,c){return"none"===a?null:"number"===b?parseFloat(a):"array"===b?a?a.split(/[\s,]+/g).map(parseFloat):[]:"color"===b?y(a)||a:"lookup"===b?c[a]:a}function g(a,b,c,d){var e=a.childNodes,f="clippath"===b,g=new u,h=g._project,i=h._currentStyle,j=[];f||(g._transformContent=!1,g=v(g,a,c),h._currentStyle=g._style.clone());for(var k=0,l=e.length;l>k;k++){var m,n=e[k];1!==n.nodeType||!(m=z(n,!1,d))||m instanceof s||j.push(m)}return g.addChildren(j),f&&(g=v(g.reduce(),a,c)),h._currentStyle=i,(f||"defs"===b)&&(g.remove(),g=null),g}function i(a,b){var c=new F,d=a.points;c.moveTo(d.getItem(0));for(var e=1,f=d.numberOfItems;f>e;e++)c.lineTo(d.getItem(e));return"polygon"===b&&c.closePath(),c}function j(a){var b=a.getAttribute("d"),c=b.match(/m/gi).length>1?new G:new F;return c.setPathData(b),c}function l(a,b){for(var e=a.childNodes,f=[],g=0,h=e.length;h>g;g++){var i=e[g];1===i.nodeType&&f.push(v(new N,i))}var j,k,l,m="radialgradient"===b,n=new M(f,m);return m?(j=d(a,"cx","cy"),k=j.add(c(a,"r"),0),l=d(a,"fx","fy",!0)):(j=d(a,"x1","y1"),k=d(a,"x2","y2")),v(new L(n,j,k,l),a),null}function m(a,b,c,d){for(var e=(d.getAttribute(c)||"").split(/\)\s*/g),f=new p,g=0,h=e.length;h>g;g++){var i=e[g];if(!i)break;for(var j=i.split("("),k=j[0],l=j[1].split(/[\s,]+/g),m=0,n=l.length;n>m;m++)l[m]=parseFloat(l[m]);switch(k){case"matrix":f.concatenate(new p(l[0],l[1],l[2],l[3],l[4],l[5]));break;case"rotate":f.rotate(l[0],l[1],l[2]);break;case"translate":f.translate(l[0],l[1]);break;case"scale":f.scale(l);break;case"skewX":case"skewY":var b=Math.tan(l[0]*Math.PI/180),o="skewX"==k;f.shear(o?b:0,o?0:b)}}a.transform(f)}function o(a,b,c){var d=a["fill-opacity"===c?"getFillColor":"getStrokeColor"]();d&&d.setAlpha(parseFloat(b))}function q(c,d,e){var f=c.attributes[d],g=f&&f.value;if(!g){var h=b.camelize(d);g=c.style[h],g||e.node[h]===e.parent[h]||(g=e.node[h])}return g?"none"===g?null:g:a}function v(c,d,e){var f={node:P.getStyles(d)||{},parent:!e&&P.getStyles(d.parentNode)||{}};return b.each(B,function(e,g){var h=q(d,g,f);h!==a&&(c=b.pick(e(c,h,g,d,f),c))}),c}function y(a){var b=a&&a.match(/\((?:#|)([^)']+)/);return b&&C[b[1]]}function z(a,b,c){function d(a){paper=f;var d=z(a,b,c),e=c.onLoad,g=f.project&&f.project.view;e&&e.call(this,d),g.draw(!0)}if(!a)return null;c?"function"==typeof c&&(c={onLoad:c}):c={};var e=a,f=paper;if(b)if("string"!=typeof a||/^.*</.test(a)){if("undefined"!=typeof File&&a instanceof File){var g=new FileReader;return g.onload=function(){d(g.result)},g.readAsText(a)}}else{if(e=document.getElementById(a),!e)return $.request("get",a,d);a=null}if("string"==typeof a&&(e=(new DOMParser).parseFromString(a,"image/svg+xml")),!e.nodeName)throw Error("Unsupported SVG source: "+a);var h=e.nodeName.toLowerCase(),i=A[h],j=i&&i(e,h,b,c)||null,k=e.getAttribute&&e.getAttribute("data-paper-data");return j&&(j instanceof u||(j=v(j,e,b)),c.expandShapes&&j instanceof w&&(j.remove(),j=j.toPath()),k&&(j._data=JSON.parse(k))),b&&(C={}),j}var A={"#document":function(a,b,c,d){for(var e=a.childNodes,f=0,g=e.length;g>f;f++){var h=e[f];if(1===h.nodeType){var i=h.nextSibling;document.body.appendChild(h);var j=z(h,c,d);return i?a.insertBefore(h,i):a.appendChild(h),j}}},g:g,svg:g,clippath:g,polygon:i,polyline:i,path:j,lineargradient:l,radialgradient:l,image:function(a){var b=new x(c(a,"href",!0));return b.attach("load",function(){var b=e(a,"width","height");this.setSize(b);var c=this._matrix._transformPoint(d(a,"x","y").add(b.divide(2)));this.translate(c)}),b},symbol:function(a,b,c,d){return new s(g(a,b,c,d),!0)},defs:g,use:function(a){var b=(c(a,"href",!0)||"").substring(1),e=C[b],f=d(a,"x","y");return e?e instanceof s?e.place(f):e.clone().translate(f):null},circle:function(a){return new w.Circle(d(a,"cx","cy"),c(a,"r"))},ellipse:function(a){return new w.Ellipse({center:d(a,"cx","cy"),radius:e(a,"rx","ry")})},rect:function(a){var b=d(a,"x","y"),c=e(a,"width","height"),f=e(a,"rx","ry");return new w.Rectangle(new n(b,c),f)},line:function(a){return new F.Line(d(a,"x1","y1"),d(a,"x2","y2"))},text:function(a){var b=new K(d(a,"x","y").add(d(a,"dx","dy")));return b.setContent(a.textContent.trim()||""),b}},B=b.each(bb,function(a){this[a.attribute]=function(b,c){if(b[a.set](f(c,a.type,a.fromSVG)),"color"===a.type&&b instanceof w){var d=b[a.get]();d&&d.transform((new p).translate(b.getPosition(!0).negate()))}}},{id:function(a,b){C[b]=a,a.setName&&a.setName(b)},"clip-path":function(a,b){var c=y(b);if(c){if(c=c.clone(),c.setClipMask(!0),!(a instanceof u))return new u(c,a);a.insertChild(0,c)}},gradientTransform:m,transform:m,"fill-opacity":o,"stroke-opacity":o,visibility:function(a,b){a.setVisible("visible"===b)},"stop-color":function(a,b){a.setColor&&a.setColor(b)},"stop-opacity":function(a,b){a._color&&a._color.setAlpha(parseFloat(b))},offset:function(a,b){var c=b.match(/(.*)%$/);a.setRampPoint(c?c[1]/100:parseFloat(b))},viewBox:function(a,b,c,d,g){var h=new n(f(b,"array")),i=e(d,"width","height",!0);if(a instanceof u){var j=i?h.getSize().divide(i):1,k=(new p).translate(h.getPoint()).scale(j);a.transform(k.inverted())}else if(a instanceof s){i&&h.setSize(i);var l="visible"!=q(d,"overflow",g),m=a._definition;l&&!h.contains(m.getBounds())&&(l=new w.Rectangle(h).transform(m._matrix),l.setClipMask(!0),m.addChild(l))}}}),C={};t.inject({importSVG:function(a,b){return this.addChild(z(a,!0,b))}}),r.inject({importSVG:function(a,b){return this.activate(),z(a,!0,b)}})},paper=new(d.inject(new b(b.exports,{enumerable:!0,Base:b,Numerical:g,DomElement:P,DomEvent:Q,Http:$,Key:V}))),"function"==typeof define&&define.amd&&define("paper",paper),paper};paper.PaperScope.prototype.PaperScript=function(root){function _$_(a,b,c){var d=binaryOperators[b];if(a&&a[d]){var e=a[d](c);return"!="===b?!e:e}switch(b){case"+":return a+c;case"-":return a-c;case"*":return a*c;case"/":return a/c;case"%":return a%c;case"==":return a==c;case"!=":return a!=c}}function $_(a,b){var c=unaryOperators[a];if(c&&b&&b[c])return b[c]();switch(a){case"+":return+b;case"-":return-b}}function compile(a){function b(a){for(var b=0,c=f.length;c>b;b++){var d=f[b];if(d[0]>=a)break;a+=d[1]}return a}function c(c){return a.substring(b(c.range[0]),b(c.range[1]))}function d(c,d){for(var e=b(c.range[0]),g=b(c.range[1]),h=0,i=f.length-1;i>=0;i--)if(e>f[i][0]){h=i+1;break}f.splice(h,0,[e,d.length-g+e]),a=a.substring(0,e)+d+a.substring(g)}function e(a,b){if(a){for(var f in a)if("range"!==f){var g=a[f];if(Array.isArray(g))for(var h=0,i=g.length;i>h;h++)e(g[h],a);else g&&"object"==typeof g&&e(g,a)}switch(a&&a.type){case"BinaryExpression":if(a.operator in binaryOperators&&"Literal"!==a.left.type){var j=c(a.left),k=c(a.right);d(a,"_$_("+j+', "'+a.operator+'", '+k+")")}break;case"AssignmentExpression":if(/^.=$/.test(a.operator)&&"Literal"!==a.left.type){var j=c(a.left),k=c(a.right);d(a,j+" = _$_("+j+', "'+a.operator[0]+'", '+k+")")}break;case"UpdateExpression":if(!(a.prefix||b&&("BinaryExpression"===b.type&&/^[=!<>]/.test(b.operator)||"MemberExpression"===b.type&&b.computed))){var l=c(a.argument);d(a,l+" = _$_("+l+', "'+a.operator[0]+'", 1)')}break;case"UnaryExpression":if(a.operator in unaryOperators&&"Literal"!==a.argument.type){var l=c(a.argument);d(a,'$_("'+a.operator+'", '+l+")")}}}}var f=[];return e(scope.acorn.parse(a,{ranges:!0})),a}function evaluate(code,scope){paper=scope;var view=scope.project&&scope.project.view,res;with(scope)!function(){var onActivate,onDeactivate,onEditOptions,onMouseDown,onMouseUp,onMouseDrag,onMouseMove,onKeyDown,onKeyUp,onFrame,onResize;if(code=compile(code),root.InstallTrigger){var handle=PaperScript.handleException;if(!handle){handle=PaperScript.handleException=function(a){throw a.lineNumber>=lineNumber?Error(a.message,a.fileName,a.lineNumber-lineNumber):a};var lineNumber=Error().lineNumber;lineNumber+=3*(Error().lineNumber-lineNumber)}try{res=eval(";"+code)}catch(e){handle(e)}}else res=eval(code);/on(?:Key|Mouse)(?:Up|Down|Move|Drag)/.test(code)&&Base.each(paper.Tool.prototype._events,function(key){var value=eval(key);value&&(scope.getTool()[key]=value)}),view&&(view.setOnResize(onResize),view.fire("resize",{size:view.size,delta:new Point}),onFrame&&view.setOnFrame(onFrame),view.draw())}.call(scope);return res}function load(){Base.each(document.getElementsByTagName("script"),function(a){if(/^text\/(?:x-|)paperscript$/.test(a.type)&&!a.getAttribute("data-paper-ignore")){var b=PaperScope.getAttribute(a,"canvas"),c=PaperScope.get(b)||new PaperScope(a).setup(b),d=a.src;d?paper.Http.request("get",d,function(a){evaluate(a,c)}):evaluate(a.innerHTML,c),a.setAttribute("data-paper-ignore",!0)}},this)}var Base=paper.Base,PaperScope=paper.PaperScope,PaperScript,exports,define,scope=this;!function(a,b){return"object"==typeof exports&&"object"==typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):void b(a.acorn||(a.acorn={}))}(this,function(a){"use strict";function b(a){lb=a||{};for(var b in pb)Object.prototype.hasOwnProperty.call(lb,b)||(lb[b]=pb[b]);ob=lb.sourceFile||null}function c(a,b){var c=qb(mb,a);b+=" ("+c.line+":"+c.column+")";var d=new SyntaxError(b);throw d.pos=a,d.loc=c,d.raisedAt=rb,d}function d(a){function b(a){if(1==a.length)return c+="return str === "+JSON.stringify(a[0])+";";c+="switch(str){";for(var b=0;b<a.length;++b)c+="case "+JSON.stringify(a[b])+":";c+="return true}return false;"}a=a.split(" ");var c="",d=[];a:for(var e=0;e<a.length;++e){for(var f=0;f<d.length;++f)if(d[f][0].length==a[e].length){d[f].push(a[e]);continue a}d.push([a[e]])}if(d.length>3){d.sort(function(a,b){return b.length-a.length}),c+="switch(str.length){";for(var e=0;e<d.length;++e){var g=d[e];c+="case "+g[0].length+":",b(g)}c+="}"}else b(a);return Function("str",c)}function e(){this.line=zb,this.column=rb-Ab}function f(){zb=1,rb=Ab=0,yb=!0,j()}function g(a,b){tb=rb,lb.locations&&(vb=new e),wb=a,j(),xb=b,yb=a.beforeExpr}function h(){var a=lb.onComment&&lb.locations&&new e,b=rb,d=mb.indexOf("*/",rb+=2);if(-1===d&&c(rb-2,"Unterminated comment"),rb=d+2,lb.locations){Yc.lastIndex=b;for(var f;(f=Yc.exec(mb))&&f.index<rb;)++zb,Ab=f.index+f[0].length}lb.onComment&&lb.onComment(!0,mb.slice(b+2,d),b,rb,a,lb.locations&&new e)}function i(){for(var a=rb,b=lb.onComment&&lb.locations&&new e,c=mb.charCodeAt(rb+=2);nb>rb&&10!==c&&13!==c&&8232!==c&&8329!==c;)++rb,c=mb.charCodeAt(rb);lb.onComment&&lb.onComment(!1,mb.slice(a+2,rb),a,rb,b,lb.locations&&new e)}function j(){for(;nb>rb;){var a=mb.charCodeAt(rb);if(32===a)++rb;else if(13===a){++rb;var b=mb.charCodeAt(rb);10===b&&++rb,lb.locations&&(++zb,Ab=rb)}else if(10===a)++rb,++zb,Ab=rb;else if(14>a&&a>8)++rb;else if(47===a){var b=mb.charCodeAt(rb+1);if(42===b)h();else{if(47!==b)break;i()}}else if(160===a)++rb;else{if(!(a>=5760&&Sc.test(String.fromCharCode(a))))break;++rb}}}function k(){var a=mb.charCodeAt(rb+1);return a>=48&&57>=a?y(!0):(++rb,g(uc))}function l(){var a=mb.charCodeAt(rb+1);return yb?(++rb,v()):61===a?u(yc,2):u(wc,1)}function m(){var a=mb.charCodeAt(rb+1);return 61===a?u(yc,2):u(Kc,1)}function n(a){var b=mb.charCodeAt(rb+1);return b===a?u(124===a?Cc:Dc,2):61===b?u(yc,2):u(124===a?Ec:Gc,1)}function o(){var a=mb.charCodeAt(rb+1);return 61===a?u(yc,2):u(Fc,1)}function p(a){var b=mb.charCodeAt(rb+1);return b===a?u(Ac,2):61===b?u(yc,2):u(zc,1)}function q(a){var b=mb.charCodeAt(rb+1),c=1;return b===a?(c=62===a&&62===mb.charCodeAt(rb+2)?3:2,61===mb.charCodeAt(rb+c)?u(yc,c+1):u(Jc,c)):(61===b&&(c=61===mb.charCodeAt(rb+2)?3:2),u(Ic,c))}function r(a){var b=mb.charCodeAt(rb+1);return 61===b?u(Hc,61===mb.charCodeAt(rb+2)?3:2):u(61===a?xc:Bc,1)}function s(a){switch(a){case 46:return k();case 40:return++rb,g(pc);case 41:return++rb,g(qc);case 59:return++rb,g(sc);case 44:return++rb,g(rc);case 91:return++rb,g(lc);case 93:return++rb,g(mc);case 123:return++rb,g(nc);case 125:return++rb,g(oc);case 58:return++rb,g(tc);case 63:return++rb,g(vc);case 48:var b=mb.charCodeAt(rb+1);if(120===b||88===b)return x();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return y(!1);case 34:case 39:return z(a);case 47:return l(a);case 37:case 42:return m();case 124:case 38:return n(a);case 94:return o();case 43:case 45:return p(a);case 60:case 62:return q(a);case 61:case 33:return r(a);case 126:return u(Bc,1)}return!1}function t(a){if(a?rb=sb+1:sb=rb,lb.locations&&(ub=new e),a)return v();if(rb>=nb)return g(Mb);var b=mb.charCodeAt(rb);if(Zc(b)||92===b)return C();var d=s(b);if(d===!1){var f=String.fromCharCode(b);if("\\"===f||Vc.test(f))return C();c(rb,"Unexpected character '"+f+"'")}return d}function u(a,b){var c=mb.slice(rb,rb+b);rb+=b,g(a,c)}function v(){for(var a,b,d="",e=rb;;){rb>=nb&&c(e,"Unterminated regular expression");var f=mb.charAt(rb);if(Xc.test(f)&&c(e,"Unterminated regular expression"),a)a=!1;else{if("["===f)b=!0;else if("]"===f&&b)b=!1;else if("/"===f&&!b)break;a="\\"===f}++rb}var d=mb.slice(e,rb);++rb;var h=B();return h&&!/^[gmsiy]*$/.test(h)&&c(e,"Invalid regexp flag"),g(Jb,RegExp(d,h))}function w(a,b){for(var c=rb,d=0,e=0,f=null==b?1/0:b;f>e;++e){var g,h=mb.charCodeAt(rb);if(g=h>=97?h-97+10:h>=65?h-65+10:h>=48&&57>=h?h-48:1/0,g>=a)break;++rb,d=d*a+g}return rb===c||null!=b&&rb-c!==b?null:d}function x(){rb+=2;var a=w(16);return null==a&&c(sb+2,"Expected hexadecimal number"),Zc(mb.charCodeAt(rb))&&c(rb,"Identifier directly after number"),g(Ib,a)}function y(a){var b=rb,d=!1,e=48===mb.charCodeAt(rb);a||null!==w(10)||c(b,"Invalid number"),46===mb.charCodeAt(rb)&&(++rb,w(10),d=!0);var f=mb.charCodeAt(rb);(69===f||101===f)&&(f=mb.charCodeAt(++rb),(43===f||45===f)&&++rb,null===w(10)&&c(b,"Invalid number"),d=!0),Zc(mb.charCodeAt(rb))&&c(rb,"Identifier directly after number");var h,i=mb.slice(b,rb);return d?h=parseFloat(i):e&&1!==i.length?/[89]/.test(i)||Gb?c(b,"Invalid number"):h=parseInt(i,8):h=parseInt(i,10),g(Ib,h)}function z(a){rb++;for(var b="";;){rb>=nb&&c(sb,"Unterminated string constant");var d=mb.charCodeAt(rb);if(d===a)return++rb,g(Kb,b);if(92===d){d=mb.charCodeAt(++rb);var e=/^[0-7]+/.exec(mb.slice(rb,rb+3));for(e&&(e=e[0]);e&&parseInt(e,8)>255;)e=e.slice(0,e.length-1);if("0"===e&&(e=null),++rb,e)Gb&&c(rb-2,"Octal literal in strict mode"),b+=String.fromCharCode(parseInt(e,8)),rb+=e.length-1;else switch(d){case 110:b+="\n";break;case 114:b+="\r";break;case 120:b+=String.fromCharCode(A(2));break;case 117:b+=String.fromCharCode(A(4));break;case 85:b+=String.fromCharCode(A(8));break;case 116:b+="	";break;case 98:b+="\b";break;case 118:b+="";break;case 102:b+="\f";break;case 48:b+="\x00";break;case 13:10===mb.charCodeAt(rb)&&++rb;case 10:lb.locations&&(Ab=rb,++zb);break;default:b+=String.fromCharCode(d)}}else(13===d||10===d||8232===d||8329===d)&&c(sb,"Unterminated string constant"),b+=String.fromCharCode(d),++rb}}function A(a){var b=w(16,a);return null===b&&c(sb,"Bad character escape sequence"),b}function B(){Mc=!1;for(var a,b=!0,d=rb;;){var e=mb.charCodeAt(rb);if($c(e))Mc&&(a+=mb.charAt(rb)),++rb;else{if(92!==e)break;Mc||(a=mb.slice(d,rb)),Mc=!0,117!=mb.charCodeAt(++rb)&&c(rb,"Expecting Unicode escape sequence \\uXXXX"),++rb;var f=A(4),g=String.fromCharCode(f);g||c(rb-1,"Invalid Unicode escape"),(b?Zc(f):$c(f))||c(rb-4,"Invalid Unicode escape"),a+=g}b=!1}return Mc?a:mb.slice(d,rb)}function C(){var a=B(),b=Lb;return Mc||(Rc(a)?b=kc[a]:(lb.forbidReserved&&(3===lb.ecmaVersion?Nc:Oc)(a)||Gb&&Pc(a))&&c(sb,"The keyword '"+a+"' is reserved")),g(b,a)}function D(){Bb=sb,Cb=tb,Db=vb,t()}function E(a){for(Gb=a,rb=Cb;Ab>rb;)Ab=mb.lastIndexOf("\n",Ab-2)+1,--zb;j(),t()}function F(){this.type=null,this.start=sb,this.end=null}function G(){this.start=ub,this.end=null,null!==ob&&(this.source=ob)}function H(){var a=new F;return lb.locations&&(a.loc=new G),lb.ranges&&(a.range=[sb,0]),a}function I(a){var b=new F;return b.start=a.start,lb.locations&&(b.loc=new G,b.loc.start=a.loc.start),lb.ranges&&(b.range=[a.range[0],0]),b}function J(a,b){return a.type=b,a.end=Cb,lb.locations&&(a.loc.end=Db),lb.ranges&&(a.range[1]=Cb),a}function K(a){return lb.ecmaVersion>=5&&"ExpressionStatement"===a.type&&"Literal"===a.expression.type&&"use strict"===a.expression.value}function L(a){return wb===a?(D(),!0):void 0}function M(){return!lb.strictSemicolons&&(wb===Mb||wb===oc||Xc.test(mb.slice(Cb,sb)))}function N(){L(sc)||M()||P()}function O(a){wb===a?D():P()}function P(){c(sb,"Unexpected token")}function Q(a){"Identifier"!==a.type&&"MemberExpression"!==a.type&&c(a.start,"Assigning to rvalue"),Gb&&"Identifier"===a.type&&Qc(a.name)&&c(a.start,"Assigning to "+a.name+" in strict mode")}function R(a){Bb=Cb=rb,lb.locations&&(Db=new e),Eb=Gb=null,Fb=[],t();var b=a||H(),c=!0;for(a||(b.body=[]);wb!==Mb;){var d=S();b.body.push(d),c&&K(d)&&E(!0),c=!1}return J(b,"Program")}function S(){wb===wc&&t(!0);var a=wb,b=H();switch(a){case Nb:case Qb:D();var d=a===Nb;L(sc)||M()?b.label=null:wb!==Lb?P():(b.label=kb(),N());for(var e=0;e<Fb.length;++e){var f=Fb[e];if(null==b.label||f.name===b.label.name){if(null!=f.kind&&(d||"loop"===f.kind))break;if(b.label&&d)break}}return e===Fb.length&&c(b.start,"Unsyntactic "+a.keyword),J(b,d?"BreakStatement":"ContinueStatement");case Rb:return D(),N(),J(b,"DebuggerStatement");case Tb:return D(),Fb.push(_c),b.body=S(),Fb.pop(),O(cc),b.test=T(),N(),J(b,"DoWhileStatement");case Wb:if(D(),Fb.push(_c),O(pc),wb===sc)return V(b,null);if(wb===bc){var g=H();return D(),X(g,!0),1===g.declarations.length&&L(jc)?W(b,g):V(b,g)}var g=Y(!1,!0);return L(jc)?(Q(g),W(b,g)):V(b,g);case Xb:return D(),ib(b,!0);case Yb:return D(),b.test=T(),b.consequent=S(),b.alternate=L(Ub)?S():null,J(b,"IfStatement");case Zb:return Eb||c(sb,"'return' outside of function"),D(),L(sc)||M()?b.argument=null:(b.argument=Y(),N()),J(b,"ReturnStatement");case $b:D(),b.discriminant=T(),b.cases=[],O(nc),Fb.push(ad);for(var h,i;wb!=oc;)if(wb===Ob||wb===Sb){var j=wb===Ob;h&&J(h,"SwitchCase"),b.cases.push(h=H()),h.consequent=[],D(),j?h.test=Y():(i&&c(Bb,"Multiple default clauses"),i=!0,h.test=null),O(tc)}else h||P(),h.consequent.push(S());return h&&J(h,"SwitchCase"),D(),Fb.pop(),J(b,"SwitchStatement");case _b:return D(),Xc.test(mb.slice(Cb,sb))&&c(Cb,"Illegal newline after throw"),b.argument=Y(),N(),J(b,"ThrowStatement");case ac:if(D(),b.block=U(),b.handler=null,wb===Pb){var k=H();D(),O(pc),k.param=kb(),Gb&&Qc(k.param.name)&&c(k.param.start,"Binding "+k.param.name+" in strict mode"),O(qc),k.guard=null,k.body=U(),b.handler=J(k,"CatchClause")}return b.guardedHandlers=Hb,b.finalizer=L(Vb)?U():null,b.handler||b.finalizer||c(b.start,"Missing catch or finally clause"),J(b,"TryStatement");case bc:return D(),b=X(b),N(),b;case cc:return D(),b.test=T(),Fb.push(_c),b.body=S(),Fb.pop(),J(b,"WhileStatement");case dc:return Gb&&c(sb,"'with' in strict mode"),D(),b.object=T(),b.body=S(),J(b,"WithStatement");case nc:return U();case sc:return D(),J(b,"EmptyStatement");default:var l=xb,m=Y();if(a===Lb&&"Identifier"===m.type&&L(tc)){for(var e=0;e<Fb.length;++e)Fb[e].name===l&&c(m.start,"Label '"+l+"' is already declared");var n=wb.isLoop?"loop":wb===$b?"switch":null;return Fb.push({name:l,kind:n}),b.body=S(),Fb.pop(),b.label=m,J(b,"LabeledStatement")}return b.expression=m,N(),J(b,"ExpressionStatement")}}function T(){O(pc);var a=Y();return O(qc),a}function U(a){var b,c=H(),d=!0,e=!1;for(c.body=[],O(nc);!L(oc);){var f=S();c.body.push(f),d&&a&&K(f)&&(b=e,E(e=!0)),d=!1}return e&&!b&&E(!1),J(c,"BlockStatement")}function V(a,b){return a.init=b,O(sc),a.test=wb===sc?null:Y(),O(sc),a.update=wb===qc?null:Y(),O(qc),a.body=S(),Fb.pop(),J(a,"ForStatement")}function W(a,b){return a.left=b,a.right=Y(),O(qc),a.body=S(),Fb.pop(),J(a,"ForInStatement")}function X(a,b){for(a.declarations=[],a.kind="var";;){var d=H();if(d.id=kb(),Gb&&Qc(d.id.name)&&c(d.id.start,"Binding "+d.id.name+" in strict mode"),d.init=L(xc)?Y(!0,b):null,a.declarations.push(J(d,"VariableDeclarator")),!L(rc))break}return J(a,"VariableDeclaration")}function Y(a,b){var c=Z(b);if(!a&&wb===rc){var d=I(c);for(d.expressions=[c];L(rc);)d.expressions.push(Z(b));return J(d,"SequenceExpression")}return c}function Z(a){var b=$(a);if(wb.isAssign){var c=I(b);return c.operator=xb,c.left=b,D(),c.right=Z(a),Q(b),J(c,"AssignmentExpression")}return b}function $(a){var b=_(a);if(L(vc)){var c=I(b);return c.test=b,c.consequent=Y(!0),O(tc),c.alternate=Y(!0,a),J(c,"ConditionalExpression")}return b}function _(a){return ab(bb(),-1,a)}function ab(a,b,c){var d=wb.binop;if(null!=d&&(!c||wb!==jc)&&d>b){var e=I(a);e.left=a,e.operator=xb,D(),e.right=ab(bb(),d,c);var e=J(e,/&&|\|\|/.test(e.operator)?"LogicalExpression":"BinaryExpression");return ab(e,b,c)}return a}function bb(){if(wb.prefix){var a=H(),b=wb.isUpdate;return a.operator=xb,a.prefix=!0,D(),a.argument=bb(),b?Q(a.argument):Gb&&"delete"===a.operator&&"Identifier"===a.argument.type&&c(a.start,"Deleting local variable in strict mode"),J(a,b?"UpdateExpression":"UnaryExpression")}for(var d=cb();wb.postfix&&!M();){var a=I(d);a.operator=xb,a.prefix=!1,a.argument=d,Q(d),D(),d=J(a,"UpdateExpression")}return d}function cb(){return db(eb())}function db(a,b){if(L(uc)){var c=I(a);return c.object=a,c.property=kb(!0),c.computed=!1,db(J(c,"MemberExpression"),b)}if(L(lc)){var c=I(a);return c.object=a,c.property=Y(),c.computed=!0,O(mc),db(J(c,"MemberExpression"),b)}if(!b&&L(pc)){var c=I(a);return c.callee=a,c.arguments=jb(qc,!1),db(J(c,"CallExpression"),b)}return a}function eb(){switch(wb){case fc:var a=H();return D(),J(a,"ThisExpression");case Lb:return kb();case Ib:case Kb:case Jb:var a=H();return a.value=xb,a.raw=mb.slice(sb,tb),D(),J(a,"Literal");case gc:case hc:case ic:var a=H();return a.value=wb.atomValue,a.raw=wb.keyword,D(),J(a,"Literal");case pc:var b=ub,c=sb;D();var d=Y();return d.start=c,d.end=tb,lb.locations&&(d.loc.start=b,d.loc.end=vb),lb.ranges&&(d.range=[c,tb]),O(qc),d;case lc:var a=H();return D(),a.elements=jb(mc,!0,!0),J(a,"ArrayExpression");case nc:return gb();case Xb:var a=H();return D(),ib(a,!1);case ec:return fb();default:P()}}function fb(){var a=H();return D(),a.callee=db(eb(),!0),a.arguments=L(pc)?jb(qc,!1):Hb,J(a,"NewExpression")}function gb(){var a=H(),b=!0,d=!1;for(a.properties=[],D();!L(oc);){if(b)b=!1;else if(O(rc),lb.allowTrailingCommas&&L(oc))break;var e,f={key:hb()},g=!1;if(L(tc)?(f.value=Y(!0),e=f.kind="init"):lb.ecmaVersion>=5&&"Identifier"===f.key.type&&("get"===f.key.name||"set"===f.key.name)?(g=d=!0,e=f.kind=f.key.name,f.key=hb(),wb!==pc&&P(),f.value=ib(H(),!1)):P(),"Identifier"===f.key.type&&(Gb||d))for(var h=0;h<a.properties.length;++h){var i=a.properties[h];if(i.key.name===f.key.name){var j=e==i.kind||g&&"init"===i.kind||"init"===e&&("get"===i.kind||"set"===i.kind);j&&!Gb&&"init"===e&&"init"===i.kind&&(j=!1),j&&c(f.key.start,"Redefinition of property")}}a.properties.push(f)}return J(a,"ObjectExpression")}function hb(){return wb===Ib||wb===Kb?eb():kb(!0)}function ib(a,b){wb===Lb?a.id=kb():b?P():a.id=null,a.params=[];var d=!0;for(O(pc);!L(qc);)d?d=!1:O(rc),a.params.push(kb());var e=Eb,f=Fb;if(Eb=!0,Fb=[],a.body=U(!0),Eb=e,Fb=f,Gb||a.body.body.length&&K(a.body.body[0]))for(var g=a.id?-1:0;g<a.params.length;++g){var h=0>g?a.id:a.params[g];if((Pc(h.name)||Qc(h.name))&&c(h.start,"Defining '"+h.name+"' in strict mode"),g>=0)for(var i=0;g>i;++i)h.name===a.params[i].name&&c(h.start,"Argument name clash in strict mode")}return J(a,b?"FunctionDeclaration":"FunctionExpression")}function jb(a,b,c){for(var d=[],e=!0;!L(a);){if(e)e=!1;else if(O(rc),b&&lb.allowTrailingCommas&&L(a))break;d.push(c&&wb===rc?null:Y(!0))}return d}function kb(a){var b=H();return b.name=wb===Lb?xb:a&&!lb.forbidReserved&&wb.keyword||P(),D(),J(b,"Identifier")}a.version="0.3.2";var lb,mb,nb,ob;a.parse=function(a,c){return mb=a+"",nb=mb.length,b(c),f(),R(lb.program)};var pb=a.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null},qb=a.getLineInfo=function(a,b){for(var c=1,d=0;;){Yc.lastIndex=d;var e=Yc.exec(a);if(!(e&&e.index<b))break;++c,d=e.index+e[0].length}return{line:c,column:b-d}};a.tokenize=function(a,c){function d(a){return t(a),e.start=sb,e.end=tb,e.startLoc=ub,e.endLoc=vb,e.type=wb,e.value=xb,e}mb=a+"",nb=mb.length,b(c),f();var e={};return d.jumpTo=function(a,b){if(rb=a,lb.locations){zb=1,Ab=Yc.lastIndex=0;for(var c;(c=Yc.exec(mb))&&c.index<a;)++zb,Ab=c.index+c[0].length}yb=b,j()},d};var rb,sb,tb,ub,vb,wb,xb,yb,zb,Ab,Bb,Cb,Db,Eb,Fb,Gb,Hb=[],Ib={type:"num"},Jb={type:"regexp"},Kb={type:"string"},Lb={type:"name"},Mb={type:"eof"},Nb={keyword:"break"},Ob={keyword:"case",beforeExpr:!0},Pb={keyword:"catch"},Qb={keyword:"continue"},Rb={keyword:"debugger"},Sb={keyword:"default"},Tb={keyword:"do",isLoop:!0},Ub={keyword:"else",beforeExpr:!0},Vb={keyword:"finally"},Wb={keyword:"for",isLoop:!0},Xb={keyword:"function"},Yb={keyword:"if"},Zb={keyword:"return",beforeExpr:!0},$b={keyword:"switch"},_b={keyword:"throw",beforeExpr:!0},ac={keyword:"try"},bc={keyword:"var"},cc={keyword:"while",isLoop:!0},dc={keyword:"with"},ec={keyword:"new",beforeExpr:!0},fc={keyword:"this"},gc={keyword:"null",atomValue:null},hc={keyword:"true",atomValue:!0},ic={keyword:"false",atomValue:!1},jc={keyword:"in",binop:7,beforeExpr:!0},kc={"break":Nb,"case":Ob,"catch":Pb,"continue":Qb,"debugger":Rb,"default":Sb,"do":Tb,"else":Ub,"finally":Vb,"for":Wb,"function":Xb,"if":Yb,"return":Zb,"switch":$b,"throw":_b,"try":ac,"var":bc,"while":cc,"with":dc,"null":gc,"true":hc,"false":ic,"new":ec,"in":jc,"instanceof":{keyword:"instanceof",binop:7,beforeExpr:!0},"this":fc,"typeof":{keyword:"typeof",prefix:!0,beforeExpr:!0},"void":{keyword:"void",prefix:!0,beforeExpr:!0},"delete":{keyword:"delete",prefix:!0,beforeExpr:!0}},lc={type:"[",beforeExpr:!0},mc={type:"]"},nc={type:"{",beforeExpr:!0},oc={type:"}"},pc={type:"(",beforeExpr:!0},qc={type:")"},rc={type:",",beforeExpr:!0},sc={type:";",beforeExpr:!0},tc={type:":",beforeExpr:!0},uc={type:"."},vc={type:"?",beforeExpr:!0},wc={binop:10,beforeExpr:!0},xc={isAssign:!0,beforeExpr:!0},yc={isAssign:!0,beforeExpr:!0},zc={binop:9,prefix:!0,beforeExpr:!0},Ac={postfix:!0,prefix:!0,isUpdate:!0},Bc={prefix:!0,beforeExpr:!0},Cc={binop:1,beforeExpr:!0},Dc={binop:2,beforeExpr:!0},Ec={binop:3,beforeExpr:!0},Fc={binop:4,beforeExpr:!0},Gc={binop:5,beforeExpr:!0},Hc={binop:6,beforeExpr:!0},Ic={binop:7,beforeExpr:!0},Jc={binop:8,beforeExpr:!0},Kc={binop:10,beforeExpr:!0};a.tokTypes={bracketL:lc,bracketR:mc,braceL:nc,braceR:oc,parenL:pc,parenR:qc,comma:rc,semi:sc,colon:tc,dot:uc,question:vc,slash:wc,eq:xc,name:Lb,eof:Mb,num:Ib,regexp:Jb,string:Kb};for(var Lc in kc)a.tokTypes["_"+Lc]=kc[Lc];var Mc,Nc=d("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),Oc=d("class enum extends super const export import"),Pc=d("implements interface let package private protected public static yield"),Qc=d("eval arguments"),Rc=d("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),Sc=/[\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/,Tc="------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------",Uc="------------------------------------------------------------------------------------------------------------------------------------------",Vc=RegExp("["+Tc+"]"),Wc=RegExp("["+Tc+Uc+"]"),Xc=/[\n\r\u2028\u2029]/,Yc=/\r\n|[\n\r\u2028\u2029]/g,Zc=a.isIdentifierStart=function(a){return 65>a?36===a:91>a?!0:97>a?95===a:123>a?!0:a>=170&&Vc.test(String.fromCharCode(a))
},$c=a.isIdentifierChar=function(a){return 48>a?36===a:58>a?!0:65>a?!1:91>a?!0:97>a?95===a:123>a?!0:a>=170&&Wc.test(String.fromCharCode(a))},_c={kind:"loop"},ad={kind:"switch"}});var binaryOperators={"+":"_add","-":"_subtract","*":"_multiply","/":"_divide","%":"_modulo","==":"equals","!=":"equals"},unaryOperators={"-":"_negate","+":null},fields=Base.each(["add","subtract","multiply","divide","modulo","negate"],function(a){this["_"+a]="#"+a},{});return paper.Point.inject(fields),paper.Size.inject(fields),paper.Color.inject(fields),"complete"===document.readyState?setTimeout(load):paper.DomEvent.add(window,{load:load}),PaperScript={compile:compile,evaluate:evaluate,load:load,lineNumberBase:0}}(this),io=io.connect("/"),io.emit("ping",{some:"data"}),io.on("pong",function(a){console.log("socket: browser receives pong (4)",a)});